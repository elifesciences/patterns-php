{"version":3,"sources":["node_modules/browser-pack/_prelude.js","assets/js/components/ArticleDownloadLinksList.js","main.js","assets/js/components/ArticleSection.js","assets/js/components/AudioPlayer.js","assets/js/components/BackgroundImage.js","assets/js/components/ContentHeaderArticle.js","assets/js/components/MainMenu.js","assets/js/components/MediaChapterListingItem.js","assets/js/components/SearchBox.js","assets/js/components/SelectNav.js","assets/js/components/SiteHeader.js","assets/js/components/ViewSelector.js","assets/js/components/ViewerModal.js","assets/js/libs/elife-utils.js","assets/js/main.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","utils","ArticleDownloadLinksList","$elm","_window","arguments","undefined","window","doc","document","this","classList","add","moveList","$toggler","querySelector","addEventListener","toggle","bind","value","$newParent","$followingSibling","nextElementSibling","insertBefore","preventDefault","stopPropagation","isOpen","close","open","contains","remove","checkForClose","areElementsNested","removeEventListener","../libs/elife-utils","2","ArticleSection","thresholdWidth","initialise","$headerLink","createHeaderLink","$body","setInitialState","handleSectionOpeningViaHash","$header","$link","createElement","setAttribute","appendChild","firstElementChild","toggleState","dataset","initialState","viewportNoWiderThan","thresholdInPx","matchMedia","matches","hash","newURL","substring","indexOf","location","isFragmentForCollapsibleSection","openSection","section","fragment","$elFromFragmentId","behaviour","3","AudioPlayer","_this","HTMLAudioElement","console","log","$audioElement","uniqueId","uniqueIds","get","id","$playButton","buildPlayButton","$icon","$title","prepare$title","$progressTrack","buildProgressIndicator","$progressBar","$timeIndicators","buildTimeIndicators","$currentTime","$duration","duration","isPlaying","playerReady","usingMetadata","loadMetadata","episodeNumber","warn","player","innerHTML","secondsToMinutes","togglePlay","update","seekNewTime","CustomEvent","detail","createEvent","initCustomEvent","dispatchEvent","parent","span","$togglePlayButton","pause","play","updateIconState","currentTime","Math","floor","pc","currentTime2Dis","style","width","chapterNumberOnLastUpdate","getCurrentChapterNumber","setCurrentChapterMetadata","getChapterMetadataAtTime","chapterMetadata","getCurrentChapterMetadata","number","changeChapter","title","ended","setTitle","episodeTitle","chapterChanged","shouldPlay","isNaN","seek","newSeekPosition","parseInt","offsetX","availableWidth","clientWidth","durationProportionToSeek","time","chapterTitle","currentChapterMetadata","metadata","chapterNumber","forEach","chapter","chapters","chapterStartTime","nextChapterStartTime","prepareChapterMetadata","push","processMetadata","JSON","parse","replace","error","seconds","_seconds","mins","secs","state","src","getIconPath","alt","$barWrapper","buildElement","handleSeek","$button","$image","playerId","$container","iconName","4","BackgroundImage","sourceToUse","isValidThreshold","isThresholdMet","innerWidth","resizeHandler","init","calcSourceToUse","isHighDpr","setDarkBackground","setupEventHandlers","setLightBackground","candidate","Array","isArray","threshold","viewportWidth","getAttribute","backgroundImage","getBackgroundImagesString","color","path","grandient","sourceDefiner","lowResSource","highResSource","highResImageSource","lowResImageSource","5","ContentHeaderArticle","breakpointInPx","currentView","calcCurrentView","authors","querySelectorAll","institutions","hasToggleAuthor","hasToggleInstitution","hideAllExcessItems","newView","handleAnyExcessItems","itemType","items","clearExcessMark","toggleExcessItems","excessItems","getExcessItems","markAsExcess","markLastNonExcessItem","addTrailingText","defaultMaxItems","getDefaultMaxItems","slice","els","$el","item","breakpoint","lastShownIndex","foundLastShown","lastShown","buildSeeMoreLessToggle","_this2","toggleOnText","toggleOffText","6","MainMenu","$globalWrapper","7","MediaChapterListingItem","startTime","listenForChapterChange","createLink","$player","indicateChapterChanged","$rootElm","titleText","$existingLink","parentNode","removeChild","currentChapterNumber","8","SearchBox","$form","$input","$limit","$searchButton","$resetButton","$inner","isSearchLimited","checked","$output","handleKeyEntry","useSuggestion","keywords","reset","showResetButton","setKeywords","hideResetButton","focus","current","previousElementSibling","submit","searchTerm","filter","keyword","toLowerCase","sort","embolden","outputString","nudgeOutputVertically","match","posnInPx","posn","updateElementTranslate","searchBox","keyCode","nextSuggestion","prevSuggestion","display","filterKeywordsBySearchTerm","getKeywords","phrase","snippet","snippetRx","RegExp","toEmbolden","9","SelectNav","triggerSubmit","10","SiteHeader","$searchBoxEl","searchToggle","toggleSearchBox","$pageOverlay","mainMenu","$mainMenuToggle","moveWithinDom","toggleMainMenu","checkForMenuClose","type","searchBoxIsOpen","closeSearchBox","openSearchBox","blur","hidePageOverlay","myHeight","getComputedStyle","height","adjustment","offsetY","adjustPxString","transitionDurationInMs","invertPxString","setTimeout","showPageOverlay","className","$target","createPageOverlay","getBoundingClientRect","./MainMenu","./SearchBox","11","ViewSelector","cssFixedClassName","topSpaceWhenFixed","$elmYOffset","offsetTop","handleScroll","pageYOffset","12","ViewerModal","$prev","$next","build","prev","next","13","elName","cssClasses","textContent","attachBefore","$parent","HTMLElement","cssClass","offset","prop","pxString","originalSize","newSize","$prospectiveParent","$prospectiveDescendant","relationship","compareDocumentPosition","DOCUMENT_POSITION_CONTAINED_BY","getViewportWidth","documentElement","devicePixelRatio","UniqueIdentifiers","used","prefix","_prefix","random","isValid","14","localStorage","Components","Elife","initialiseComponent","$component","handlers","trim","split","handler","components","./components/ArticleDownloadLinksList","./components/ArticleSection","./components/AudioPlayer","./components/BackgroundImage","./components/ContentHeaderArticle","./components/MainMenu","./components/MediaChapterListingItem","./components/SearchBox","./components/SelectNav","./components/SiteHeader","./components/ViewSelector","./components/ViewerModal"],"mappings":"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","file":"main.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = class ArticleDownloadLinksList {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n\n    // One statement per class name because IE doesn't support multiple strings, comma separated.\n    this.$elm.classList.add('article-download-links-list--js');\n    this.$elm.classList.add('visuallyhidden');\n    this.moveList();\n    this.$toggler = this.doc.querySelector('.content-header__download_link');\n    this.$toggler.addEventListener('click', this.toggle.bind(this));\n  }\n\n  /**\n   * Moves the download links list to be by the icon this.$toggler\n   */\n  moveList() {\n    let $newParent = this.doc.querySelector('.content-header_top');\n    let $followingSibling =\n      $newParent.querySelector('.content-header__download_link').nextElementSibling;\n    $newParent.insertBefore(this.$elm, $followingSibling);\n  }\n\n  /**\n   * Toggles the download links list display.\n   *\n   * @param e The event triggering the display toggle\n   */\n  toggle(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.isOpen()) {\n      this.close();\n    } else {\n      this.open();\n    }\n\n  }\n\n  /**\n   * Returns whether links list is currently viewable.\n   *\n   * @returns {boolean} Whether links list is currently viewable\n   */\n  isOpen() {\n    return !this.$elm.classList.contains('visuallyhidden');\n  }\n\n  /**\n   * Make viewable.\n   */\n  open() {\n    this.$elm.classList.remove('visuallyhidden');\n    this.window.addEventListener('click', this.checkForClose.bind(this));\n  }\n\n  /**\n   * Checks whether a click occurred outside this, and close this if it did.\n   *\n   * @param e The click event to evaluate the target of\n   */\n  checkForClose(e) {\n    if (!utils.areElementsNested(this.$elm, e.target)) {\n      this.close();\n    }\n  }\n\n  /**\n   * Make unviewable.\n   */\n  close() {\n    this.$elm.classList.add('visuallyhidden');\n    this.window.removeEventListener('click', this.checkForClose.bind(this));\n  }\n\n};\n","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = function () {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  function ArticleDownloadLinksList($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, ArticleDownloadLinksList);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n\n    // One statement per class name because IE doesn't support multiple strings, comma separated.\n    this.$elm.classList.add('article-download-links-list--js');\n    this.$elm.classList.add('visuallyhidden');\n    this.moveList();\n    this.$toggler = this.doc.querySelector('.content-header__download_link');\n    this.$toggler.addEventListener('click', this.toggle.bind(this));\n  }\n\n  /**\n   * Moves the download links list to be by the icon this.$toggler\n   */\n\n\n  _createClass(ArticleDownloadLinksList, [{\n    key: 'moveList',\n    value: function moveList() {\n      var $newParent = this.doc.querySelector('.content-header_top');\n      var $followingSibling = $newParent.querySelector('.content-header__download_link').nextElementSibling;\n      $newParent.insertBefore(this.$elm, $followingSibling);\n    }\n\n    /**\n     * Toggles the download links list display.\n     *\n     * @param e The event triggering the display toggle\n     */\n\n  }, {\n    key: 'toggle',\n    value: function toggle(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      if (this.isOpen()) {\n        this.close();\n      } else {\n        this.open();\n      }\n    }\n\n    /**\n     * Returns whether links list is currently viewable.\n     *\n     * @returns {boolean} Whether links list is currently viewable\n     */\n\n  }, {\n    key: 'isOpen',\n    value: function isOpen() {\n      return !this.$elm.classList.contains('visuallyhidden');\n    }\n\n    /**\n     * Make viewable.\n     */\n\n  }, {\n    key: 'open',\n    value: function open() {\n      this.$elm.classList.remove('visuallyhidden');\n      this.window.addEventListener('click', this.checkForClose.bind(this));\n    }\n\n    /**\n     * Checks whether a click occurred outside this, and close this if it did.\n     *\n     * @param e The click event to evaluate the target of\n     */\n\n  }, {\n    key: 'checkForClose',\n    value: function checkForClose(e) {\n      if (!utils.areElementsNested(this.$elm, e.target)) {\n        this.close();\n      }\n    }\n\n    /**\n     * Make unviewable.\n     */\n\n  }, {\n    key: 'close',\n    value: function close() {\n      this.$elm.classList.add('visuallyhidden');\n      this.window.removeEventListener('click', this.checkForClose.bind(this));\n    }\n  }]);\n\n  return ArticleDownloadLinksList;\n}();\n\n},{\"../libs/elife-utils\":13}],2:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  function ArticleSection($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, ArticleSection);\n\n    if ($elm.classList.contains('article-section--first')) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n\n    this.thresholdWidth = 600;\n    this.initialise(this.$elm, doc);\n  }\n\n  _createClass(ArticleSection, [{\n    key: 'initialise',\n    value: function initialise($elm, doc) {\n      this.$elm.classList.add('article-section--js');\n      this.$headerLink = this.createHeaderLink($elm, doc);\n      this.$body = $elm.querySelector('.article-section__body');\n      this.setInitialState($elm, this.$headerLink, this.$body);\n      this.window.addEventListener('DOMContentLoaded', this.handleSectionOpeningViaHash.bind(this));\n      this.window.addEventListener('hashchange', this.handleSectionOpeningViaHash.bind(this));\n    }\n  }, {\n    key: 'createHeaderLink',\n    value: function createHeaderLink($elm, doc) {\n      var $header = $elm.querySelector('.article-section__header');\n      var $link = doc.createElement('A');\n      $link.setAttribute('href', '#');\n      $link.classList.add('article-section__header_link');\n      $link.appendChild($header.firstElementChild);\n      $header.appendChild($link);\n      $link.addEventListener('click', this.toggleState.bind(this));\n      return $link;\n    }\n  }, {\n    key: 'setInitialState',\n    value: function setInitialState($elm, $headerLink, $body) {\n      if ($elm.dataset.initialState === 'closed' || this.viewportNoWiderThan(this.thresholdWidth)) {\n        $elm.classList.add('article-section--collapsed');\n        $headerLink.classList.add('article-section__header_link--closed');\n        $body.classList.add('visuallyhidden');\n      } else {\n        // Defensive: remove classes if they turn up here when they shouldn't\n        $headerLink.classList.remove('article-section__header_link--closed');\n        $body.classList.remove('visuallyhidden');\n      }\n    }\n  }, {\n    key: 'viewportNoWiderThan',\n    value: function viewportNoWiderThan(thresholdInPx) {\n      return this.window.matchMedia('(max-width: ' + thresholdInPx + 'px)').matches;\n    }\n  }, {\n    key: 'toggleState',\n    value: function toggleState(e) {\n      e.preventDefault();\n      this.$headerLink.classList.toggle('article-section__header_link--closed');\n      this.$elm.classList.toggle('article-section--collapsed');\n      this.$body.classList.toggle('visuallyhidden');\n    }\n  }, {\n    key: 'handleSectionOpeningViaHash',\n    value: function handleSectionOpeningViaHash(e) {\n\n      // TODO: Code similar to that in Audipplayer.seekNewTime(), consider refactoring out into common\n      var hash = '';\n\n      // event was hashChange\n      if (!!e.newURL) {\n        hash = e.newURL.substring(e.newURL.indexOf('#') + 1);\n      } else {\n        hash = this.window.location.hash.substring(1);\n      }\n\n      if (!hash) {\n        return false;\n      }\n\n      if (ArticleSection.isFragmentForCollapsibleSection(hash, this.doc)) {\n        ArticleSection.openSection(this);\n      }\n    }\n  }], [{\n    key: 'openSection',\n    value: function openSection(section) {\n      section.$headerLink.classList.remove('article-section__header_link--closed');\n      section.$elm.classList.remove('article-section--collapsed');\n      section.$body.classList.remove('visuallyhidden');\n    }\n  }, {\n    key: 'isFragmentForCollapsibleSection',\n    value: function isFragmentForCollapsibleSection(fragment, document) {\n      var $elFromFragmentId = document.querySelector('#' + fragment);\n      if (!$elFromFragmentId) {\n        return false;\n      }\n\n      var behaviour = $elFromFragmentId.dataset.behaviour;\n      return behaviour && behaviour.indexOf('ArticleSection') > -1;\n    }\n  }]);\n\n  return ArticleSection;\n}();\n\n},{}],3:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = require('../libs/elife-utils')();\nmodule.exports = function () {\n  function AudioPlayer($elm) {\n    var _this = this;\n\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, AudioPlayer);\n\n    if (!$elm) {\n      console.warn('No element provided');\n      return;\n    }\n\n    this.window = _window;\n    if (!this.window.HTMLAudioElement) {\n      console.warn('Audio element not supported');\n      return;\n    }\n\n    console.log('Initialising Audio Player...');\n\n    this.$elm = $elm;\n    this.$audioElement = this.$elm.querySelector('audio');\n    if (!this.$audioElement) {\n      console.warn('No audio element found');\n      return;\n    }\n\n    this.uniqueId = utils.uniqueIds.get('audio', doc);\n    this.$elm.id = this.uniqueId;\n    this.$playButton = AudioPlayer.buildPlayButton(this);\n    this.$icon = this.$playButton.querySelector('.audio-player__toggle_play_icon');\n\n    // $title must be prepared before buildProgressIndicator is called\n    this.$title = this.prepare$title(this.$elm.querySelector('.audio-player__header'), doc);\n    this.$progressTrack = AudioPlayer.buildProgressIndicator(this);\n    this.$progressBar = this.$progressTrack.querySelector('[class*=\"progress_bar\"]');\n    this.$timeIndicators = AudioPlayer.buildTimeIndicators(this);\n    this.$currentTime = this.$timeIndicators.querySelector('[class*=\"current_time\"]');\n    this.$duration = this.$timeIndicators.querySelector('[class*=\"duration\"]');\n\n    // state\n    this.duration = null;\n    this.isPlaying = false;\n\n    this.$elm.classList.add('audio-player--js');\n\n    this.$playButton.classList.add('loading');\n    this.$audioElement.addEventListener('loadedmetadata', function () {\n      _this.playerReady(_this);\n    });\n\n    this.usingMetadata = false; // set to true in loadMetadata if no errors thrown\n    this.loadMetadata(this.$elm.dataset.episodeNumber);\n  }\n\n  _createClass(AudioPlayer, [{\n    key: 'playerReady',\n    value: function playerReady(player) {\n      player.duration = player.$audioElement.duration;\n      player.$duration.innerHTML = AudioPlayer.secondsToMinutes(player.duration);\n      player.$playButton.addEventListener('click', function () {\n        player.togglePlay(player.$audioElement, player.$playButton);\n      }, false);\n      player.$audioElement.addEventListener('timeupdate', player.update.bind(player));\n      player.window.addEventListener('hashchange', player.seekNewTime.bind(player));\n      player.window.addEventListener('load', player.seekNewTime.bind(player));\n      this.$playButton.classList.remove('loading');\n\n      var playerReady = void 0;\n      try {\n        playerReady = new CustomEvent('playerReady', { detail: this.uniqueId });\n      } catch (e) {\n        // CustomEvent not supported, do it the old fashioned way\n        playerReady = document.createEvent('playerReady');\n        playerReady.initCustomEvent('playerReady', true, true, { detail: this.uniqueId });\n      }\n\n      player.window.dispatchEvent(playerReady);\n    }\n  }, {\n    key: 'prepare$title',\n    value: function prepare$title(parent, doc) {\n      var span = doc.createElement('span');\n      try {\n        span.innerHTML = parent.innerHTML;\n      } catch (e) {\n        return;\n      }\n\n      span.classList.add('audio-player__title');\n      parent.innerHTML = '';\n      parent.appendChild(span);\n      return span;\n    }\n\n    /**\n     * Converts seconds to a display of minutes & seconds.\n     *\n     * @param {Number} seconds The time to convert, in seconds\n     * @returns {string} The time in a [m]m:ss string\n     */\n\n  }, {\n    key: 'togglePlay',\n\n\n    //noinspection JSValidateJSDoc\n    /**\n     * Toggles play/pause state of media file.\n     *\n     * @param {HTMLAudioElement} $audioElement The audio element to toggle the play state of\n     * @param {HTMLButtonElement} $togglePlayButton The button controlling the playback\n     */\n    value: function togglePlay($audioElement, $togglePlayButton) {\n      if (this.isPlaying) {\n        this.pause($audioElement, $togglePlayButton);\n      } else {\n        this.play($audioElement, $togglePlayButton);\n      }\n    }\n  }, {\n    key: 'play',\n    value: function play($audioElement, $togglePlayButton) {\n      $audioElement.play();\n      AudioPlayer.updateIconState(this.$icon, 'pause');\n      $togglePlayButton.classList.add('audio-player__toggle_play--pauseable');\n      $togglePlayButton.classList.remove('audio-player__toggle_play--playable');\n      this.isPlaying = true;\n    }\n  }, {\n    key: 'pause',\n    value: function pause($audioElement, $togglePlayButton) {\n      $audioElement.pause();\n      AudioPlayer.updateIconState(this.$icon, 'play');\n      $togglePlayButton.classList.add('audio-player__toggle_play--playable');\n      $togglePlayButton.classList.remove('audio-player__toggle_play--pauseable');\n      this.isPlaying = false;\n    }\n\n    /**\n     * Update the progress bar and elapsed time indicator based on track's current time.\n     */\n\n  }, {\n    key: 'update',\n    value: function update() {\n      var currentTime = Math.floor(this.$audioElement.currentTime);\n      var pc = currentTime / this.duration * 100;\n      var currentTime2Dis = AudioPlayer.secondsToMinutes(currentTime);\n      this.$progressBar.style.width = pc + '%';\n      this.$currentTime.innerHTML = currentTime2Dis;\n\n      if (this.usingMetadata) {\n        var chapterNumberOnLastUpdate = this.getCurrentChapterNumber();\n        this.setCurrentChapterMetadata(this.getChapterMetadataAtTime(currentTime, this.chapterMetadata));\n        if (this.getCurrentChapterMetadata().number !== chapterNumberOnLastUpdate) {\n          this.changeChapter(this.getCurrentChapterNumber(), this.getCurrentChapterMetadata().title, this.$elm);\n        }\n      }\n\n      if (this.$audioElement.ended) {\n        AudioPlayer.updateIconState(this.$icon, 'play');\n        this.isPlaying = false;\n      }\n    }\n\n    /**\n     * Updates player title with chapter number & name, and dispatches chapterChanged event.\n     *\n     * @param {int} number New chapter number Used as value of detail property of\n     * @param {String} title new chapter title\n     * @param {HTMLElement} $elm Element from which to dispatch the event\n     */\n\n  }, {\n    key: 'changeChapter',\n    value: function changeChapter(number, title, $elm) {\n      this.setTitle(this.episodeTitle, title);\n      var chapterChanged = void 0;\n      try {\n        chapterChanged = new CustomEvent('chapterChanged', { detail: number });\n      } catch (e) {\n        // CustomEvent not supported, do it the old fashioned way\n        chapterChanged = document.createEvent('chapterChanged');\n        chapterChanged.initCustomEvent('chapterChanged', true, true, { detail: number });\n      }\n\n      $elm.dispatchEvent(chapterChanged);\n    }\n\n    /**\n     * Updates the icon state for the play button.\n     *\n     * @param $icon {HTMLImageElement} The img to update\n     * @param state {string} The state to update to (either 'play' or 'pause')\n     */\n\n  }, {\n    key: 'seekNewTime',\n    value: function seekNewTime(e) {\n      var hash;\n      var shouldPlay = false;\n      try {\n        hash = e.newURL.substring(e.newURL.indexOf('#') + 1);\n\n        // Should play when chapter changed within the page, but not autoplay on page load :-)\n        shouldPlay = true;\n      } catch (e) {\n        // newURL only available on hashchange event, but load event may also invoke this handler\n        hash = this.window.location.hash.substring(1);\n        shouldPlay = false;\n      }\n\n      if (!isNaN(hash) && hash >= 0) {\n        this.seek(hash, this.$audioElement);\n        if (!this.isPlaying && shouldPlay) {\n          this.play(this.$audioElement, this.$playButton);\n        }\n      }\n    }\n\n    /**\n     * Event handler to determine track seek time in response to user interaction.\n     *\n     * @param e The user-generated click event\n     * @param {AudioPlayer} player The audio player object that the new element belongs to\n     */\n\n  }, {\n    key: 'handleSeek',\n    value: function handleSeek(e, player) {\n      var newSeekPosition = parseInt(e.offsetX, 10);\n      var availableWidth = player.$progressTrack.clientWidth;\n      var durationProportionToSeek = newSeekPosition / parseInt(availableWidth, 10);\n      this.seek(durationProportionToSeek * player.duration, player.$audioElement);\n    }\n\n    //noinspection JSValidateJSDoc\n    /**\n     * Seeks a particular time in the media file.\n     *\n     * @param {Number} time The time to seek\n     * @param {HTMLAudioElement} $audioElement The audio element to toggle the play state of\n     */\n\n  }, {\n    key: 'seek',\n    value: function seek(time, $audioElement) {\n      $audioElement.currentTime = time;\n      this.update();\n    }\n\n    /**\n     * Builds the progress indicator.\n     *\n     * @param {AudioPlayer} player The audio player object that the new element belongs to\n     * @returns {Element} The progress indicator\n     */\n\n  }, {\n    key: 'setTitle',\n\n\n    /**\n     * Set the title based on both episode and chapter titles\n     * @param episodeTitle\n     * @param chapterTitle\n     */\n    value: function setTitle(episodeTitle, chapterTitle) {\n      this.title = episodeTitle;\n      if (!!chapterTitle) {\n        this.title += ': ' + chapterTitle;\n      }\n\n      this.$title.innerHTML = this.title;\n    }\n  }, {\n    key: 'getCurrentChapterMetadata',\n    value: function getCurrentChapterMetadata() {\n      return this.currentChapterMetadata;\n    }\n  }, {\n    key: 'setCurrentChapterMetadata',\n    value: function setCurrentChapterMetadata(metadata) {\n      this.currentChapterMetadata = metadata;\n    }\n  }, {\n    key: 'getCurrentChapterNumber',\n    value: function getCurrentChapterNumber() {\n      return this.getCurrentChapterMetadata().number || 0;\n    }\n\n    /**\n     * Returns a chapter's title and number, based on the playback position\n     * @param time\n     * @param {Array} chapterMetadata\n     * An array of objects that must contain as a minimum\n     * @returns {*}\n     */\n\n  }, {\n    key: 'getChapterMetadataAtTime',\n    value: function getChapterMetadataAtTime(time, chapterMetadata) {\n      if (!chapterMetadata) {\n        return '';\n      }\n\n      var chapterTitle = '';\n      var chapterNumber = 0;\n      chapterMetadata.forEach(function (chapter, i, chapters) {\n        var chapterStartTime = parseInt(chapter.time, 10);\n        var nextChapterStartTime = i < chapters.length - 1 ? chapters[i + 1].time : null;\n        if (time >= chapterStartTime) {\n          if (!nextChapterStartTime || time < nextChapterStartTime) {\n            chapterTitle = chapter.title;\n            chapterNumber = chapter.number;\n          }\n        }\n      });\n\n      return {\n        title: chapterTitle,\n        number: chapterNumber\n      };\n    }\n\n    /**\n     * Sets episode title and respective chapter information from metadata\n     * @param metadata\n     */\n\n  }, {\n    key: 'processMetadata',\n    value: function processMetadata(metadata) {\n      this.episodeTitle = 'Episode ' + metadata.number;\n      this.setTitle(this.episodeTitle);\n\n      this.chapterMetadata = this.prepareChapterMetadata(metadata);\n      this.currentChapterMetadata = { number: 0, title: '' };\n    }\n\n    /**\n     * Returns array of objects describing respective chapter information\n     * @param metadata\n     * @returns {Array} of objects containing time, number and title properties\n     */\n\n  }, {\n    key: 'prepareChapterMetadata',\n    value: function prepareChapterMetadata(metadata) {\n      var chapterMetadata = [];\n      metadata.chapters.forEach(function (chapter) {\n        chapterMetadata.push({\n          time: chapter.time,\n          number: chapter.number,\n          title: chapter.number + '. ' + chapter.title\n        });\n      });\n\n      return chapterMetadata;\n    }\n\n    /**\n     * Metadata is expected in the data-metadata attribute of $elm as a JSON-like string with single-\n     * quoted instead of double-quoted values.\n     */\n\n  }, {\n    key: 'loadMetadata',\n    value: function loadMetadata() {\n      try {\n        this.processMetadata(JSON.parse(this.$elm.dataset.metadata.replace(/'/g, '\"')));\n        this.usingMetadata = true;\n      } catch (e) {\n        console.error(e);\n        this.usingMetadata = false;\n      }\n    }\n  }], [{\n    key: 'secondsToMinutes',\n    value: function secondsToMinutes(seconds) {\n      var _seconds = parseInt(seconds, 10);\n      var mins = Math.floor(_seconds / 60);\n      var secs = _seconds % 60;\n      if (secs <= 9) {\n        secs = '0' + secs;\n      }\n\n      return mins + ':' + secs;\n    }\n  }, {\n    key: 'updateIconState',\n    value: function updateIconState($icon, state) {\n      if (state !== 'play' && state !== 'pause') {\n\n        return;\n      }\n\n      $icon.src = AudioPlayer.getIconPath(state);\n      $icon.alt = state;\n    }\n  }, {\n    key: 'buildProgressIndicator',\n    value: function buildProgressIndicator(player) {\n      var $barWrapper = utils.buildElement('div', ['audio-player__progress'], '', '#' + player.uniqueId + ' [class*=\"audio-player__container\"]');\n\n      utils.buildElement('div', ['audio-player__progress_bar'], '', $barWrapper);\n\n      $barWrapper.addEventListener('click', function (e) {\n        player.handleSeek(e, player);\n      }, false);\n\n      return $barWrapper;\n    }\n\n    /**\n     * Builds the play button.\n     *\n     * @param {AudioPlayer} player The audio player object that the new element belongs to\n     * @returns {Element} The play/pause button\n     */\n\n  }, {\n    key: 'buildPlayButton',\n    value: function buildPlayButton(player) {\n      var $button = utils.buildElement('button', ['audio-player__toggle_play'], '', '#' + player.uniqueId + ' [class*=\"audio-player\"]', true);\n      var $image = utils.buildElement('img', ['audio-player__toggle_play_icon'], '', $button);\n      $image.src = AudioPlayer.getIconPath('play');\n      $image.alt = 'Play';\n      return $button;\n    }\n\n    /**\n     * Builds the current time and duration indicators.\n     *\n     * @param {AudioPlayer} player The audio player object that the new element belongs to\n     * @returns {Element} An element containing the current time and duration indicators.\n     */\n\n  }, {\n    key: 'buildTimeIndicators',\n    value: function buildTimeIndicators(player) {\n      var playerId = player.uniqueId;\n      var $container = utils.buildElement('div', ['audio-player__times'], '', '#' + playerId + ' [class*=audio-player__header]', true);\n\n      utils.buildElement('span', ['audio-player__current_time'], '0:00', $container);\n      utils.buildElement('span', ['audio-player__duration'], '0:00', $container);\n      return $container;\n    }\n  }, {\n    key: 'getIconPath',\n    value: function getIconPath(iconName) {\n\n      if (iconName !== 'play' && iconName !== 'pause') {\n        return;\n      }\n\n      return '../../assets/img/icons/audio-' + iconName + '.svg';\n    }\n  }]);\n\n  return AudioPlayer;\n}();\n\n},{\"../libs/elife-utils\":13}],4:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = function () {\n  function BackgroundImage($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, BackgroundImage);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n\n    this.sourceToUse = null;\n    this.thresholdWidth = parseInt(this.$elm.dataset.thresholdWidth, 10);\n    if (this.isValidThreshold(this.thresholdWidth) && !this.isThresholdMet(this.thresholdWidth, this.window.innerWidth)) {\n      this.window.addEventListener('resize', this.resizeHandler.bind(this));\n    } else {\n      this.init();\n    }\n  }\n\n  _createClass(BackgroundImage, [{\n    key: 'init',\n    value: function init() {\n      this.sourceToUse = this.calcSourceToUse(this.$elm, utils.isHighDpr(this.window));\n      this.setDarkBackground();\n      this.setupEventHandlers(this.$elm, this.setLightBackground.bind(this), this.setDarkBackground.bind(this));\n    }\n  }, {\n    key: 'isValidThreshold',\n    value: function isValidThreshold(candidate) {\n      return !(typeof candidate === 'boolean' || candidate === null || Array.isArray(candidate) || isNaN(candidate) || candidate < 0);\n    }\n  }, {\n    key: 'isThresholdMet',\n    value: function isThresholdMet(threshold, viewportWidth) {\n      return viewportWidth >= threshold;\n    }\n  }, {\n    key: 'resizeHandler',\n    value: function resizeHandler() {\n      if (this.isThresholdMet(this.thresholdWidth, this.window.innerWidth)) {\n        this.window.removeEventListener('resize', this.resizeHandler.bind(this));\n        this.init();\n      }\n    }\n  }, {\n    key: 'setupEventHandlers',\n    value: function setupEventHandlers($elm, setLightBackground, setDarkBackground) {\n      if ($elm.getAttribute('data-invert-bgcol-on-hover') !== null) {\n        $elm.addEventListener('mouseenter', setLightBackground);\n        $elm.addEventListener('mouseleave', setDarkBackground);\n      }\n    }\n  }, {\n    key: 'setDarkBackground',\n    value: function setDarkBackground() {\n      if (!!this.sourceToUse) {\n        this.$elm.style.backgroundImage = this.getBackgroundImagesString(this.sourceToUse, 'linear-gradient(to top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5))');\n        this.$elm.style.color = '#fff';\n      }\n    }\n  }, {\n    key: 'setLightBackground',\n    value: function setLightBackground() {\n      if (!!this.sourceToUse) {\n        this.$elm.style.backgroundImage = this.getBackgroundImagesString(this.sourceToUse, 'linear-gradient(to top, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5))');\n        this.$elm.style.color = '#212121';\n      }\n    }\n  }, {\n    key: 'getBackgroundImagesString',\n    value: function getBackgroundImagesString(path, grandient) {\n      if (!path || !path.length || path.length === 0) {\n        return '';\n      }\n\n      return grandient + ', url(' + path + ')';\n    }\n  }, {\n    key: 'calcSourceToUse',\n    value: function calcSourceToUse(sourceDefiner, isHighDpr) {\n      var lowResSource = '';\n      var highResSource = '';\n      if (!sourceDefiner) {\n        return '';\n      }\n\n      if (!!sourceDefiner.dataset) {\n        highResSource = sourceDefiner.dataset.highResImageSource;\n        lowResSource = sourceDefiner.dataset.lowResImageSource;\n      } else {\n        highResSource = sourceDefiner.getAttribute('data-highResImageSource');\n        lowResSource = sourceDefiner.getAttribute('data-lowResImageSource');\n      }\n\n      if (isHighDpr && !highResSource || !isHighDpr && !lowResSource) {\n        return '';\n      }\n\n      if (isHighDpr) {\n        return highResSource;\n      }\n\n      return lowResSource;\n    }\n  }]);\n\n  return BackgroundImage;\n}();\n\n},{\"../libs/elife-utils\":13}],5:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  function ContentHeaderArticle($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, ContentHeaderArticle);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n    this.$elm.classList.add('content-header-article--js');\n\n    // Should track SASS variable $bkpt-content-header--medium-width.\n    this.breakpointInPx = 768;\n    this.currentView = this.calcCurrentView(this.breakpointInPx);\n\n    this.authors = $elm.querySelectorAll('.content-header__author_list_item');\n    this.institutions = $elm.querySelectorAll('.content-header__institution_list_item');\n\n    this.hasToggleAuthor = false;\n    this.hasToggleInstitution = false;\n    this.hideAllExcessItems('author', this.authors);\n    this.hideAllExcessItems('institution', this.institutions);\n\n    var _this = this;\n    this.window.addEventListener('resize', function () {\n      var newView = _this.calcCurrentView(_this.breakpointInPx);\n      if (newView !== _this.currentView) {\n        _this.currentView = newView;\n        _this.handleAnyExcessItems('author', _this.authors);\n        _this.handleAnyExcessItems('institution', _this.institutions);\n      }\n    });\n  }\n\n  _createClass(ContentHeaderArticle, [{\n    key: 'handleAnyExcessItems',\n    value: function handleAnyExcessItems(itemType, items) {\n      var toggle = this.$elm.querySelector('.content-header__item_toggle');\n      if (toggle && toggle.innerHTML.indexOf('less') > -1 && this.currentView === 'wide') {\n        this.clearExcessMark(items);\n        this.toggleExcessItems(items);\n      } else {\n        this.clearExcessMark(items);\n        var excessItems = this.getExcessItems(itemType, items);\n        this.markAsExcess(excessItems);\n        this.toggleExcessItems(items);\n        this.markLastNonExcessItem(itemType, items);\n      }\n    }\n\n    /**\n     * Determine excess by itemType from items supplied and hides those.\n     *\n     * @param {string} itemType 'author' or 'institution'\n     * @param {DOMTokenList} items List of items to identify the excess within, and hide those\n     */\n\n  }, {\n    key: 'hideAllExcessItems',\n    value: function hideAllExcessItems(itemType, items) {\n      var excessItems = this.getExcessItems(itemType, items);\n      this.markAsExcess(excessItems);\n      this.toggleExcessItems(items);\n      this.addTrailingText(itemType, items);\n    }\n\n    /**\n     * Returns max number authors or institutions to be displayed by default at current screen width.\n     *\n     * Returns null if itemType is invalid.\n     *\n     * @param {string} itemType 'author' or 'institution'\n     * @returns {number|null} Number of the type of item to display by default at current screen width\n     */\n\n  }, {\n    key: 'getDefaultMaxItems',\n    value: function getDefaultMaxItems(itemType) {\n      if (this.currentView === 'wide') {\n        if (itemType === 'author') {\n          return 16;\n        }\n\n        if (itemType === 'institution') {\n          return 10;\n        }\n      } else {\n        if (itemType === 'author') {\n          return 1;\n        }\n\n        if (itemType === 'institution') {\n          return 0;\n        }\n      }\n\n      return null;\n    }\n\n    /**\n     * Returns array of elements in excess of the default max items, or null if itemType invalid.\n     *\n     * The returned array is a subset of the list supplied, or empty if there are no excess items.\n     *\n     * @param {string} itemType 'author' or 'institution'\n     * @param {DOMTokenList} items List of items from which to identify the excess\n     * @returns {Array|null} Items in excess of the default maximum for the current screen width\n     */\n\n  }, {\n    key: 'getExcessItems',\n    value: function getExcessItems(itemType, items) {\n      if (itemType !== 'author' && itemType !== 'institution') {\n        return null;\n      }\n\n      var defaultMaxItems = this.getDefaultMaxItems(itemType);\n      if (items.length > defaultMaxItems) {\n        return [].slice.call(items, defaultMaxItems);\n      }\n\n      return [];\n    }\n\n    /**\n     * Marks supplied list elements as excess.\n     *\n     * @param {Array} els The elements to mark as excess\n     */\n\n  }, {\n    key: 'markAsExcess',\n    value: function markAsExcess(els) {\n      els.forEach(function ($el) {\n        $el.classList.add('excess-item');\n      });\n    }\n\n    /**\n     * Clears any excess mark from all elements in the supplied list.\n     *\n     * @param {DOMTokenList} els The elements to clear the excess mark from\n     */\n\n  }, {\n    key: 'clearExcessMark',\n    value: function clearExcessMark(els) {\n      [].forEach.call(els, function ($el) {\n        $el.classList.remove('excess-item');\n      });\n    }\n\n    /**\n     * Toggles the display of any excess items found in the supplied list of elements.\n      * @param {DOMTokenList} items The elements to inspect for excess items, and to toggle those found\n     */\n\n  }, {\n    key: 'toggleExcessItems',\n    value: function toggleExcessItems(items) {\n      [].forEach.call(items, function (item) {\n        if (item.classList.contains('excess-item')) {\n          item.classList.add('visuallyhidden');\n        } else {\n          item.classList.remove('visuallyhidden');\n        }\n      });\n    }\n\n    /**\n     * Returns the name of the current view.\n     *\n     * @param {number} breakpoint The px viewport width that determines the view.\n     *\n     * @returns {string} the view name ('wide' or 'narrow').\n     */\n\n  }, {\n    key: 'calcCurrentView',\n    value: function calcCurrentView(breakpoint) {\n      return this.window.matchMedia('(min-width: ' + breakpoint + 'px)').matches ? 'wide' : 'narrow';\n    }\n\n    /**\n     * Marks the last shown non-excess item with particlular class (so not if showing last in list).\n     *\n     * @param {string} itemType 'author' or 'institution'\n     * @param {DOMTokenList} items List of items to act upon\n     */\n\n  }, {\n    key: 'markLastNonExcessItem',\n    value: function markLastNonExcessItem(itemType, items) {\n      var lastShownIndex = null;\n      var foundLastShown = false;\n      [].forEach.call(items, function (item, i) {\n\n        // Clear old any obsolete determination of what's the last non-excess item.\n        items[i].classList.remove('content-header__' + itemType + '--last-non-excess');\n        if (item.classList.contains('excess-item') && !foundLastShown) {\n          lastShownIndex = i - 1;\n          foundLastShown = true;\n        }\n      });\n\n      if (lastShownIndex !== null && lastShownIndex > -1) {\n        var lastShown = items[lastShownIndex].querySelector('.content-header__' + itemType);\n        if (lastShown) {\n          lastShown.classList.add('content-header__' + itemType + '--last-non-excess');\n        }\n      }\n    }\n\n    /**\n     * Adds trailing text to the visible end of truncated author & institution lists & builds toggle.\n     *\n     * @param {string} itemType The type of items supplied\n     * @param {DOMTokenList} items The items to which to add the trailing text\n     */\n\n  }, {\n    key: 'addTrailingText',\n    value: function addTrailingText(itemType, items) {\n      if (itemType === 'author' && items.length > this.getDefaultMaxItems('author')) {\n        if (!this.hasToggleAuthor) {\n          this.buildSeeMoreLessToggle('author');\n          this.hasToggleAuthor = true;\n        }\n      }\n\n      if (itemType === 'institution' && items.length > this.getDefaultMaxItems('institution')) {\n        if (!this.hasToggleInstitution) {\n          this.buildSeeMoreLessToggle('institution');\n          this.hasToggleInstitution = true;\n        }\n      }\n\n      this.markLastNonExcessItem(itemType, items);\n    }\n\n    /**\n     * Builds the show/hide toggle for excess authors & institutions.\n     */\n\n  }, {\n    key: 'buildSeeMoreLessToggle',\n    value: function buildSeeMoreLessToggle(itemType) {\n      var _this2 = this;\n\n      // This toggle only required due to screen width constraints. All content already accessible as\n      // it's not being hidden in the first place. Hence an aria-hidden li, rather than an anchor.\n      // Should conform to https://www.w3.org/TR/wai-aria/states_and_properties#aria-hidden\n      var toggle = this.doc.createElement('li');\n      var toggleOnText = 'see&nbsp;all';\n      var toggleOffText = 'see&nbsp;less';\n      toggle.setAttribute('aria-hidden', 'true');\n      toggle.classList.add('content-header__item_toggle', 'content-header__item_toggle--' + itemType);\n      toggle.innerHTML = '&nbsp;&hellip;&nbsp;' + toggleOnText;\n      toggle.addEventListener('click', function (e) {\n        var target = e.target;\n        if (target.innerHTML.indexOf(toggleOnText) > -1) {\n          [].forEach.call(_this2.doc.querySelectorAll('.content-header__item_toggle'), function (item) {\n            item.innerHTML = '&nbsp;' + toggleOffText;\n          });\n          _this2.clearExcessMark(_this2.authors);\n          _this2.clearExcessMark(_this2.institutions);\n          _this2.toggleExcessItems(_this2.authors);\n          _this2.toggleExcessItems(_this2.institutions);\n        } else {\n          [].forEach.call(_this2.doc.querySelectorAll('.content-header__item_toggle'), function (item) {\n            item.innerHTML = '&nbsp;&hellip;&nbsp;' + toggleOnText;\n          });\n          _this2.hideAllExcessItems('author', _this2.authors);\n          _this2.hideAllExcessItems('institution', _this2.institutions);\n        }\n      });\n      this.$elm.querySelector('.content-header__' + itemType + '_list').appendChild(toggle);\n    }\n  }]);\n\n  return ContentHeaderArticle;\n}();\n\n},{}],6:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  function MainMenu($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, MainMenu);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n  }\n\n  /**\n   * Moves main menu from default non-js DOM position into position required by js implementation.\n   */\n\n\n  _createClass(MainMenu, [{\n    key: 'moveWithinDom',\n    value: function moveWithinDom() {\n      this.$elm.classList.add('main-menu--js');\n      var $globalWrapper = this.doc.querySelector('.global-wrapper');\n      if (!!$globalWrapper) {\n        $globalWrapper.insertBefore(this.$elm, $globalWrapper.firstElementChild);\n      }\n    }\n\n    /**\n     * Indicates whether the main menu is currently open.\n     *\n     * @returns {boolean} true if the main menu is currently open\n     */\n\n  }, {\n    key: 'isOpen',\n    value: function isOpen() {\n      return this.$elm.classList.contains('main-menu--shown');\n    }\n\n    /**\n     * Closes the main menu\n     */\n\n  }, {\n    key: 'close',\n    value: function close() {\n      this.$elm.classList.remove('main-menu--shown');\n      this.doc.querySelector('.global-wrapper').classList.remove('pull-offscreen-right');\n    }\n\n    /**\n     * Opens the main menu\n     */\n\n  }, {\n    key: 'open',\n    value: function open() {\n      this.$elm.classList.add('main-menu--shown');\n      this.doc.querySelector('.global-wrapper').classList.add('pull-offscreen-right');\n    }\n  }]);\n\n  return MainMenu;\n}();\n\n},{}],7:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  function MediaChapterListingItem($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, MediaChapterListingItem);\n\n    if (!$elm) {\n      console.warn('No element provided');\n      return;\n    }\n\n    console.log('Initialising Chapter listing item...');\n\n    this.$elm = $elm;\n    this.startTime = $elm.dataset.startTime;\n    if (!this.startTime || isNaN(this.startTime) || this.startTime < 0) {\n      return;\n    }\n\n    this.window = _window;\n    this.document = doc;\n\n    // When ready, AudioPlayer dispatches a custom event 'playerReady' on window, that supplies that\n    // player's html element id.\n    _window.addEventListener('playerReady', this.listenForChapterChange.bind(this));\n    this.$link = this.createLink(doc, this.$elm, this.startTime);\n    this.setupEventHandlers(this.$link);\n  }\n\n  _createClass(MediaChapterListingItem, [{\n    key: 'listenForChapterChange',\n    value: function listenForChapterChange(e) {\n      var $player = this.document.querySelector('#' + e.detail);\n      if (!!$player) {\n        $player.addEventListener('chapterChanged', this.indicateChapterChanged.bind(this));\n      }\n    }\n  }, {\n    key: 'createLink',\n    value: function createLink(document, $rootElm, startTime) {\n      var $title = $rootElm.querySelector('.teaser__header_text');\n      if (!$title) {\n        return;\n      }\n\n      var titleText = void 0;\n      var $existingLink = void 0;\n      try {\n        $existingLink = $title.querySelector('.teaser__header_text_link');\n        titleText = $existingLink.innerHTML;\n        $existingLink.parentNode.removeChild($existingLink);\n      } catch (e) {\n        titleText = $title.innerHTML;\n      }\n\n      var $link = document.createElement('a');\n      $link.innerHTML = titleText;\n      $link.setAttribute('href', '#' + startTime);\n      $link.classList.add('teaser__header_text_link');\n      $title.innerHTML = '';\n      $title.appendChild($link);\n      return $link;\n    }\n  }, {\n    key: 'indicateChapterChanged',\n    value: function indicateChapterChanged(e) {\n      var currentChapterNumber = e.detail;\n      if (currentChapterNumber === this.window.parseInt(this.$elm.dataset.chapterNumber)) {\n        this.$elm.classList.add('current-chapter');\n      } else {\n        this.$elm.classList.remove('current-chapter');\n      }\n    }\n  }, {\n    key: 'setupEventHandlers',\n    value: function setupEventHandlers($link) {\n      $link.addEventListener('chapterChanged', this.indicateChapterChanged);\n    }\n  }]);\n\n  return MediaChapterListingItem;\n}();\n\n},{}],8:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = function () {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  function SearchBox($elm) {\n    var _this = this;\n\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, SearchBox);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.$container = $elm.querySelector('fieldset');\n    this.$form = $elm.querySelector('form');\n    this.$input = $elm.querySelector('input[type=\"search\"]');\n    this.$limit = $elm.querySelector('input[type=\"checkbox\"]');\n    this.$elm = $elm;\n    this.$searchButton = $elm.querySelector('button[type=\"submit\"]');\n    this.$resetButton = $elm.querySelector('button[type=\"reset\"]');\n    this.$inner = $elm.querySelector('.search-box__inner');\n\n    // Check there's a search input field, if not everything else is pointless.\n    if (!this.$input) {\n      return;\n    }\n\n    // TODO: Remove if not ultimately useful.\n    this.isSearchLimited = this.$limit && this.$limit.checked;\n\n    this.$elm.classList.add('search-box--js');\n\n    // setup\n    this.$form.setAttribute('autocomplete', 'off');\n\n    if (!doc.querySelector('.search-box__output')) {\n      this.$output = doc.createElement('div');\n      this.$output.innerHTML = '';\n      this.$output.classList.add('search-box__output');\n      this.$output.addEventListener('keyup', function (e) {\n        SearchBox.handleKeyEntry(e, _this);\n      });\n      this.$output.addEventListener('click', function (e) {\n        _this.useSuggestion(e.target);\n      });\n      this.$inner.appendChild(this.$output);\n    }\n\n    this.keywords = [];\n\n    // events\n    this.$resetButton.addEventListener('click', this.reset.bind(this));\n    this.$input.addEventListener('keyup', function (e) {\n      SearchBox.handleKeyEntry(e, _this);\n    });\n    this.$input.addEventListener('paste', this.showResetButton.bind(this));\n\n    // TODO: Remove this test data when decided how to populate this list of keywords with real data\n    SearchBox.setKeywords(['Xiao-Dong Li', 'Zhijian J Chen', 'Cell biology', 'Immunology', 'bacteria'], this);\n  }\n\n  /**\n   * Handles the reset button being pressed.\n   */\n\n\n  _createClass(SearchBox, [{\n    key: 'reset',\n    value: function reset() {\n      this.hideResetButton();\n      if (this.$output) {\n        this.$output.innerHTML = '';\n      }\n\n      this.$input.focus();\n    }\n\n    /**\n     * Hides the reset button.\n     */\n\n  }, {\n    key: 'hideResetButton',\n    value: function hideResetButton() {\n      this.$elm.classList.remove('search-box--populated');\n    }\n\n    /**\n     * Shows the reset button.\n     */\n\n  }, {\n    key: 'showResetButton',\n    value: function showResetButton() {\n      this.$elm.classList.add('search-box--populated');\n    }\n\n    /**\n     * Responds to the keyCode of a KeyboardEvent (used on the input field and suggestions).\n     *\n     * Takes care not to trap the tab character. Accessibility!\n     * Down arrow (keyCode 40): go to the next suggestion.\n     * Up arrow (keyCode 38): go to the previous suggestion.\n     * Return (keyCode 13): put the text of the current suggestion into the search box\n     * Any other key: use it to filter keywords; also show/hide reset button.\n     *\n     * @param {KeyboardEvent} e The event to respond to\n     * @param {SearchBox} searchBox Calling object (injected to make method more testable)\n     */\n\n  }, {\n    key: 'nextSuggestion',\n\n\n    /**\n     * Selects the search suggestion element after the current one.\n     *\n     * If already on the last one, loop to the beginning and select the input field.\n     *\n     * @param {HTMLElement} current The search suggestion or input field currently with focus\n     */\n    value: function nextSuggestion(current) {\n      if (!this.$output) {\n        return;\n      }\n\n      if (current === this.$input) {\n        this.$output.querySelector('ul li:first-child').focus();\n      } else if (!!current.nextElementSibling) {\n        current.nextElementSibling.focus();\n      } else {\n        this.$input.focus();\n      }\n    }\n\n    /**\n     * Selects the search suggestion element before the current one.\n     *\n     * If already on the input field, loop to the end and select the last one.\n     *\n     * @param {HTMLElement} current The search suggestion or input field currently with focus\n     */\n\n  }, {\n    key: 'prevSuggestion',\n    value: function prevSuggestion(current) {\n      if (!this.$output) {\n        return;\n      }\n\n      if (current === this.$input) {\n        this.$output.querySelector('ul li:last-child').focus();\n      } else if (!!current.previousElementSibling) {\n        current.previousElementSibling.focus();\n      } else {\n        this.$input.focus();\n      }\n    }\n\n    /**\n     * Copy the display text of the current suggestion into the search field.\n     *\n     * @param {HTMLElement} target The element containing the text to use\n     */\n\n  }, {\n    key: 'useSuggestion',\n    value: function useSuggestion(target) {\n      this.$input.value = target.innerHTML.replace(/<\\/?strong>/g, '');\n      if (this.$output) {\n        this.$output.innerHTML = '';\n        if (this.$input.value.length) {\n          this.$form.submit();\n        }\n      }\n    }\n\n    /**\n     * Gets the keywords for the supplied searchBox.\n     *\n     * @param {SearchBox} searchBox The injected search box\n     */\n\n  }, {\n    key: 'filterKeywordsBySearchTerm',\n\n\n    /**\n     * Filter keywords by the contents of the search field.\n     *\n     * @param {string} searchTerm The search term to filter the keywords by\n     * @param {Array} keywords The keywords to filter\n     */\n    value: function filterKeywordsBySearchTerm(keywords, searchTerm) {\n      var matches = void 0;\n      if (searchTerm) {\n        matches = keywords.filter(function (keyword) {\n          return keyword.toLowerCase().indexOf(searchTerm.toLowerCase()) !== -1;\n        });\n\n        matches.sort();\n        for (var i = 0; i < matches.length; i += 1) {\n          matches[i] = SearchBox.embolden(matches[i], searchTerm);\n        }\n      }\n\n      return matches;\n    }\n\n    /**\n     * Returns phrase with specified (case insensitive) snippet emboldened.\n     *\n     * @param {string} phrase The phrase containing the text to embolden\n     * @param {string} snippet The substring of phrase to embolden\n     * @returns {string} The phrase with the snippet emboldened\n     */\n\n  }, {\n    key: 'display',\n\n\n    /**\n     * Update the search suggestions based on matches found.\n     *\n     * @param {Array} matches The matches found\n     * @param {HTMLElement} $output Element to contain the display\n     */\n    value: function display(matches, $output) {\n      var outputString = '';\n\n      if ($output) {\n        $output.innerHTML = '';\n        this.nudgeOutputVertically('-47px');\n\n        if (matches && matches.length) {\n          matches.forEach(function (match) {\n            outputString += '<li tabindex=\"0\" class=\"search-box__suggestion\">' + match + '</li>';\n          });\n\n          outputString = '<ul>' + outputString + '</ul>';\n          $output.innerHTML = outputString;\n        }\n      }\n    }\n\n    /**\n     * Uses css transform to translate $output in the vertical axis.\n     *\n     * @param posnInPx The vertical offset to apply\n     */\n\n  }, {\n    key: 'nudgeOutputVertically',\n    value: function nudgeOutputVertically(posnInPx) {\n      var posn = void 0;\n      if (typeof posnInPx === 'string' && posnInPx.indexOf('px') === posnInPx.length - 2) {\n        posn = posnInPx;\n      } else if (!isNaN(posnInPx)) {\n        posn = posnInPx + 'px';\n      }\n\n      utils.updateElementTranslate(this.$output, [0, posn]);\n    }\n\n    /**\n     * Toggle the flag that limits the search.\n     */\n\n  }, {\n    key: 'toggleSearchLimiting',\n    value: function toggleSearchLimiting() {\n      this.isSearchLimited = !this.isSearchLimited;\n    }\n  }], [{\n    key: 'handleKeyEntry',\n    value: function handleKeyEntry(e, searchBox) {\n      var current = e.target;\n      if (e.keyCode && e.keyCode !== 9) {\n        switch (e.keyCode) {\n          case 40:\n            searchBox.nextSuggestion(current);\n            break;\n          case 38:\n            searchBox.prevSuggestion(current);\n            break;\n          case 13:\n            searchBox.useSuggestion(current);\n            break;\n          default:\n            searchBox.display(searchBox.filterKeywordsBySearchTerm(SearchBox.getKeywords(searchBox), searchBox.$input.value), searchBox.$output);\n            if (searchBox.$input.value.length > 0) {\n              searchBox.showResetButton();\n            } else {\n              searchBox.hideResetButton();\n            }\n\n            break;\n        }\n      }\n    }\n  }, {\n    key: 'getKeywords',\n    value: function getKeywords(searchBox) {\n      return searchBox.keywords;\n    }\n\n    /**\n     * Sets the keywords for the supplied searchBox.\n     *\n     * @param {Array} keywords The keywords for the searchBox\n     * @param {SearchBox} searchBox The injected search box\n     */\n\n  }, {\n    key: 'setKeywords',\n    value: function setKeywords(keywords, searchBox) {\n      searchBox.keywords = keywords;\n    }\n  }, {\n    key: 'embolden',\n    value: function embolden(phrase, snippet) {\n      // Don't nest emboldening elements.\n      if (snippet.indexOf('<strong>') > -1) {\n        return phrase;\n      }\n\n      var snippetRx = new RegExp(snippet, 'i');\n      var toEmbolden = phrase.match(snippetRx) ? phrase.match(snippetRx)[0] : null;\n      if (!toEmbolden) {\n        return phrase;\n      }\n\n      return phrase.replace(toEmbolden, '<strong>' + toEmbolden + '</strong>');\n    }\n  }]);\n\n  return SearchBox;\n}();\n\n},{\"../libs/elife-utils\":13}],9:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  function SelectNav($elm) {\n    _classCallCheck(this, SelectNav);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.$elm.classList.add('select-nav--js');\n    this.$elm.querySelector('select').addEventListener('change', this.triggerSubmit.bind(this));\n  }\n\n  _createClass(SelectNav, [{\n    key: 'triggerSubmit',\n    value: function triggerSubmit() {\n      this.$elm.submit();\n    }\n  }]);\n\n  return SelectNav;\n}();\n\n},{}],10:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = function () {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  function SiteHeader($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, SiteHeader);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n\n    var SearchBox = require('./SearchBox');\n    var $searchBoxEl = $elm.querySelector('[data-behaviour=\"SearchBox\"]');\n    this.searchBox = new SearchBox($searchBoxEl, this.window, doc);\n    var searchToggle = $elm.querySelector('[rel=\"search\"]');\n    if (!!searchToggle) {\n      this.searchToggle = searchToggle.parentNode;\n      this.searchToggle.addEventListener('click', this.toggleSearchBox.bind(this));\n    }\n\n    this.$pageOverlay = null;\n\n    // N.B. $mainMenu is not part of this component's HTML hierarchy.\n    var mainMenu = doc.querySelector('#mainMenu');\n    if (!!mainMenu) {\n      var MainMenu = require('./MainMenu');\n      this.mainMenu = new MainMenu(mainMenu);\n\n      this.$mainMenuToggle = this.$elm.querySelector('a[href=\"#mainMenu\"]');\n      if (!!this.$mainMenuToggle) {\n        this.mainMenu.moveWithinDom();\n        this.$mainMenuToggle.addEventListener('click', this.toggleMainMenu.bind(this));\n      }\n    }\n  }\n\n  /**\n   * Toggles display of the main menu.\n   */\n\n\n  _createClass(SiteHeader, [{\n    key: 'toggleMainMenu',\n    value: function toggleMainMenu(e) {\n      if (this.mainMenu.isOpen()) {\n        this.mainMenu.close();\n        this.window.removeEventListener('keyup', this.checkForMenuClose.bind(this));\n        this.doc.querySelector('.global-inner').removeEventListener('click', this.checkForMenuClose.bind(this));\n      } else {\n        this.mainMenu.open();\n        this.window.addEventListener('keyup', this.checkForMenuClose.bind(this));\n        this.doc.querySelector('.global-inner').addEventListener('click', this.checkForMenuClose.bind(this));\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }, {\n    key: 'checkForMenuClose',\n    value: function checkForMenuClose(e) {\n      if (e.keyCode === 27 || e.type === 'click') {\n        this.mainMenu.close();\n      }\n    }\n\n    /**\n     * Toggles display of the search box.\n     *\n     * @param {Event} e The event causing the toggle to occur\n     */\n\n  }, {\n    key: 'toggleSearchBox',\n    value: function toggleSearchBox(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      if (this.searchBoxIsOpen()) {\n        this.closeSearchBox();\n      } else {\n        this.openSearchBox();\n      }\n    }\n\n    /**\n     * Returns true if the search box is currently displayed.\n     *\n     * @returns {boolean} True if the search box is open\n     */\n\n  }, {\n    key: 'searchBoxIsOpen',\n    value: function searchBoxIsOpen() {\n      return this.searchBox.$elm.classList.contains('search-box--shown');\n    }\n\n    /**\n     * Closes the search box.\n     */\n\n  }, {\n    key: 'closeSearchBox',\n    value: function closeSearchBox() {\n      this.searchBox.$elm.classList.remove('search-box--shown');\n      utils.updateElementTranslate(this.searchBox.$elm, [0, '-40px']);\n      if (this.searchBox.$output) {\n        this.searchBox.$output.innerHTML = '';\n      }\n\n      this.searchBox.$input.blur();\n      this.window.removeEventListener('keyup', this.checkForClose.bind(this));\n      this.window.removeEventListener('click', this.checkForClose.bind(this));\n      this.hidePageOverlay();\n    }\n\n    /**\n     * Decides whether to close the search box, based on the supplied event.\n     *\n     * @param e The KeyboardEvent provoking the check.\n     */\n\n  }, {\n    key: 'checkForClose',\n    value: function checkForClose(e) {\n      if (e.keyCode && e.keyCode === 27 || e.type === 'click' && !utils.areElementsNested(this.searchBox.$elm, e.target)) {\n        this.closeSearchBox();\n      }\n    }\n\n    /**\n     * Opens the search box.\n     */\n\n  }, {\n    key: 'openSearchBox',\n    value: function openSearchBox() {\n      var _this = this;\n\n      var myHeight = this.window.getComputedStyle(this.$elm).height;\n      var adjustment = 20;\n      var offsetY = utils.adjustPxString(myHeight, adjustment);\n\n      // This is set in the site-header.scss.\n      var transitionDurationInMs = 150;\n      utils.updateElementTranslate(this.searchBox.$elm, [0, offsetY]);\n      utils.invertPxString(this.window.getComputedStyle(this.searchBox.$container).height);\n      this.searchBox.$elm.classList.add('search-box--shown');\n      this.window.addEventListener('keyup', this.checkForClose.bind(this));\n      this.window.addEventListener('click', this.checkForClose.bind(this));\n\n      this.window.setTimeout(function () {\n\n        // blur before focus forces the focus, a simple focus doesn't always behave as expected.\n        _this.searchBox.$input.blur();\n        _this.searchBox.$input.focus();\n      }, transitionDurationInMs);\n      this.showPageOverlay();\n    }\n\n    /**\n     * Creates the page overlay.\n     *\n     */\n\n  }, {\n    key: 'createPageOverlay',\n    value: function createPageOverlay() {\n      var className = 'overlay--semi-white';\n\n      if (!this.$pageOverlay) {\n        this.$pageOverlay = this.doc.createElement('div');\n        this.$pageOverlay.classList.add(className);\n      }\n\n      var $target = this.doc.querySelector('.global-inner');\n      $target.insertBefore(this.$pageOverlay, this.doc.querySelector('.site-header').nextElementSibling);\n    }\n\n    /**\n     * Shows the page overlay.\n     */\n\n  }, {\n    key: 'showPageOverlay',\n    value: function showPageOverlay() {\n      if (!this.$pageOverlay) {\n        this.createPageOverlay();\n      }\n\n      this.$pageOverlay.style.display = 'block';\n      this.$pageOverlay.style.height = this.doc.querySelector('.global-inner').getBoundingClientRect().height + 'px';\n    }\n\n    /**\n     * Hides the page overlay.\n     */\n\n  }, {\n    key: 'hidePageOverlay',\n    value: function hidePageOverlay() {\n      this.$pageOverlay.style.display = 'none';\n    }\n  }]);\n\n  return SiteHeader;\n}();\n\n},{\"../libs/elife-utils\":13,\"./MainMenu\":6,\"./SearchBox\":8}],11:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  function ViewSelector($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, ViewSelector);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n    this.cssFixedClassName = 'view-selector--fixed';\n\n    // matches top padding in scss\n    var topSpaceWhenFixed = 30;\n\n    this.$elmYOffset = this.$elm.offsetTop - topSpaceWhenFixed;\n    this.window.addEventListener('scroll', this.handleScroll.bind(this));\n  }\n\n  _createClass(ViewSelector, [{\n    key: 'handleScroll',\n    value: function handleScroll() {\n      if (this.$elm.classList.contains(this.cssFixedClassName)) {\n        if (this.window.pageYOffset < this.$elmYOffset) {\n          this.$elm.classList.remove(this.cssFixedClassName);\n        }\n      } else if (this.window.pageYOffset >= this.$elmYOffset) {\n        this.$elm.classList.add(this.cssFixedClassName);\n      }\n    }\n  }]);\n\n  return ViewSelector;\n}();\n\n},{}],12:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  function ViewerModal($elm) {\n    _classCallCheck(this, ViewerModal);\n\n    this.$elm = $elm;\n    this.$prev = document.createElement('div');\n    this.$next = document.createElement('div');\n\n    // build the modal\n    this.build();\n\n    // events\n    this.$prev.addEventListener('click', this.prev);\n    this.$next.addEventListener('click', this.next);\n  }\n\n  _createClass(ViewerModal, [{\n    key: 'build',\n    value: function build() {\n      //\n    }\n  }, {\n    key: 'prev',\n    value: function prev(e) {\n      e.preventDefault();\n    }\n  }, {\n    key: 'next',\n    value: function next(e) {\n      e.preventDefault();\n    }\n  }, {\n    key: 'close',\n    value: function close() {\n      //\n    }\n  }]);\n\n  return ViewerModal;\n}();\n\n},{}],13:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  'use strict';\n\n  /**\n   * Builds and returns specified HTML element, optionally adding it to the DOM.\n   *\n   * @param {string} elName Name of the HTML element to build\n   * @param {Array} [cssClasses] CSS class name(s) to set on the element\n   * @param {string} [textContent] Textual content of the element\n   * @param {string|Element} [parent] Parent element to attach to\n   * @param {string|Element|boolean} [attachBefore] Following sibling (1st if true, last if falsey)\n   *\n   * @returns {Element}\n   */\n\n  function buildElement(elName, cssClasses, textContent, parent, attachBefore) {\n\n    var $el = document.createElement(elName);\n    var $parent = typeof parent === 'string' ? document.querySelector(parent) : parent;\n\n    // Work out what the new element's following sibling will be, based on value of attachBefore.\n    var $followingSibling = function () {\n\n      if (!!attachBefore) {\n\n        if (typeof attachBefore === 'boolean') {\n          return $parent.firstElementChild;\n        } else if (typeof attachBefore === 'string') {\n          return document.querySelector(attachBefore);\n        } else if (attachBefore instanceof HTMLElement) {\n          return attachBefore;\n        }\n      }\n    }();\n\n    cssClasses.forEach(function (cssClass) {\n      $el.classList.add(cssClass);\n    });\n\n    if (textContent) {\n      $el.innerHTML = textContent;\n    }\n\n    if (!!$parent && !!$followingSibling) {\n      $parent.insertBefore($el, $followingSibling);\n    } else {\n      $parent.appendChild($el);\n    }\n\n    return $el;\n  }\n\n  var uniqueIds = function uniqueIds() {\n    var UniqueIdentifiers = function () {\n      function UniqueIdentifiers() {\n        _classCallCheck(this, UniqueIdentifiers);\n\n        this.used = [];\n      }\n\n      _createClass(UniqueIdentifiers, [{\n        key: 'isValid',\n        value: function isValid(candidate, document) {\n          // Compulsory check that id is unique to this object's knowledge.\n          if (this.used.indexOf(candidate) > -1) {\n            return false;\n          }\n\n          // Optional check to see if id is unique in the DOM.\n          if (!!document) {\n            if (!!document.querySelector && typeof document.querySelector === 'function' && document.querySelector('#' + candidate)) {\n              return false;\n            }\n          }\n\n          return true;\n        }\n\n        /**\n         * Gets a unique id with optional prefix.\n         *\n         * @param {string} [prefix] Prefix to use for the id\n         * @param {HTMLDocument} [document] Enables checking for the id's uniqueness within the DOM\n         * @returns {string}\n         */\n\n      }, {\n        key: 'get',\n        value: function get(prefix, document) {\n          var _prefix = '' + prefix || 'default_';\n          var random = ('' + Math.random()).replace(/\\./, '');\n          var candidate = _prefix + random;\n          if (this.isValid(candidate)) {\n            return candidate;\n          }\n\n          this.get(prefix, document);\n        }\n      }]);\n\n      return UniqueIdentifiers;\n    }();\n\n    return new UniqueIdentifiers();\n  }();\n\n  /**\n   * Updates the CSS transform's translate function on the element in a vendor-prefix-aware fashion.\n   *\n   * Because of the way CSS transformations are combined into a matrix, this may not work\n   * as expected if other CSS transformations are also applied to the same element.\n   *\n   * @param {HTMLElement} $el The element to apply the transformation to.\n   * @param {Array} offset The offset for both axes, expressed as [x, y], e.g. [0, '20px']\n   */\n  function updateElementTranslate($el, offset) {\n    if (!($el instanceof HTMLElement && Array.isArray(offset))) {\n      return;\n    }\n\n    var props = ['webkitTransform', 'mozTransform', 'msTransform', 'oTransform', 'transform'];\n    var offsetX = offset[0];\n    var offsetY = offset[1] || 0;\n\n    props.forEach(function (prop) {\n      $el.style[prop] = 'translate(' + offsetX + ', ' + offsetY + ')';\n    });\n  }\n\n  /**\n   * Add a quantity to a px amount expressed as a string, and return new string with updated value.\n   *\n   * For example: adjustPxString('97px', 8) returns '105px'\n   *\n   * @param {String} pxString The string representing the original quantity, e.g. '97px'\n   * @param adjustment The numeric adjustment to make, e.g. 8\n   * @returns {string} The modified value, as a string, e.g.: '105px'\n   */\n  function adjustPxString(pxString, adjustment) {\n    var originalSize = parseInt(pxString.match(/([-0-9.]+)px/)[1], 10);\n    var newSize = originalSize + adjustment;\n    return newSize + 'px';\n  }\n\n  /**\n   * Invert the px amount expressed as a string, and return new string with inverted value.\n   *\n   * For example: invertPxString('97px') returns '-97px'\n   *\n   * @param {String} pxString The string representing the original quantity, e.g. '97px'\n   * @returns {string} The modified value, as a string, e.g.: '-97px'\n   */\n  function invertPxString(pxString) {\n    var originalSize = parseInt(pxString.match(/([-0-9.]+)px/)[1], 10);\n    var newSize = originalSize * -1;\n    return newSize + 'px';\n  }\n\n  /**\n   * Returns true if $prospectiveDescendant is, or is a descendant of $prospectiveParent.\n   *\n   * @param {HTMLElement} $prospectiveParent el to test as a parent of the $prospectiveDescendant\n   * @param {HTMLElement} $prospectiveDescendant el to test as descendant of the $prospectiveParent\n   * @returns {boolean} Whether the s$prospectiveDescendant is, or descends from $prospectiveParent\n   */\n  function areElementsNested($prospectiveParent, $prospectiveDescendant) {\n    var relationship = $prospectiveParent.compareDocumentPosition($prospectiveDescendant);\n    return !!(relationship & $prospectiveParent.DOCUMENT_POSITION_CONTAINED_BY || relationship === 0);\n  }\n\n  /**\n   * Return the current viewport width.\n   *\n   * @returns {number} The current viewport width\n   */\n  function getViewportWidth() {\n    return document.documentElement.clientWidth;\n  }\n\n  /**\n   * Returns whether the display is considered to have a high pixel density ratio.\n   *\n   * @param window\n   * @returns {boolean} true if dpr >= 2, false if lower, or unknown.\n   */\n  function isHighDpr(window) {\n    if (!!window.devicePixelRatio) {\n      return window.devicePixelRatio >= 2;\n    }\n\n    return false;\n  }\n\n  return {\n    adjustPxString: adjustPxString,\n    areElementsNested: areElementsNested,\n    buildElement: buildElement,\n    getViewportWidth: getViewportWidth,\n    invertPxString: invertPxString,\n    isHighDpr: isHighDpr,\n    uniqueIds: uniqueIds,\n    updateElementTranslate: updateElementTranslate\n  };\n};\n\n},{}],14:[function(require,module,exports){\n'use strict';\n\n// Base level of feature support needed for the js loaded in this file.\n// Consider AJAXing in the rest if the test passes.\n\nif (window.localStorage && document.querySelector && window.addEventListener && !!document.createElement('div').classList) {\n  (function () {\n\n    document.querySelector('html').classList.add('js');\n\n    var Components = {};\n\n    // import modules into the list of Components.\n    Components.ArticleSection = require('./components/ArticleSection');\n    Components.ArticleDownloadLinksList = require('./components/ArticleDownloadLinksList');\n    Components.AudioPlayer = require('./components/AudioPlayer');\n    Components.ContentHeaderArticle = require('./components/ContentHeaderArticle');\n    Components.BackgroundImage = require('./components/BackgroundImage');\n    Components.SelectNav = require('./components/SelectNav');\n    Components.MainMenu = require('./components/MainMenu');\n    Components.MediaChapterListingItem = require('./components/MediaChapterListingItem');\n    Components.SiteHeader = require('./components/SiteHeader');\n    Components.SearchBox = require('./components/SearchBox');\n    Components.ViewerModal = require('./components/ViewerModal');\n    Components.ViewSelector = require('./components/ViewSelector');\n\n    // App\n    var Elife = function Elife() {\n\n      function initialiseComponent($component) {\n        // When present, data-behaviour contains a space-separated list of handlers for that component\n        var handlers = $component.getAttribute('data-behaviour').trim().split(' ');\n        for (var i = 0; i < handlers.length; i += 1) {\n          var handler = handlers[i];\n          if (Components[handler] && typeof Components[handler] === 'function') {\n            new Components[handler]($component, window, window.document);\n          }\n        }\n      }\n\n      var components = document.querySelectorAll('[data-behaviour]');\n      if (components) {\n        [].forEach.call(components, initialiseComponent);\n      }\n    };\n\n    new Elife();\n  })();\n}\n\n},{\"./components/ArticleDownloadLinksList\":1,\"./components/ArticleSection\":2,\"./components/AudioPlayer\":3,\"./components/BackgroundImage\":4,\"./components/ContentHeaderArticle\":5,\"./components/MainMenu\":6,\"./components/MediaChapterListingItem\":7,\"./components/SearchBox\":8,\"./components/SelectNav\":9,\"./components/SiteHeader\":10,\"./components/ViewSelector\":11,\"./components/ViewerModal\":12}]},{},[14])\n\n","'use strict';\n\nmodule.exports = class ArticleSection {\n\n  constructor($elm, _window = window, doc = document) {\n\n    if ($elm.classList.contains('article-section--first')) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n\n    this.thresholdWidth = 600;\n    this.initialise(this.$elm, doc);\n  }\n\n  initialise($elm, doc) {\n    this.$elm.classList.add('article-section--js');\n    this.$headerLink = this.createHeaderLink($elm, doc);\n    this.$body = $elm.querySelector('.article-section__body');\n    this.setInitialState($elm, this.$headerLink, this.$body);\n    this.window.addEventListener('DOMContentLoaded', this.handleSectionOpeningViaHash.bind(this));\n    this.window.addEventListener('hashchange', this.handleSectionOpeningViaHash.bind(this));\n  }\n\n  createHeaderLink($elm, doc) {\n    let $header = $elm.querySelector('.article-section__header');\n    let $link = doc.createElement('A');\n    $link.setAttribute('href', '#');\n    $link.classList.add('article-section__header_link');\n    $link.appendChild($header.firstElementChild);\n    $header.appendChild($link);\n    $link.addEventListener('click', this.toggleState.bind(this));\n    return $link;\n  }\n\n  setInitialState($elm, $headerLink, $body) {\n    if ($elm.dataset.initialState === 'closed' || this.viewportNoWiderThan(this.thresholdWidth)) {\n      $elm.classList.add('article-section--collapsed');\n      $headerLink.classList.add('article-section__header_link--closed');\n      $body.classList.add('visuallyhidden');\n    } else {\n      // Defensive: remove classes if they turn up here when they shouldn't\n      $headerLink.classList.remove('article-section__header_link--closed');\n      $body.classList.remove('visuallyhidden');\n    }\n\n  }\n\n  viewportNoWiderThan(thresholdInPx) {\n    return this.window.matchMedia('(max-width: ' + thresholdInPx + 'px)').matches;\n  }\n\n  toggleState(e) {\n    e.preventDefault();\n    this.$headerLink.classList.toggle('article-section__header_link--closed');\n    this.$elm.classList.toggle('article-section--collapsed');\n    this.$body.classList.toggle('visuallyhidden');\n  }\n\n  static openSection(section) {\n    section.$headerLink.classList.remove('article-section__header_link--closed');\n    section.$elm.classList.remove('article-section--collapsed');\n    section.$body.classList.remove('visuallyhidden');\n  }\n\n  handleSectionOpeningViaHash(e) {\n\n    // TODO: Code similar to that in Audipplayer.seekNewTime(), consider refactoring out into common\n    let hash = '';\n\n    // event was hashChange\n    if (!!e.newURL) {\n      hash = e.newURL.substring(e.newURL.indexOf('#') + 1);\n    } else {\n      hash = this.window.location.hash.substring(1);\n    }\n\n    if (!hash) {\n      return false;\n    }\n\n    if (ArticleSection.isFragmentForCollapsibleSection(hash, this.doc)) {\n      ArticleSection.openSection(this);\n    }\n  }\n\n  static isFragmentForCollapsibleSection(fragment, document) {\n    var $elFromFragmentId = document.querySelector('#' + fragment);\n    if (!$elFromFragmentId) {\n      return false;\n    }\n\n    let behaviour = $elFromFragmentId.dataset.behaviour;\n    return behaviour && behaviour.indexOf('ArticleSection') > -1;\n  }\n\n};\n","'use strict';\nvar utils = require('../libs/elife-utils')();\nmodule.exports = class AudioPlayer {\n\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      console.warn('No element provided');\n      return;\n    }\n\n    this.window = _window;\n    if (!this.window.HTMLAudioElement) {\n      console.warn('Audio element not supported');\n      return;\n    }\n\n    console.log('Initialising Audio Player...');\n\n    this.$elm = $elm;\n    this.$audioElement = this.$elm.querySelector('audio');\n    if (!this.$audioElement) {\n      console.warn('No audio element found');\n      return;\n    }\n\n    this.uniqueId = utils.uniqueIds.get('audio', doc);\n    this.$elm.id = this.uniqueId;\n    this.$playButton = AudioPlayer.buildPlayButton(this);\n    this.$icon = this.$playButton.querySelector('.audio-player__toggle_play_icon');\n\n    // $title must be prepared before buildProgressIndicator is called\n    this.$title = this.prepare$title(this.$elm.querySelector('.audio-player__header'), doc);\n    this.$progressTrack = AudioPlayer.buildProgressIndicator(this);\n    this.$progressBar = this.$progressTrack.querySelector('[class*=\"progress_bar\"]');\n    this.$timeIndicators = AudioPlayer.buildTimeIndicators(this);\n    this.$currentTime = this.$timeIndicators.querySelector('[class*=\"current_time\"]');\n    this.$duration = this.$timeIndicators.querySelector('[class*=\"duration\"]');\n\n    // state\n    this.duration = null;\n    this.isPlaying = false;\n\n    this.$elm.classList.add('audio-player--js');\n\n    this.$playButton.classList.add('loading');\n    this.$audioElement.addEventListener('loadedmetadata', () => {\n      this.playerReady(this);\n    });\n\n    this.usingMetadata = false;  // set to true in loadMetadata if no errors thrown\n    this.loadMetadata(this.$elm.dataset.episodeNumber);\n\n  }\n\n  playerReady(player) {\n    player.duration = player.$audioElement.duration;\n    player.$duration.innerHTML = AudioPlayer.secondsToMinutes(player.duration);\n    player.$playButton.addEventListener('click', () => {\n      player.togglePlay(player.$audioElement, player.$playButton);\n    }, false);\n    player.$audioElement.addEventListener('timeupdate', player.update.bind(player));\n    player.window.addEventListener('hashchange', player.seekNewTime.bind(player));\n    player.window.addEventListener('load', player.seekNewTime.bind(player));\n    this.$playButton.classList.remove('loading');\n\n    let playerReady;\n    try {\n      playerReady = new CustomEvent('playerReady', { detail: this.uniqueId });\n    } catch (e) {\n      // CustomEvent not supported, do it the old fashioned way\n      playerReady = document.createEvent('playerReady');\n      playerReady.initCustomEvent('playerReady', true, true, { detail: this.uniqueId });\n    }\n\n    player.window.dispatchEvent(playerReady);\n\n  }\n\n  prepare$title(parent, doc) {\n    let span = doc.createElement('span');\n    try {\n      span.innerHTML = parent.innerHTML;\n    } catch (e) {\n      return;\n    }\n\n    span.classList.add('audio-player__title');\n    parent.innerHTML = '';\n    parent.appendChild(span);\n    return span;\n  }\n\n  /**\n   * Converts seconds to a display of minutes & seconds.\n   *\n   * @param {Number} seconds The time to convert, in seconds\n   * @returns {string} The time in a [m]m:ss string\n   */\n  static secondsToMinutes(seconds) {\n    let _seconds = parseInt(seconds, 10);\n    let mins = Math.floor(_seconds / 60);\n    let secs = _seconds % 60;\n    if (secs <= 9) {\n      secs = '0' + secs;\n    }\n\n    return `${mins}:${secs}`;\n  }\n\n  //noinspection JSValidateJSDoc\n  /**\n   * Toggles play/pause state of media file.\n   *\n   * @param {HTMLAudioElement} $audioElement The audio element to toggle the play state of\n   * @param {HTMLButtonElement} $togglePlayButton The button controlling the playback\n   */\n  togglePlay($audioElement, $togglePlayButton) {\n    if (this.isPlaying) {\n      this.pause($audioElement, $togglePlayButton);\n    } else {\n      this.play($audioElement, $togglePlayButton);\n    }\n  }\n\n  play($audioElement, $togglePlayButton) {\n    $audioElement.play();\n    AudioPlayer.updateIconState(this.$icon, 'pause');\n    $togglePlayButton.classList.add('audio-player__toggle_play--pauseable');\n    $togglePlayButton.classList.remove('audio-player__toggle_play--playable');\n    this.isPlaying = true;\n  }\n\n  pause ($audioElement, $togglePlayButton) {\n    $audioElement.pause();\n    AudioPlayer.updateIconState(this.$icon, 'play');\n    $togglePlayButton.classList.add('audio-player__toggle_play--playable');\n    $togglePlayButton.classList.remove('audio-player__toggle_play--pauseable');\n    this.isPlaying = false;\n  }\n\n  /**\n   * Update the progress bar and elapsed time indicator based on track's current time.\n   */\n  update() {\n    let currentTime = Math.floor(this.$audioElement.currentTime);\n    let pc = (currentTime / this.duration) * 100;\n    let currentTime2Dis = AudioPlayer.secondsToMinutes(currentTime);\n    this.$progressBar.style.width = `${pc}%`;\n    this.$currentTime.innerHTML = currentTime2Dis;\n\n    if (this.usingMetadata) {\n      let chapterNumberOnLastUpdate = this.getCurrentChapterNumber();\n      this.setCurrentChapterMetadata(this.getChapterMetadataAtTime(currentTime,\n                                                                   this.chapterMetadata));\n      if (this.getCurrentChapterMetadata().number !== chapterNumberOnLastUpdate) {\n        this.changeChapter(this.getCurrentChapterNumber(),\n                           this.getCurrentChapterMetadata().title,\n                           this.$elm);\n      }\n    }\n\n    if (this.$audioElement.ended) {\n      AudioPlayer.updateIconState(this.$icon, 'play');\n      this.isPlaying = false;\n    }\n  }\n\n  /**\n   * Updates player title with chapter number & name, and dispatches chapterChanged event.\n   *\n   * @param {int} number New chapter number Used as value of detail property of\n   * @param {String} title new chapter title\n   * @param {HTMLElement} $elm Element from which to dispatch the event\n   */\n  changeChapter(number, title, $elm) {\n    this.setTitle(this.episodeTitle, title);\n    let chapterChanged;\n    try {\n      chapterChanged = new CustomEvent('chapterChanged', { detail: number });\n    } catch (e) {\n      // CustomEvent not supported, do it the old fashioned way\n      chapterChanged = document.createEvent('chapterChanged');\n      chapterChanged.initCustomEvent('chapterChanged', true, true, { detail: number });\n    }\n\n    $elm.dispatchEvent(chapterChanged);\n  }\n\n  /**\n   * Updates the icon state for the play button.\n   *\n   * @param $icon {HTMLImageElement} The img to update\n   * @param state {string} The state to update to (either 'play' or 'pause')\n   */\n  static updateIconState($icon, state) {\n    if (state !== 'play' && state !== 'pause') {\n\n      return;\n    }\n\n    $icon.src = AudioPlayer.getIconPath((state));\n    $icon.alt = state;\n  }\n\n  seekNewTime(e) {\n    var hash;\n    var shouldPlay = false;\n    try {\n      hash = e.newURL.substring(e.newURL.indexOf('#') + 1);\n\n      // Should play when chapter changed within the page, but not autoplay on page load :-)\n      shouldPlay = true;\n    } catch (e) {\n      // newURL only available on hashchange event, but load event may also invoke this handler\n      hash = this.window.location.hash.substring(1);\n      shouldPlay = false;\n    }\n\n    if (!isNaN(hash) && hash >= 0) {\n      this.seek(hash, this.$audioElement);\n      if (!this.isPlaying && shouldPlay) {\n        this.play(this.$audioElement, this.$playButton);\n      }\n    }\n  }\n\n  /**\n   * Event handler to determine track seek time in response to user interaction.\n   *\n   * @param e The user-generated click event\n   * @param {AudioPlayer} player The audio player object that the new element belongs to\n   */\n  handleSeek(e, player) {\n    var newSeekPosition = parseInt(e.offsetX, 10);\n    var availableWidth = player.$progressTrack.clientWidth;\n    var durationProportionToSeek = (newSeekPosition / parseInt(availableWidth, 10));\n    this.seek(durationProportionToSeek * player.duration, player.$audioElement);\n  }\n\n  //noinspection JSValidateJSDoc\n  /**\n   * Seeks a particular time in the media file.\n   *\n   * @param {Number} time The time to seek\n   * @param {HTMLAudioElement} $audioElement The audio element to toggle the play state of\n   */\n  seek(time, $audioElement) {\n    $audioElement.currentTime = time;\n    this.update();\n  }\n\n  /**\n   * Builds the progress indicator.\n   *\n   * @param {AudioPlayer} player The audio player object that the new element belongs to\n   * @returns {Element} The progress indicator\n   */\n  static buildProgressIndicator(player) {\n    var $barWrapper = utils.buildElement('div',\n                               ['audio-player__progress'],\n                               '',\n                               '#' + player.uniqueId + ' [class*=\"audio-player__container\"]');\n\n    utils.buildElement('div', ['audio-player__progress_bar'], '', $barWrapper);\n\n    $barWrapper.addEventListener('click', function (e) {\n      player.handleSeek(e, player);\n    }, false);\n\n    return $barWrapper;\n  }\n\n  /**\n   * Builds the play button.\n   *\n   * @param {AudioPlayer} player The audio player object that the new element belongs to\n   * @returns {Element} The play/pause button\n   */\n  static buildPlayButton(player) {\n    var $button = utils.buildElement('button',\n                              ['audio-player__toggle_play'],\n                              '',\n                              '#' + player.uniqueId + ' [class*=\"audio-player\"]',\n                              true);\n    var $image = utils.buildElement('img',\n                       ['audio-player__toggle_play_icon'],\n                       '',\n                       $button);\n    $image.src = AudioPlayer.getIconPath('play');\n    $image.alt = 'Play';\n    return $button;\n  }\n\n  /**\n   * Builds the current time and duration indicators.\n   *\n   * @param {AudioPlayer} player The audio player object that the new element belongs to\n   * @returns {Element} An element containing the current time and duration indicators.\n   */\n  static buildTimeIndicators(player) {\n    var playerId = player.uniqueId;\n    var $container = utils.buildElement('div',\n                                        ['audio-player__times'],\n                                        '',\n                                        '#' + playerId + ' [class*=audio-player__header]',\n                                        true);\n\n    utils.buildElement('span', ['audio-player__current_time'], '0:00', $container);\n    utils.buildElement('span', ['audio-player__duration'], '0:00', $container);\n    return $container;\n  }\n\n  static getIconPath(iconName) {\n\n    if (iconName !== 'play' && iconName !== 'pause') {\n      return;\n    }\n\n    return `../../assets/img/icons/audio-${iconName}.svg`;\n  }\n\n  /**\n   * Set the title based on both episode and chapter titles\n   * @param episodeTitle\n   * @param chapterTitle\n   */\n  setTitle(episodeTitle, chapterTitle) {\n    this.title = episodeTitle;\n    if (!!chapterTitle) {\n      this.title += ': ' + chapterTitle;\n    }\n\n    this.$title.innerHTML = this.title;\n  }\n\n  getCurrentChapterMetadata() {\n    return this.currentChapterMetadata;\n  }\n\n  setCurrentChapterMetadata(metadata) {\n    this.currentChapterMetadata = metadata;\n  }\n\n  getCurrentChapterNumber() {\n    return this.getCurrentChapterMetadata().number || 0;\n  }\n\n  /**\n   * Returns a chapter's title and number, based on the playback position\n   * @param time\n   * @param {Array} chapterMetadata\n   * An array of objects that must contain as a minimum\n   * @returns {*}\n   */\n  getChapterMetadataAtTime(time, chapterMetadata) {\n    if (!chapterMetadata) {\n      return '';\n    }\n\n    let chapterTitle = '';\n    let chapterNumber = 0;\n    chapterMetadata.forEach(function (chapter, i, chapters) {\n      let chapterStartTime = parseInt(chapter.time, 10);\n      let nextChapterStartTime = i < chapters.length - 1 ? chapters[i + 1].time : null;\n      if (time >= chapterStartTime) {\n        if (!nextChapterStartTime || time < nextChapterStartTime) {\n          chapterTitle = chapter.title;\n          chapterNumber = chapter.number;\n        }\n      }\n    });\n\n    return {\n      title: chapterTitle,\n      number: chapterNumber\n    };\n  }\n\n  /**\n   * Sets episode title and respective chapter information from metadata\n   * @param metadata\n   */\n  processMetadata(metadata) {\n    this.episodeTitle = 'Episode ' + metadata.number;\n    this.setTitle(this.episodeTitle);\n\n    this.chapterMetadata = this.prepareChapterMetadata(metadata);\n    this.currentChapterMetadata = { number: 0, title: '' };\n  }\n\n  /**\n   * Returns array of objects describing respective chapter information\n   * @param metadata\n   * @returns {Array} of objects containing time, number and title properties\n   */\n  prepareChapterMetadata(metadata) {\n    let chapterMetadata = [];\n    metadata.chapters.forEach((chapter) => {\n      chapterMetadata.push(\n        {\n          time: chapter.time,\n          number: chapter.number,\n          title: chapter.number + '. ' + chapter.title\n        }\n      );\n    });\n\n    return chapterMetadata;\n  }\n\n  /**\n   * Metadata is expected in the data-metadata attribute of $elm as a JSON-like string with single-\n   * quoted instead of double-quoted values.\n   */\n  loadMetadata() {\n    try {\n      this.processMetadata(JSON.parse(this.$elm.dataset.metadata.replace(/'/g, '\"')));\n      this.usingMetadata = true;\n    } catch (e) {\n      console.error(e);\n      this.usingMetadata = false;\n    }\n  }\n};\n","'use strict';\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = class BackgroundImage {\n\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n\n    this.sourceToUse = null;\n    this.thresholdWidth = parseInt(this.$elm.dataset.thresholdWidth, 10);\n    if (this.isValidThreshold(this.thresholdWidth) &&\n        !this.isThresholdMet(this.thresholdWidth, this.window.innerWidth)) {\n      this.window.addEventListener('resize', this.resizeHandler.bind(this));\n    } else {\n      this.init();\n    }\n\n  }\n\n  init() {\n    this.sourceToUse = this.calcSourceToUse(this.$elm, utils.isHighDpr(this.window));\n    this.setDarkBackground();\n    this.setupEventHandlers(this.$elm,\n                            this.setLightBackground.bind(this),\n                            this.setDarkBackground.bind(this));\n  }\n\n  isValidThreshold(candidate) {\n    return !(\n      typeof candidate === 'boolean' ||\n      candidate === null ||\n      Array.isArray(candidate) ||\n      isNaN(candidate) ||\n      candidate < 0\n    );\n\n  }\n\n  isThresholdMet(threshold, viewportWidth) {\n    return viewportWidth >= threshold;\n  }\n\n  resizeHandler() {\n    if (this.isThresholdMet(this.thresholdWidth, this.window.innerWidth)) {\n      this.window.removeEventListener('resize', this.resizeHandler.bind(this));\n      this.init();\n    }\n  }\n\n  setupEventHandlers($elm, setLightBackground, setDarkBackground) {\n    if ($elm.getAttribute('data-invert-bgcol-on-hover') !== null) {\n      $elm.addEventListener('mouseenter', setLightBackground);\n      $elm.addEventListener('mouseleave', setDarkBackground);\n    }\n  }\n\n  setDarkBackground() {\n    if (!!this.sourceToUse) {\n      this.$elm.style.backgroundImage = this.getBackgroundImagesString(this.sourceToUse,\n                      'linear-gradient(to top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5))');\n      this.$elm.style.color = '#fff';\n    }\n  }\n\n  setLightBackground() {\n    if (!!this.sourceToUse) {\n      this.$elm.style.backgroundImage = this.getBackgroundImagesString(this.sourceToUse,\n                     'linear-gradient(to top, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5))');\n      this.$elm.style.color = '#212121';\n    }\n  }\n\n  getBackgroundImagesString(path, grandient) {\n    if (!path || !path.length || path.length === 0) {\n      return '';\n    }\n\n    return grandient + ', url(' + path + ')';\n  }\n\n  calcSourceToUse(sourceDefiner, isHighDpr) {\n    var lowResSource = '';\n    var highResSource = '';\n    if (!sourceDefiner) {\n      return '';\n    }\n\n    if (!!sourceDefiner.dataset) {\n      highResSource = sourceDefiner.dataset.highResImageSource;\n      lowResSource = sourceDefiner.dataset.lowResImageSource;\n    } else {\n      highResSource = sourceDefiner.getAttribute('data-highResImageSource');\n      lowResSource = sourceDefiner.getAttribute('data-lowResImageSource');\n    }\n\n    if (isHighDpr && !highResSource || !isHighDpr && !lowResSource) {\n      return '';\n    }\n\n    if (isHighDpr) {\n      return highResSource;\n    }\n\n    return lowResSource;\n  }\n\n};\n","'use strict';\n\nmodule.exports = class ContentHeaderArticle {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n    this.$elm.classList.add('content-header-article--js');\n\n    // Should track SASS variable $bkpt-content-header--medium-width.\n    this.breakpointInPx = 768;\n    this.currentView = this.calcCurrentView(this.breakpointInPx);\n\n    this.authors = $elm.querySelectorAll('.content-header__author_list_item');\n    this.institutions = $elm.querySelectorAll('.content-header__institution_list_item');\n\n    this.hasToggleAuthor = false;\n    this.hasToggleInstitution = false;\n    this.hideAllExcessItems('author', this.authors);\n    this.hideAllExcessItems('institution', this.institutions);\n\n    let _this = this;\n    this.window.addEventListener('resize', () => {\n      let newView = _this.calcCurrentView(_this.breakpointInPx);\n      if (newView !== _this.currentView) {\n        _this.currentView = newView;\n        _this.handleAnyExcessItems('author', _this.authors);\n        _this.handleAnyExcessItems('institution', _this.institutions);\n      }\n    });\n\n  }\n\n  handleAnyExcessItems(itemType, items) {\n    let toggle = this.$elm.querySelector('.content-header__item_toggle');\n    if (toggle && toggle.innerHTML.indexOf('less') > -1 && this.currentView === 'wide') {\n      this.clearExcessMark(items);\n      this.toggleExcessItems(items);\n    } else {\n      this.clearExcessMark(items);\n      let excessItems = this.getExcessItems(itemType, items);\n      this.markAsExcess(excessItems);\n      this.toggleExcessItems(items);\n      this.markLastNonExcessItem(itemType, items);\n    }\n  }\n\n  /**\n   * Determine excess by itemType from items supplied and hides those.\n   *\n   * @param {string} itemType 'author' or 'institution'\n   * @param {DOMTokenList} items List of items to identify the excess within, and hide those\n   */\n  hideAllExcessItems(itemType, items) {\n    let excessItems = this.getExcessItems(itemType, items);\n    this.markAsExcess(excessItems);\n    this.toggleExcessItems(items);\n    this.addTrailingText(itemType, items);\n  }\n\n  /**\n   * Returns max number authors or institutions to be displayed by default at current screen width.\n   *\n   * Returns null if itemType is invalid.\n   *\n   * @param {string} itemType 'author' or 'institution'\n   * @returns {number|null} Number of the type of item to display by default at current screen width\n   */\n  getDefaultMaxItems(itemType) {\n    if (this.currentView === 'wide') {\n      if (itemType === 'author') {\n        return 16;\n      }\n\n      if (itemType === 'institution') {\n        return 10;\n      }\n\n    } else {\n      if (itemType === 'author') {\n        return 1;\n      }\n\n      if (itemType === 'institution') {\n        return 0;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Returns array of elements in excess of the default max items, or null if itemType invalid.\n   *\n   * The returned array is a subset of the list supplied, or empty if there are no excess items.\n   *\n   * @param {string} itemType 'author' or 'institution'\n   * @param {DOMTokenList} items List of items from which to identify the excess\n   * @returns {Array|null} Items in excess of the default maximum for the current screen width\n   */\n  getExcessItems(itemType, items) {\n    if (itemType !== 'author' && itemType !== 'institution') {\n      return null;\n    }\n\n    let defaultMaxItems = this.getDefaultMaxItems(itemType);\n    if (items.length > defaultMaxItems) {\n      return [].slice.call(items, defaultMaxItems);\n    }\n\n    return [];\n  }\n\n  /**\n   * Marks supplied list elements as excess.\n   *\n   * @param {Array} els The elements to mark as excess\n   */\n  markAsExcess(els) {\n    els.forEach(function ($el) {\n      $el.classList.add('excess-item');\n    });\n  }\n\n  /**\n   * Clears any excess mark from all elements in the supplied list.\n   *\n   * @param {DOMTokenList} els The elements to clear the excess mark from\n   */\n  clearExcessMark(els) {\n    [].forEach.call(els, function ($el) {\n      $el.classList.remove('excess-item');\n    });\n  }\n\n  /**\n   * Toggles the display of any excess items found in the supplied list of elements.\n\n   * @param {DOMTokenList} items The elements to inspect for excess items, and to toggle those found\n   */\n  toggleExcessItems(items) {\n    [].forEach.call(items, function (item) {\n      if (item.classList.contains('excess-item')) {\n        item.classList.add('visuallyhidden');\n      } else {\n        item.classList.remove('visuallyhidden');\n      }\n    });\n  }\n\n  /**\n   * Returns the name of the current view.\n   *\n   * @param {number} breakpoint The px viewport width that determines the view.\n   *\n   * @returns {string} the view name ('wide' or 'narrow').\n   */\n  calcCurrentView(breakpoint) {\n    return this.window.matchMedia('(min-width: ' + breakpoint + 'px)').matches ? 'wide' : 'narrow';\n  }\n\n  /**\n   * Marks the last shown non-excess item with particlular class (so not if showing last in list).\n   *\n   * @param {string} itemType 'author' or 'institution'\n   * @param {DOMTokenList} items List of items to act upon\n   */\n  markLastNonExcessItem(itemType, items) {\n    let lastShownIndex = null;\n    let foundLastShown = false;\n    [].forEach.call(items, function (item, i) {\n\n      // Clear old any obsolete determination of what's the last non-excess item.\n      items[i].classList.remove('content-header__' + itemType + '--last-non-excess');\n      if (item.classList.contains('excess-item') && !foundLastShown) {\n        lastShownIndex = i - 1;\n        foundLastShown = true;\n      }\n    });\n\n    if (lastShownIndex !== null && lastShownIndex > -1) {\n      let lastShown = items[lastShownIndex].querySelector('.content-header__' + itemType);\n      if (lastShown) {\n        lastShown.classList.add('content-header__' + itemType + '--last-non-excess');\n      }\n    }\n\n  }\n\n  /**\n   * Adds trailing text to the visible end of truncated author & institution lists & builds toggle.\n   *\n   * @param {string} itemType The type of items supplied\n   * @param {DOMTokenList} items The items to which to add the trailing text\n   */\n  addTrailingText(itemType, items) {\n    if (itemType === 'author' && items.length > this.getDefaultMaxItems('author')) {\n      if (!this.hasToggleAuthor) {\n        this.buildSeeMoreLessToggle('author');\n        this.hasToggleAuthor = true;\n      }\n\n    }\n\n    if (itemType === 'institution' && items.length > this.getDefaultMaxItems('institution')) {\n      if (!this.hasToggleInstitution) {\n        this.buildSeeMoreLessToggle('institution');\n        this.hasToggleInstitution = true;\n      }\n\n    }\n\n    this.markLastNonExcessItem(itemType, items);\n  }\n\n  /**\n   * Builds the show/hide toggle for excess authors & institutions.\n   */\n  buildSeeMoreLessToggle(itemType) {\n    // This toggle only required due to screen width constraints. All content already accessible as\n    // it's not being hidden in the first place. Hence an aria-hidden li, rather than an anchor.\n    // Should conform to https://www.w3.org/TR/wai-aria/states_and_properties#aria-hidden\n    let toggle = this.doc.createElement('li');\n    let toggleOnText = 'see&nbsp;all';\n    let toggleOffText = 'see&nbsp;less';\n    toggle.setAttribute('aria-hidden', 'true');\n    toggle.classList.add('content-header__item_toggle', 'content-header__item_toggle--' + itemType);\n    toggle.innerHTML = '&nbsp;&hellip;&nbsp;' + toggleOnText;\n    toggle.addEventListener('click', e => {\n      let target = e.target;\n      if (target.innerHTML.indexOf(toggleOnText) > -1) {\n        [].forEach.call(this.doc.querySelectorAll('.content-header__item_toggle'), item => {\n          item.innerHTML = '&nbsp;' + toggleOffText;\n        });\n        this.clearExcessMark(this.authors);\n        this.clearExcessMark(this.institutions);\n        this.toggleExcessItems(this.authors);\n        this.toggleExcessItems(this.institutions);\n      } else {\n        [].forEach.call(this.doc.querySelectorAll('.content-header__item_toggle'), item => {\n          item.innerHTML = '&nbsp;&hellip;&nbsp;' + toggleOnText;\n        });\n        this.hideAllExcessItems('author', this.authors);\n        this.hideAllExcessItems('institution', this.institutions);\n      }\n    });\n    this.$elm.querySelector('.content-header__' + itemType + '_list').appendChild(toggle);\n  }\n\n};\n","'use strict';\n\nmodule.exports = class MainMenu {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n  }\n\n  /**\n   * Moves main menu from default non-js DOM position into position required by js implementation.\n   */\n  moveWithinDom() {\n    this.$elm.classList.add('main-menu--js');\n    let $globalWrapper = this.doc.querySelector('.global-wrapper');\n    if (!!$globalWrapper) {\n      $globalWrapper.insertBefore(this.$elm, $globalWrapper.firstElementChild);\n    }\n  }\n\n  /**\n   * Indicates whether the main menu is currently open.\n   *\n   * @returns {boolean} true if the main menu is currently open\n   */\n  isOpen() {\n    return this.$elm.classList.contains('main-menu--shown');\n  }\n\n  /**\n   * Closes the main menu\n   */\n  close () {\n    this.$elm.classList.remove('main-menu--shown');\n    this.doc.querySelector('.global-wrapper').classList.remove('pull-offscreen-right');\n  }\n\n  /**\n   * Opens the main menu\n   */\n  open () {\n    this.$elm.classList.add('main-menu--shown');\n    this.doc.querySelector('.global-wrapper').classList.add('pull-offscreen-right');\n  }\n\n};\n","'use strict';\nmodule.exports = class MediaChapterListingItem {\n\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      console.warn('No element provided');\n      return;\n    }\n\n    console.log('Initialising Chapter listing item...');\n\n    this.$elm = $elm;\n    this.startTime = $elm.dataset.startTime;\n    if (!this.startTime || isNaN(this.startTime) || this.startTime < 0) {\n      return;\n    }\n\n    this.window = _window;\n    this.document = doc;\n\n    // When ready, AudioPlayer dispatches a custom event 'playerReady' on window, that supplies that\n    // player's html element id.\n    _window.addEventListener('playerReady', this.listenForChapterChange.bind(this));\n    this.$link = this.createLink(doc, this.$elm, this.startTime);\n    this.setupEventHandlers(this.$link);\n\n  }\n\n  listenForChapterChange (e) {\n    let $player = this.document.querySelector('#' + e.detail);\n    if (!!$player) {\n      $player.addEventListener('chapterChanged', this.indicateChapterChanged.bind(this));\n    }\n  }\n\n  createLink(document, $rootElm, startTime) {\n    let $title = $rootElm.querySelector('.teaser__header_text');\n    if (!$title) {\n      return;\n    }\n\n    let titleText;\n    let $existingLink;\n    try {\n      $existingLink = $title.querySelector('.teaser__header_text_link');\n      titleText = $existingLink.innerHTML;\n      $existingLink.parentNode.removeChild($existingLink);\n    } catch (e) {\n      titleText = $title.innerHTML;\n    }\n\n    let $link = document.createElement('a');\n    $link.innerHTML = titleText;\n    $link.setAttribute('href', '#' + startTime);\n    $link.classList.add('teaser__header_text_link');\n    $title.innerHTML = '';\n    $title.appendChild($link);\n    return $link;\n  }\n\n  indicateChapterChanged(e) {\n    let currentChapterNumber = e.detail;\n    if (currentChapterNumber === this.window.parseInt(this.$elm.dataset.chapterNumber)) {\n      this.$elm.classList.add('current-chapter');\n    } else {\n      this.$elm.classList.remove('current-chapter');\n    }\n  }\n\n  setupEventHandlers($link) {\n    $link.addEventListener('chapterChanged', this.indicateChapterChanged);\n  }\n\n};\n","'use strict';\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = class SearchBox {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.$container = $elm.querySelector('fieldset');\n    this.$form = $elm.querySelector('form');\n    this.$input = $elm.querySelector('input[type=\"search\"]');\n    this.$limit = $elm.querySelector('input[type=\"checkbox\"]');\n    this.$elm = $elm;\n    this.$searchButton = $elm.querySelector('button[type=\"submit\"]');\n    this.$resetButton = $elm.querySelector('button[type=\"reset\"]');\n    this.$inner = $elm.querySelector('.search-box__inner');\n\n    // Check there's a search input field, if not everything else is pointless.\n    if (!this.$input) {\n      return;\n    }\n\n    // TODO: Remove if not ultimately useful.\n    this.isSearchLimited = this.$limit && this.$limit.checked;\n\n    this.$elm.classList.add('search-box--js');\n\n    // setup\n    this.$form.setAttribute('autocomplete', 'off');\n\n    if (!doc.querySelector('.search-box__output')) {\n      this.$output = doc.createElement('div');\n      this.$output.innerHTML = '';\n      this.$output.classList.add('search-box__output');\n      this.$output.addEventListener('keyup', e => {\n        SearchBox.handleKeyEntry(e, this);\n      });\n      this.$output.addEventListener('click', e => {\n        this.useSuggestion(e.target);\n      });\n      this.$inner.appendChild(this.$output);\n    }\n\n    this.keywords = [];\n\n    // events\n    this.$resetButton.addEventListener('click', this.reset.bind(this));\n    this.$input.addEventListener('keyup', e => {\n      SearchBox.handleKeyEntry(e, this);\n    });\n    this.$input.addEventListener('paste', this.showResetButton.bind(this));\n\n    // TODO: Remove this test data when decided how to populate this list of keywords with real data\n    SearchBox.setKeywords([\n                            'Xiao-Dong Li', 'Zhijian J Chen', 'Cell biology',\n                           'Immunology', 'bacteria',\n                          ], this);\n  }\n\n  /**\n   * Handles the reset button being pressed.\n   */\n  reset() {\n    this.hideResetButton();\n    if (this.$output) {\n      this.$output.innerHTML = '';\n    }\n\n    this.$input.focus();\n  }\n\n  /**\n   * Hides the reset button.\n   */\n  hideResetButton() {\n    this.$elm.classList.remove('search-box--populated');\n  }\n\n  /**\n   * Shows the reset button.\n   */\n  showResetButton() {\n    this.$elm.classList.add('search-box--populated');\n  }\n\n  /**\n   * Responds to the keyCode of a KeyboardEvent (used on the input field and suggestions).\n   *\n   * Takes care not to trap the tab character. Accessibility!\n   * Down arrow (keyCode 40): go to the next suggestion.\n   * Up arrow (keyCode 38): go to the previous suggestion.\n   * Return (keyCode 13): put the text of the current suggestion into the search box\n   * Any other key: use it to filter keywords; also show/hide reset button.\n   *\n   * @param {KeyboardEvent} e The event to respond to\n   * @param {SearchBox} searchBox Calling object (injected to make method more testable)\n   */\n  static handleKeyEntry(e, searchBox) {\n    let current = e.target;\n    if (e.keyCode && e.keyCode !== 9) {\n      switch (e.keyCode) {\n      case 40:\n        searchBox.nextSuggestion(current);\n        break;\n      case 38:\n        searchBox.prevSuggestion(current);\n        break;\n      case 13:\n        searchBox.useSuggestion(current);\n        break;\n      default:\n        searchBox.display(searchBox.filterKeywordsBySearchTerm(SearchBox.getKeywords(searchBox),\n                                                       searchBox.$input.value), searchBox.$output);\n        if (searchBox.$input.value.length > 0) {\n          searchBox.showResetButton();\n        } else {\n          searchBox.hideResetButton();\n        }\n\n        break;\n      }\n    }\n  }\n\n  /**\n   * Selects the search suggestion element after the current one.\n   *\n   * If already on the last one, loop to the beginning and select the input field.\n   *\n   * @param {HTMLElement} current The search suggestion or input field currently with focus\n   */\n  nextSuggestion(current) {\n    if (!this.$output) {\n      return;\n    }\n\n    if (current === this.$input) {\n      this.$output.querySelector('ul li:first-child').focus();\n    } else if (!!current.nextElementSibling) {\n      current.nextElementSibling.focus();\n    } else {\n      this.$input.focus();\n    }\n  }\n\n  /**\n   * Selects the search suggestion element before the current one.\n   *\n   * If already on the input field, loop to the end and select the last one.\n   *\n   * @param {HTMLElement} current The search suggestion or input field currently with focus\n   */\n  prevSuggestion(current) {\n    if (!this.$output) {\n      return;\n    }\n\n    if (current === this.$input) {\n      this.$output.querySelector('ul li:last-child').focus();\n    } else if (!!current.previousElementSibling) {\n      current.previousElementSibling.focus();\n    } else {\n      this.$input.focus();\n    }\n  }\n\n  /**\n   * Copy the display text of the current suggestion into the search field.\n   *\n   * @param {HTMLElement} target The element containing the text to use\n   */\n  useSuggestion(target) {\n    this.$input.value = target.innerHTML.replace(/<\\/?strong>/g, '');\n    if (this.$output) {\n      this.$output.innerHTML = '';\n      if (this.$input.value.length) {\n        this.$form.submit();\n      }\n    }\n  }\n\n  /**\n   * Gets the keywords for the supplied searchBox.\n   *\n   * @param {SearchBox} searchBox The injected search box\n   */\n  static getKeywords(searchBox) {\n    return searchBox.keywords;\n  }\n\n  /**\n   * Sets the keywords for the supplied searchBox.\n   *\n   * @param {Array} keywords The keywords for the searchBox\n   * @param {SearchBox} searchBox The injected search box\n   */\n  static setKeywords(keywords, searchBox) {\n    searchBox.keywords = keywords;\n  }\n\n  /**\n   * Filter keywords by the contents of the search field.\n   *\n   * @param {string} searchTerm The search term to filter the keywords by\n   * @param {Array} keywords The keywords to filter\n   */\n  filterKeywordsBySearchTerm(keywords, searchTerm) {\n    let matches;\n    if (searchTerm) {\n      matches = keywords.filter(keyword => keyword.toLowerCase().indexOf(\n                                                                  searchTerm.toLowerCase()) !== -1);\n\n      matches.sort();\n      for (let i = 0; i < matches.length; i += 1) {\n        matches[i] = SearchBox.embolden(matches[i], searchTerm);\n      }\n    }\n\n    return matches;\n  }\n\n  /**\n   * Returns phrase with specified (case insensitive) snippet emboldened.\n   *\n   * @param {string} phrase The phrase containing the text to embolden\n   * @param {string} snippet The substring of phrase to embolden\n   * @returns {string} The phrase with the snippet emboldened\n   */\n  static embolden(phrase, snippet) {\n    // Don't nest emboldening elements.\n    if (snippet.indexOf('<strong>') > -1) {\n      return phrase;\n    }\n\n    let snippetRx = new RegExp(snippet, 'i');\n    let toEmbolden = phrase.match(snippetRx) ? phrase.match(snippetRx)[0] : null;\n    if (!toEmbolden) {\n      return phrase;\n    }\n\n    return phrase.replace(toEmbolden, `<strong>${toEmbolden}</strong>`);\n  }\n\n  /**\n   * Update the search suggestions based on matches found.\n   *\n   * @param {Array} matches The matches found\n   * @param {HTMLElement} $output Element to contain the display\n   */\n  display(matches, $output) {\n    let outputString = '';\n\n    if ($output) {\n      $output.innerHTML = '';\n      this.nudgeOutputVertically('-47px');\n\n      if (matches && matches.length) {\n        matches.forEach(match => {\n          outputString += `<li tabindex=\"0\" class=\"search-box__suggestion\">${match}</li>`;\n        });\n\n        outputString = `<ul>${outputString}</ul>`;\n        $output.innerHTML = outputString;\n      }\n    }\n\n  }\n\n  /**\n   * Uses css transform to translate $output in the vertical axis.\n   *\n   * @param posnInPx The vertical offset to apply\n   */\n  nudgeOutputVertically(posnInPx) {\n    let posn;\n    if (typeof posnInPx === 'string' && posnInPx.indexOf('px') === posnInPx.length - 2) {\n      posn = posnInPx;\n    } else if (!isNaN(posnInPx)) {\n      posn = posnInPx + 'px';\n    }\n\n    utils.updateElementTranslate(this.$output, [0, posn]);\n  }\n\n  /**\n   * Toggle the flag that limits the search.\n   */\n  toggleSearchLimiting() {\n    this.isSearchLimited = !this.isSearchLimited;\n  }\n\n};\n","'use strict';\n\nmodule.exports = class SelectNav {\n\n  constructor($elm) {\n    if (!$elm) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.$elm.classList.add('select-nav--js');\n    this.$elm.querySelector('select').addEventListener('change', this.triggerSubmit.bind(this));\n  }\n\n  triggerSubmit() {\n    this.$elm.submit();\n  }\n\n};\n","'use strict';\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = class SiteHeader {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n\n    let SearchBox = require('./SearchBox');\n    let $searchBoxEl = $elm.querySelector('[data-behaviour=\"SearchBox\"]');\n    this.searchBox = new SearchBox($searchBoxEl, this.window, doc);\n    var searchToggle = $elm.querySelector('[rel=\"search\"]');\n    if (!!searchToggle) {\n      this.searchToggle = searchToggle.parentNode;\n      this.searchToggle.addEventListener('click', this.toggleSearchBox.bind(this));\n    }\n\n    this.$pageOverlay = null;\n\n    // N.B. $mainMenu is not part of this component's HTML hierarchy.\n    var mainMenu = doc.querySelector('#mainMenu');\n    if (!!mainMenu) {\n      let MainMenu = require('./MainMenu');\n      this.mainMenu = new MainMenu(mainMenu);\n\n      this.$mainMenuToggle = this.$elm.querySelector('a[href=\"#mainMenu\"]');\n      if (!!this.$mainMenuToggle) {\n        this.mainMenu.moveWithinDom();\n        this.$mainMenuToggle.addEventListener('click', this.toggleMainMenu.bind(this));\n      }\n    }\n  }\n\n  /**\n   * Toggles display of the main menu.\n   */\n  toggleMainMenu(e) {\n    if (this.mainMenu.isOpen()) {\n      this.mainMenu.close();\n      this.window.removeEventListener('keyup', this.checkForMenuClose.bind(this));\n      this.doc.querySelector('.global-inner').\n               removeEventListener('click', this.checkForMenuClose.bind(this));\n    } else {\n      this.mainMenu.open();\n      this.window.addEventListener('keyup', this.checkForMenuClose.bind(this));\n      this.doc.querySelector('.global-inner').\n               addEventListener('click', this.checkForMenuClose.bind(this));\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  checkForMenuClose(e) {\n    if (e.keyCode === 27 || e.type === 'click') {\n      this.mainMenu.close();\n    }\n  }\n\n  /**\n   * Toggles display of the search box.\n   *\n   * @param {Event} e The event causing the toggle to occur\n   */\n  toggleSearchBox(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.searchBoxIsOpen()) {\n      this.closeSearchBox();\n    } else {\n      this.openSearchBox();\n    }\n  }\n\n  /**\n   * Returns true if the search box is currently displayed.\n   *\n   * @returns {boolean} True if the search box is open\n   */\n  searchBoxIsOpen() {\n    return this.searchBox.$elm.classList.contains('search-box--shown');\n  }\n\n  /**\n   * Closes the search box.\n   */\n  closeSearchBox() {\n    this.searchBox.$elm.classList.remove('search-box--shown');\n    utils.updateElementTranslate(this.searchBox.$elm, [0, '-40px']);\n    if (this.searchBox.$output) {\n      this.searchBox.$output.innerHTML = '';\n    }\n\n    this.searchBox.$input.blur();\n    this.window.removeEventListener('keyup', this.checkForClose.bind(this));\n    this.window.removeEventListener('click', this.checkForClose.bind(this));\n    this.hidePageOverlay();\n  }\n\n  /**\n   * Decides whether to close the search box, based on the supplied event.\n   *\n   * @param e The KeyboardEvent provoking the check.\n   */\n  checkForClose(e) {\n    if (e.keyCode && e.keyCode === 27 ||\n        (e.type === 'click' && !utils.areElementsNested(this.searchBox.$elm, e.target))) {\n      this.closeSearchBox();\n    }\n  }\n\n  /**\n   * Opens the search box.\n   */\n  openSearchBox() {\n    let myHeight = this.window.getComputedStyle(this.$elm).height;\n    let adjustment = 20;\n    let offsetY = utils.adjustPxString(myHeight, adjustment);\n\n    // This is set in the site-header.scss.\n    let transitionDurationInMs = 150;\n    utils.updateElementTranslate(this.searchBox.$elm, [0, offsetY]);\n    utils.invertPxString(this.window.getComputedStyle(this.searchBox.$container).height);\n    this.searchBox.$elm.classList.add('search-box--shown');\n    this.window.addEventListener('keyup', this.checkForClose.bind(this));\n    this.window.addEventListener('click', this.checkForClose.bind(this));\n\n    this.window.setTimeout(() => {\n\n      // blur before focus forces the focus, a simple focus doesn't always behave as expected.\n      this.searchBox.$input.blur();\n      this.searchBox.$input.focus();\n    }, transitionDurationInMs);\n    this.showPageOverlay();\n  }\n\n  /**\n   * Creates the page overlay.\n   *\n   */\n  createPageOverlay() {\n    let className = 'overlay--semi-white';\n\n    if (!this.$pageOverlay) {\n      this.$pageOverlay = this.doc.createElement('div');\n      this.$pageOverlay.classList.add(className);\n    }\n\n    let $target = this.doc.querySelector('.global-inner');\n    $target.insertBefore(this.$pageOverlay,\n                         this.doc.querySelector('.site-header').nextElementSibling);\n  }\n\n  /**\n   * Shows the page overlay.\n   */\n  showPageOverlay() {\n    if (!this.$pageOverlay) {\n      this.createPageOverlay();\n    }\n\n    this.$pageOverlay.style.display = 'block';\n    this.$pageOverlay.style.height = this.doc.querySelector('.global-inner')\n                                         .getBoundingClientRect().height + 'px';\n  }\n\n  /**\n   * Hides the page overlay.\n   */\n  hidePageOverlay() {\n    this.$pageOverlay.style.display = 'none';\n  }\n\n};\n","'use strict';\n\nmodule.exports = class ViewSelector {\n\n  constructor($elm, _window = window, doc = document) {\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n    this.cssFixedClassName = 'view-selector--fixed';\n\n    // matches top padding in scss\n    let topSpaceWhenFixed = 30;\n\n    this.$elmYOffset = this.$elm.offsetTop - topSpaceWhenFixed;\n    this.window.addEventListener('scroll', this.handleScroll.bind(this));\n\n  }\n\n  handleScroll() {\n    if (this.$elm.classList.contains(this.cssFixedClassName)) {\n      if (this.window.pageYOffset < this.$elmYOffset) {\n        this.$elm.classList.remove(this.cssFixedClassName);\n      }\n    } else if (this.window.pageYOffset >= this.$elmYOffset) {\n      this.$elm.classList.add(this.cssFixedClassName);\n    }\n  }\n\n};\n","\nmodule.exports = class ViewerModal {\n\n  constructor($elm) {\n    this.$elm = $elm;\n    this.$prev = document.createElement('div');\n    this.$next = document.createElement('div');\n\n    // build the modal\n    this.build();\n\n    // events\n    this.$prev.addEventListener('click', this.prev);\n    this.$next.addEventListener('click', this.next);\n  }\n\n  build() {\n    //\n  }\n\n  prev(e) {\n    e.preventDefault();\n  }\n\n  next(e) {\n    e.preventDefault();\n  }\n\n  close() {\n    //\n  }\n\n};\n","module.exports = () => {\n  'use strict';\n\n  /**\n   * Builds and returns specified HTML element, optionally adding it to the DOM.\n   *\n   * @param {string} elName Name of the HTML element to build\n   * @param {Array} [cssClasses] CSS class name(s) to set on the element\n   * @param {string} [textContent] Textual content of the element\n   * @param {string|Element} [parent] Parent element to attach to\n   * @param {string|Element|boolean} [attachBefore] Following sibling (1st if true, last if falsey)\n   *\n   * @returns {Element}\n   */\n  function buildElement(elName, cssClasses, textContent, parent, attachBefore) {\n\n    var $el = document.createElement(elName);\n    var $parent = typeof parent === 'string' ? document.querySelector(parent)\n      : parent;\n\n    // Work out what the new element's following sibling will be, based on value of attachBefore.\n    var $followingSibling = (function () {\n\n      if (!!attachBefore) {\n\n        if (typeof attachBefore === 'boolean') {\n          return $parent.firstElementChild;\n\n        } else if (typeof attachBefore === 'string') {\n          return document.querySelector(attachBefore);\n\n        } else if (attachBefore instanceof HTMLElement) {\n          return attachBefore;\n\n        }\n      }\n    }());\n\n    cssClasses.forEach(cssClass => {\n      $el.classList.add(cssClass);\n    });\n\n    if (textContent) {\n      $el.innerHTML = textContent;\n    }\n\n    if (!!$parent && !!$followingSibling) {\n      $parent.insertBefore($el, $followingSibling);\n    } else {\n      $parent.appendChild($el);\n    }\n\n    return $el;\n  }\n\n  var uniqueIds = (function uniqueIds() {\n\n    class UniqueIdentifiers {\n\n      constructor () {\n        this.used = [];\n      }\n\n      isValid(candidate, document) {\n        // Compulsory check that id is unique to this object's knowledge.\n        if (this.used.indexOf(candidate) > -1) {\n          return false;\n        }\n\n        // Optional check to see if id is unique in the DOM.\n        if (!!document) {\n          if (!!document.querySelector &&\n              typeof document.querySelector === 'function' &&\n              document.querySelector('#' + candidate)) {\n            return false;\n          }\n        }\n\n        return true;\n      }\n\n      /**\n       * Gets a unique id with optional prefix.\n       *\n       * @param {string} [prefix] Prefix to use for the id\n       * @param {HTMLDocument} [document] Enables checking for the id's uniqueness within the DOM\n       * @returns {string}\n       */\n      get(prefix, document) {\n        var _prefix = '' + prefix || 'default_';\n        var random = ('' + Math.random()).replace(/\\./, '');\n        var candidate = _prefix + random;\n        if (this.isValid(candidate)) {\n          return candidate;\n        }\n\n        this.get(prefix, document);\n      }\n    }\n\n    return new UniqueIdentifiers();\n  }());\n\n  /**\n   * Updates the CSS transform's translate function on the element in a vendor-prefix-aware fashion.\n   *\n   * Because of the way CSS transformations are combined into a matrix, this may not work\n   * as expected if other CSS transformations are also applied to the same element.\n   *\n   * @param {HTMLElement} $el The element to apply the transformation to.\n   * @param {Array} offset The offset for both axes, expressed as [x, y], e.g. [0, '20px']\n   */\n  function updateElementTranslate($el, offset) {\n    if (!($el instanceof HTMLElement && Array.isArray(offset))) {\n      return;\n    }\n\n    let props = ['webkitTransform', 'mozTransform', 'msTransform', 'oTransform', 'transform'];\n    let offsetX = offset[0];\n    let offsetY = offset[1] || 0;\n\n    props.forEach((prop) => {\n      $el.style[prop] = 'translate(' + offsetX + ', ' + offsetY + ')';\n    });\n  }\n\n  /**\n   * Add a quantity to a px amount expressed as a string, and return new string with updated value.\n   *\n   * For example: adjustPxString('97px', 8) returns '105px'\n   *\n   * @param {String} pxString The string representing the original quantity, e.g. '97px'\n   * @param adjustment The numeric adjustment to make, e.g. 8\n   * @returns {string} The modified value, as a string, e.g.: '105px'\n   */\n  function adjustPxString(pxString, adjustment) {\n    let originalSize = parseInt(pxString.match(/([-0-9.]+)px/)[1], 10);\n    let newSize = originalSize + adjustment;\n    return newSize + 'px';\n  }\n\n  /**\n   * Invert the px amount expressed as a string, and return new string with inverted value.\n   *\n   * For example: invertPxString('97px') returns '-97px'\n   *\n   * @param {String} pxString The string representing the original quantity, e.g. '97px'\n   * @returns {string} The modified value, as a string, e.g.: '-97px'\n   */\n  function invertPxString(pxString) {\n    let originalSize = parseInt(pxString.match(/([-0-9.]+)px/)[1], 10);\n    let newSize = originalSize * -1;\n    return newSize + 'px';\n  }\n\n  /**\n   * Returns true if $prospectiveDescendant is, or is a descendant of $prospectiveParent.\n   *\n   * @param {HTMLElement} $prospectiveParent el to test as a parent of the $prospectiveDescendant\n   * @param {HTMLElement} $prospectiveDescendant el to test as descendant of the $prospectiveParent\n   * @returns {boolean} Whether the s$prospectiveDescendant is, or descends from $prospectiveParent\n   */\n  function areElementsNested($prospectiveParent, $prospectiveDescendant) {\n    let relationship = $prospectiveParent.compareDocumentPosition($prospectiveDescendant);\n    return !!(\n      relationship & $prospectiveParent.DOCUMENT_POSITION_CONTAINED_BY || relationship === 0\n    );\n  }\n\n  /**\n   * Return the current viewport width.\n   *\n   * @returns {number} The current viewport width\n   */\n  function getViewportWidth() {\n    return document.documentElement.clientWidth;\n  }\n\n  /**\n   * Returns whether the display is considered to have a high pixel density ratio.\n   *\n   * @param window\n   * @returns {boolean} true if dpr >= 2, false if lower, or unknown.\n   */\n  function isHighDpr(window) {\n    if (!!window.devicePixelRatio) {\n      return window.devicePixelRatio >= 2;\n    }\n\n    return false;\n  }\n\n  return {\n    adjustPxString: adjustPxString,\n    areElementsNested: areElementsNested,\n    buildElement: buildElement,\n    getViewportWidth: getViewportWidth,\n    invertPxString: invertPxString,\n    isHighDpr: isHighDpr,\n    uniqueIds: uniqueIds,\n    updateElementTranslate: updateElementTranslate,\n  };\n\n};\n","'use strict';\n\n// Base level of feature support needed for the js loaded in this file.\n// Consider AJAXing in the rest if the test passes.\nif (window.localStorage && document.querySelector &&\n       window.addEventListener && !!(document.createElement('div')).classList) {\n\n  document.querySelector('html').classList.add('js');\n\n  let Components = {};\n\n  // import modules into the list of Components.\n  Components.ArticleSection = require('./components/ArticleSection');\n  Components.ArticleDownloadLinksList = require('./components/ArticleDownloadLinksList');\n  Components.AudioPlayer = require('./components/AudioPlayer');\n  Components.ContentHeaderArticle = require('./components/ContentHeaderArticle');\n  Components.BackgroundImage = require('./components/BackgroundImage');\n  Components.SelectNav = require('./components/SelectNav');\n  Components.MainMenu = require('./components/MainMenu');\n  Components.MediaChapterListingItem = require('./components/MediaChapterListingItem');\n  Components.SiteHeader = require('./components/SiteHeader');\n  Components.SearchBox = require('./components/SearchBox');\n  Components.ViewerModal = require('./components/ViewerModal');\n  Components.ViewSelector = require('./components/ViewSelector');\n\n  // App\n  let Elife = function Elife() {\n\n    function initialiseComponent($component) {\n      // When present, data-behaviour contains a space-separated list of handlers for that component\n      let handlers = $component.getAttribute('data-behaviour').trim().split(' ');\n      for (let i = 0; i < handlers.length; i += 1) {\n        let handler = handlers[i];\n        if (Components[handler] && typeof Components[handler] === 'function') {\n          new Components[handler]($component, window, window.document);\n        }\n      }\n    }\n\n    let components = document.querySelectorAll('[data-behaviour]');\n    if (components) {\n      [].forEach.call(components, initialiseComponent);\n    }\n\n  };\n\n  new Elife();\n}\n"]}