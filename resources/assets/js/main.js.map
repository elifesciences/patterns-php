{"version":3,"sources":["node_modules/browser-pack/_prelude.js","assets/js/components/ArticleDownloadLinksList.js","assets/js/components/AudioPlayer.js","assets/js/components/BackgroundImage.js","assets/js/components/ContentHeaderArticle.js","assets/js/components/MainMenu.js","assets/js/components/MediaChapterListingItem.js","assets/js/components/SearchBox.js","assets/js/components/SelectNav.js","assets/js/components/SiteHeader.js","assets/js/components/ViewerModal.js","assets/js/libs/elife-utils.js","assets/js/main.js"],"names":[],"mappings":"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","file":"main.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = class ArticleDownloadLinksList {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n\n    // One statement per class name because IE doesn't support multiple strings, comma separated.\n    this.$elm.classList.add('article-download-links-list--js');\n    this.$elm.classList.add('visuallyhidden');\n    this.moveList();\n    this.$toggler = this.doc.querySelector('.content-header__download_link');\n    this.$toggler.addEventListener('click', this.toggle.bind(this));\n  }\n\n  /**\n   * Moves the download links list to be by the icon this.$toggler\n   */\n  moveList() {\n    let $newParent = this.doc.querySelector('.content-header_top');\n    let $followingSibling =\n      $newParent.querySelector('.content-header__download_link').nextElementSibling;\n    $newParent.insertBefore(this.$elm, $followingSibling);\n  }\n\n  /**\n   * Toggles the download links list display.\n   *\n   * @param e The event triggering the display toggle\n   */\n  toggle(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.isOpen()) {\n      this.close();\n    } else {\n      this.open();\n    }\n\n  }\n\n  /**\n   * Returns whether links list is currently viewable.\n   *\n   * @returns {boolean} Whether links list is currently viewable\n   */\n  isOpen() {\n    return !this.$elm.classList.contains('visuallyhidden');\n  }\n\n  /**\n   * Make viewable.\n   */\n  open() {\n    this.$elm.classList.remove('visuallyhidden');\n    this.window.addEventListener('click', this.checkForClose.bind(this));\n  }\n\n  /**\n   * Checks whether a click occurred outside this, and close this if it did.\n   *\n   * @param e The click event to evaluate the target of\n   */\n  checkForClose(e) {\n    if (!utils.areElementsNested(this.$elm, e.target)) {\n      this.close();\n    }\n  }\n\n  /**\n   * Make unviewable.\n   */\n  close() {\n    this.$elm.classList.add('visuallyhidden');\n    this.window.removeEventListener('click', this.checkForClose.bind(this));\n  }\n\n};\n","'use strict';\nvar utils = require('../libs/elife-utils')();\nmodule.exports = class AudioPlayer {\n\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      console.warn('No element provided');\n      return;\n    }\n\n    this.window = _window;\n    if (!this.window.HTMLAudioElement) {\n      console.warn('Audio element not supported');\n      return;\n    }\n\n    console.log('Initialising Audio Player...');\n\n    this.$elm = $elm;\n    this.$audioElement = this.$elm.querySelector('audio');\n    if (!this.$audioElement) {\n      console.warn('No audio element found');\n      return;\n    }\n\n    this.uniqueId = utils.uniqueIds.get('audio', doc);\n    this.$elm.id = this.uniqueId;\n    this.$playButton = AudioPlayer.buildPlayButton(this);\n    this.$icon = this.$playButton.querySelector('.audio-player__toggle_play_icon');\n\n    // $title must be prepared before buildProgressIndicator is called\n    this.$title = this.prepare$title(this.$elm.querySelector('.audio-player__header'), doc);\n    this.$progressTrack = AudioPlayer.buildProgressIndicator(this);\n    this.$progressBar = this.$progressTrack.querySelector('[class*=\"progress_bar\"]');\n    this.$timeIndicators = AudioPlayer.buildTimeIndicators(this);\n    this.$currentTime = this.$timeIndicators.querySelector('[class*=\"current_time\"]');\n    this.$duration = this.$timeIndicators.querySelector('[class*=\"duration\"]');\n\n    // state\n    this.duration = null;\n    this.isPlaying = false;\n\n    this.$elm.classList.add('audio-player--js');\n\n    this.$playButton.classList.add('loading');\n    this.$audioElement.addEventListener('loadedmetadata', () => {\n      this.playerReady(this);\n    });\n\n    this.usingMetadata = false;  // set to true in loadMetadata if no errors thrown\n    this.loadMetadata(this.$elm.dataset.episodeNumber);\n\n  }\n\n  playerReady(player) {\n    player.duration = player.$audioElement.duration;\n    player.$duration.innerHTML = AudioPlayer.secondsToMinutes(player.duration);\n    player.$playButton.addEventListener('click', () => {\n      player.togglePlay(player.$audioElement, player.$playButton);\n    }, false);\n    player.$audioElement.addEventListener('timeupdate', player.update.bind(player));\n    player.window.addEventListener('hashchange', player.seekNewTime.bind(player));\n    player.window.addEventListener('load', player.seekNewTime.bind(player));\n    this.$playButton.classList.remove('loading');\n\n    let playerReady;\n    try {\n      playerReady = new CustomEvent('playerReady', { detail: this.uniqueId });\n    } catch (e) {\n      // CustomEvent not supported, do it the old fashioned way\n      playerReady = document.createEvent('playerReady');\n      playerReady.initCustomEvent('playerReady', true, true, { detail: this.uniqueId });\n    }\n\n    player.window.dispatchEvent(playerReady);\n\n  }\n\n  prepare$title(parent, doc) {\n    let span = doc.createElement('span');\n    try {\n      span.innerHTML = parent.innerHTML;\n    } catch (e) {\n      return;\n    }\n\n    span.classList.add('audio-player__title');\n    parent.innerHTML = '';\n    parent.appendChild(span);\n    return span;\n  }\n\n  /**\n   * Converts seconds to a display of minutes & seconds.\n   *\n   * @param {Number} seconds The time to convert, in seconds\n   * @returns {string} The time in a [m]m:ss string\n   */\n  static secondsToMinutes(seconds) {\n    let _seconds = parseInt(seconds, 10);\n    let mins = Math.floor(_seconds / 60);\n    let secs = _seconds % 60;\n    if (secs <= 9) {\n      secs = '0' + secs;\n    }\n\n    return `${mins}:${secs}`;\n  }\n\n  //noinspection JSValidateJSDoc\n  /**\n   * Toggles play/pause state of media file.\n   *\n   * @param {HTMLAudioElement} $audioElement The audio element to toggle the play state of\n   * @param {HTMLButtonElement} $togglePlayButton The button controlling the playback\n   */\n  togglePlay($audioElement, $togglePlayButton) {\n    if (this.isPlaying) {\n      this.pause($audioElement, $togglePlayButton);\n    } else {\n      this.play($audioElement, $togglePlayButton);\n    }\n  }\n\n  play($audioElement, $togglePlayButton) {\n    $audioElement.play();\n    AudioPlayer.updateIconState(this.$icon, 'pause');\n    $togglePlayButton.classList.add('audio-player__toggle_play--pauseable');\n    $togglePlayButton.classList.remove('audio-player__toggle_play--playable');\n    this.isPlaying = true;\n  }\n\n  pause ($audioElement, $togglePlayButton) {\n    $audioElement.pause();\n    AudioPlayer.updateIconState(this.$icon, 'play');\n    $togglePlayButton.classList.add('audio-player__toggle_play--playable');\n    $togglePlayButton.classList.remove('audio-player__toggle_play--pauseable');\n    this.isPlaying = false;\n  }\n\n  /**\n   * Update the progress bar and elapsed time indicator based on track's current time.\n   */\n  update() {\n    let currentTime = Math.floor(this.$audioElement.currentTime);\n    let pc = (currentTime / this.duration) * 100;\n    let currentTime2Dis = AudioPlayer.secondsToMinutes(currentTime);\n    this.$progressBar.style.width = `${pc}%`;\n    this.$currentTime.innerHTML = currentTime2Dis;\n\n    if (this.usingMetadata) {\n      let chapterNumberOnLastUpdate = this.getCurrentChapterNumber();\n      this.setCurrentChapterMetadata(this.getChapterMetadataAtTime(currentTime,\n                                                                   this.chapterMetadata));\n      if (this.getCurrentChapterMetadata().number !== chapterNumberOnLastUpdate) {\n        this.changeChapter(this.getCurrentChapterNumber(),\n                           this.getCurrentChapterMetadata().title,\n                           this.$elm);\n      }\n    }\n\n    if (this.$audioElement.ended) {\n      AudioPlayer.updateIconState(this.$icon, 'play');\n      this.isPlaying = false;\n    }\n  }\n\n  /**\n   * Updates player title with chapter number & name, and dispatches chapterChanged event.\n   *\n   * @param {int} number New chapter number Used as value of detail property of\n   * @param {String} title new chapter title\n   * @param {HTMLElement} $elm Element from which to dispatch the event\n   */\n  changeChapter(number, title, $elm) {\n    this.setTitle(this.episodeTitle, title);\n    let chapterChanged;\n    try {\n      chapterChanged = new CustomEvent('chapterChanged', { detail: number });\n    } catch (e) {\n      // CustomEvent not supported, do it the old fashioned way\n      chapterChanged = document.createEvent('chapterChanged');\n      chapterChanged.initCustomEvent('chapterChanged', true, true, { detail: number });\n    }\n\n    $elm.dispatchEvent(chapterChanged);\n  }\n\n  /**\n   * Updates the icon state for the play button.\n   *\n   * @param $icon {HTMLImageElement} The img to update\n   * @param state {string} The state to update to (either 'play' or 'pause')\n   */\n  static updateIconState($icon, state) {\n    if (state !== 'play' && state !== 'pause') {\n\n      return;\n    }\n\n    $icon.src = AudioPlayer.getIconPath((state));\n    $icon.alt = state;\n  }\n\n  seekNewTime(e) {\n    var hash;\n    var shouldPlay = false;\n    try {\n      hash = e.newURL.substring(e.newURL.indexOf('#') + 1);\n\n      // Should play when chapter changed within the page, but not autoplay on page load :-)\n      shouldPlay = true;\n    } catch (e) {\n      // newURL only available on hashchange event, but load event may also invoke this handler\n      hash = this.window.location.hash.substring(1);\n      shouldPlay = false;\n    }\n\n    if (!isNaN(hash) && hash >= 0) {\n      this.seek(hash, this.$audioElement);\n      if (!this.isPlaying && shouldPlay) {\n        this.play(this.$audioElement, this.$playButton);\n      }\n    }\n  }\n\n  /**\n   * Event handler to determine track seek time in response to user interaction.\n   *\n   * @param e The user-generated click event\n   * @param {AudioPlayer} player The audio player object that the new element belongs to\n   */\n  handleSeek(e, player) {\n    var newSeekPosition = parseInt(e.offsetX, 10);\n    var availableWidth = player.$progressTrack.clientWidth;\n    var durationProportionToSeek = (newSeekPosition / parseInt(availableWidth, 10));\n    this.seek(durationProportionToSeek * player.duration, player.$audioElement);\n  }\n\n  //noinspection JSValidateJSDoc\n  /**\n   * Seeks a particular time in the media file.\n   *\n   * @param {Number} time The time to seek\n   * @param {HTMLAudioElement} $audioElement The audio element to toggle the play state of\n   */\n  seek(time, $audioElement) {\n    $audioElement.currentTime = time;\n    this.update();\n  }\n\n  /**\n   * Builds the progress indicator.\n   *\n   * @param {AudioPlayer} player The audio player object that the new element belongs to\n   * @returns {Element} The progress indicator\n   */\n  static buildProgressIndicator(player) {\n    var $barWrapper = utils.buildElement('div',\n                               ['audio-player__progress'],\n                               '',\n                               '#' + player.uniqueId + ' [class*=\"audio-player__container\"]');\n\n    utils.buildElement('div', ['audio-player__progress_bar'], '', $barWrapper);\n\n    $barWrapper.addEventListener('click', function (e) {\n      player.handleSeek(e, player);\n    }, false);\n\n    return $barWrapper;\n  }\n\n  /**\n   * Builds the play button.\n   *\n   * @param {AudioPlayer} player The audio player object that the new element belongs to\n   * @returns {Element} The play/pause button\n   */\n  static buildPlayButton(player) {\n    var $button = utils.buildElement('button',\n                              ['audio-player__toggle_play'],\n                              '',\n                              '#' + player.uniqueId + ' [class*=\"audio-player\"]',\n                              true);\n    var $image = utils.buildElement('img',\n                       ['audio-player__toggle_play_icon'],\n                       '',\n                       $button);\n    $image.src = AudioPlayer.getIconPath('play');\n    $image.alt = 'Play';\n    return $button;\n  }\n\n  /**\n   * Builds the current time and duration indicators.\n   *\n   * @param {AudioPlayer} player The audio player object that the new element belongs to\n   * @returns {Element} An element containing the current time and duration indicators.\n   */\n  static buildTimeIndicators(player) {\n    var playerId = player.uniqueId;\n    var $container = utils.buildElement('div',\n                                        ['audio-player__times'],\n                                        '',\n                                        '#' + playerId + ' [class*=audio-player__header]',\n                                        true);\n\n    utils.buildElement('span', ['audio-player__current_time'], '0:00', $container);\n    utils.buildElement('span', ['audio-player__duration'], '0:00', $container);\n    return $container;\n  }\n\n  static getIconPath(iconName) {\n\n    if (iconName !== 'play' && iconName !== 'pause') {\n      return;\n    }\n\n    return `../../assets/img/icons/audio-${iconName}.svg`;\n  }\n\n  /**\n   * Set the title based on both episode and chapter titles\n   * @param episodeTitle\n   * @param chapterTitle\n   */\n  setTitle(episodeTitle, chapterTitle) {\n    this.title = episodeTitle;\n    if (!!chapterTitle) {\n      this.title += ': ' + chapterTitle;\n    }\n\n    this.$title.innerHTML = this.title;\n  }\n\n  getCurrentChapterMetadata() {\n    return this.currentChapterMetadata;\n  }\n\n  setCurrentChapterMetadata(metadata) {\n    this.currentChapterMetadata = metadata;\n  }\n\n  getCurrentChapterNumber() {\n    return this.getCurrentChapterMetadata().number || 0;\n  }\n\n  /**\n   * Returns a chapter's title and number, based on the playback position\n   * @param time\n   * @param {Array} chapterMetadata\n   * An array of objects that must contain as a minimum\n   * @returns {*}\n   */\n  getChapterMetadataAtTime(time, chapterMetadata) {\n    if (!chapterMetadata) {\n      return '';\n    }\n\n    let chapterTitle = '';\n    let chapterNumber = 0;\n    chapterMetadata.forEach(function (chapter, i, chapters) {\n      let chapterStartTime = parseInt(chapter.time, 10);\n      let nextChapterStartTime = i < chapters.length - 1 ? chapters[i + 1].time : null;\n      if (time >= chapterStartTime) {\n        if (!nextChapterStartTime || time < nextChapterStartTime) {\n          chapterTitle = chapter.title;\n          chapterNumber = chapter.number;\n        }\n      }\n    });\n\n    return {\n      title: chapterTitle,\n      number: chapterNumber\n    };\n  }\n\n  /**\n   * Sets episode title and respective chapter information from metadata\n   * @param metadata\n   */\n  processMetadata(metadata) {\n    this.episodeTitle = 'Episode ' + metadata.number;\n    this.setTitle(this.episodeTitle);\n\n    this.chapterMetadata = this.prepareChapterMetadata(metadata);\n    this.currentChapterMetadata = { number: 0, title: '' };\n  }\n\n  /**\n   * Returns array of objects describing respective chapter information\n   * @param metadata\n   * @returns {Array} of objects containing time, number and title properties\n   */\n  prepareChapterMetadata(metadata) {\n    let chapterMetadata = [];\n    metadata.chapters.forEach((chapter) => {\n      chapterMetadata.push(\n        {\n          time: chapter.time,\n          number: chapter.number,\n          title: chapter.number + '. ' + chapter.title\n        }\n      );\n    });\n\n    return chapterMetadata;\n  }\n\n  /**\n   * Metadata is expected in the data-metadata attribute of $elm as a JSON-like string with single-\n   * quoted instead of double-quoted values.\n   */\n  loadMetadata() {\n    try {\n      this.processMetadata(JSON.parse(this.$elm.dataset.metadata.replace(/'/g, '\"')));\n      this.usingMetadata = true;\n    } catch (e) {\n      console.error(e);\n      this.usingMetadata = false;\n    }\n  }\n};\n","'use strict';\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = class BackgroundImage {\n\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    let semiTransparentBlack = 'linear-gradient(to top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5))';\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n    this.sourceToUse = this.calcSourceToUse(this.$elm, utils.isHighDpr(this.window));\n    this.$elm.style.backgroundImage = this.setBackground(this.sourceToUse, semiTransparentBlack);\n  }\n\n  setBackground(path, semiTransparentBlack) {\n    if (!path || !path.length || path.length === 0) {\n      return '';\n    }\n\n    return semiTransparentBlack + ', url(' + path + ')';\n  }\n\n  calcSourceToUse(sourceDefiner, isHighDpr) {\n    var lowResSource = '';\n    var highResSource = '';\n    if (!sourceDefiner) {\n      return '';\n    }\n\n    if (!!sourceDefiner.dataset) {\n      highResSource = sourceDefiner.dataset.highResImageSource;\n      lowResSource = sourceDefiner.dataset.lowResImageSource;\n    } else {\n      highResSource = sourceDefiner.getAttribute('data-highResImageSource');\n      lowResSource = sourceDefiner.getAttribute('data-lowResImageSource');\n    }\n\n    if (isHighDpr && !highResSource || !isHighDpr && !lowResSource) {\n      return '';\n    }\n\n    if (isHighDpr) {\n      return highResSource;\n    }\n\n    return lowResSource;\n  }\n\n};\n","'use strict';\n\nmodule.exports = class ContentHeaderArticle {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n    this.$elm.classList.add('content-header-article--js');\n\n    // Should track SASS variable $bkpt-content-header--medium-width.\n    this.breakpointInPx = 768;\n    this.currentView = this.calcCurrentView(this.breakpointInPx);\n\n    this.authors = $elm.querySelectorAll('.content-header__author_list_item');\n    this.institutions = $elm.querySelectorAll('.content-header__institution_list_item');\n\n    this.hasToggleAuthor = false;\n    this.hasToggleInstitution = false;\n    this.hideAllExcessItems('author', this.authors);\n    this.hideAllExcessItems('institution', this.institutions);\n\n    let _this = this;\n    this.window.addEventListener('resize', () => {\n      let newView = _this.calcCurrentView(_this.breakpointInPx);\n      if (newView !== _this.currentView) {\n        _this.currentView = newView;\n        _this.handleAnyExcessItems('author', _this.authors);\n        _this.handleAnyExcessItems('institution', _this.institutions);\n      }\n    });\n\n  }\n\n  handleAnyExcessItems(itemType, items) {\n    let toggle = this.$elm.querySelector('.content-header__item_toggle');\n    if (toggle && toggle.innerHTML.indexOf('less') > -1 && this.currentView === 'wide') {\n      this.clearExcessMark(items);\n      this.toggleExcessItems(items);\n    } else {\n      this.clearExcessMark(items);\n      let excessItems = this.getExcessItems(itemType, items);\n      this.markAsExcess(excessItems);\n      this.toggleExcessItems(items);\n      this.markLastNonExcessItem(itemType, items);\n    }\n  }\n\n  /**\n   * Determine excess by itemType from items supplied and hides those.\n   *\n   * @param {string} itemType 'author' or 'institution'\n   * @param {DOMTokenList} items List of items to identify the excess within, and hide those\n   */\n  hideAllExcessItems(itemType, items) {\n    let excessItems = this.getExcessItems(itemType, items);\n    this.markAsExcess(excessItems);\n    this.toggleExcessItems(items);\n    this.addTrailingText(itemType, items);\n  }\n\n  /**\n   * Returns max number authors or institutions to be displayed by default at current screen width.\n   *\n   * Returns null if itemType is invalid.\n   *\n   * @param {string} itemType 'author' or 'institution'\n   * @returns {number|null} Number of the type of item to display by default at current screen width\n   */\n  getDefaultMaxItems(itemType) {\n    if (this.currentView === 'wide') {\n      if (itemType === 'author') {\n        return 16;\n      }\n\n      if (itemType === 'institution') {\n        return 10;\n      }\n\n    } else {\n      if (itemType === 'author') {\n        return 1;\n      }\n\n      if (itemType === 'institution') {\n        return 0;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Returns array of elements in excess of the default max items, or null if itemType invalid.\n   *\n   * The returned array is a subset of the list supplied, or empty if there are no excess items.\n   *\n   * @param {string} itemType 'author' or 'institution'\n   * @param {DOMTokenList} items List of items from which to identify the excess\n   * @returns {Array|null} Items in excess of the default maximum for the current screen width\n   */\n  getExcessItems(itemType, items) {\n    if (itemType !== 'author' && itemType !== 'institution') {\n      return null;\n    }\n\n    let defaultMaxItems = this.getDefaultMaxItems(itemType);\n    if (items.length > defaultMaxItems) {\n      return [].slice.call(items, defaultMaxItems);\n    }\n\n    return [];\n  }\n\n  /**\n   * Marks supplied list elements as excess.\n   *\n   * @param {Array} els The elements to mark as excess\n   */\n  markAsExcess(els) {\n    els.forEach(function ($el) {\n      $el.classList.add('excess-item');\n    });\n  }\n\n  /**\n   * Clears any excess mark from all elements in the supplied list.\n   *\n   * @param {DOMTokenList} els The elements to clear the excess mark from\n   */\n  clearExcessMark(els) {\n    [].forEach.call(els, function ($el) {\n      $el.classList.remove('excess-item');\n    });\n  }\n\n  /**\n   * Toggles the display of any excess items found in the supplied list of elements.\n\n   * @param {DOMTokenList} items The elements to inspect for excess items, and to toggle those found\n   */\n  toggleExcessItems(items) {\n    [].forEach.call(items, function (item) {\n      if (item.classList.contains('excess-item')) {\n        item.classList.add('visuallyhidden');\n      } else {\n        item.classList.remove('visuallyhidden');\n      }\n    });\n  }\n\n  /**\n   * Returns the name of the current view.\n   *\n   * @param {number} breakpoint The px viewport width that determines the view.\n   *\n   * @returns {string} the view name ('wide' or 'narrow').\n   */\n  calcCurrentView(breakpoint) {\n    return this.window.matchMedia('(min-width: ' + breakpoint + 'px)').matches ? 'wide' : 'narrow';\n  }\n\n  /**\n   * Marks the last shown non-excess item with particlular class (so not if showing last in list).\n   *\n   * @param {string} itemType 'author' or 'institution'\n   * @param {DOMTokenList} items List of items to act upon\n   */\n  markLastNonExcessItem(itemType, items) {\n    let lastShownIndex = null;\n    let foundLastShown = false;\n    [].forEach.call(items, function (item, i) {\n\n      // Clear old any obsolete determination of what's the last non-excess item.\n      items[i].classList.remove('content-header__' + itemType + '--last-non-excess');\n      if (item.classList.contains('excess-item') && !foundLastShown) {\n        lastShownIndex = i - 1;\n        foundLastShown = true;\n      }\n    });\n\n    if (lastShownIndex !== null && lastShownIndex > -1) {\n      let lastShown = items[lastShownIndex].querySelector('.content-header__' + itemType);\n      if (lastShown) {\n        lastShown.classList.add('content-header__' + itemType + '--last-non-excess');\n      }\n    }\n\n  }\n\n  /**\n   * Adds trailing text to the visible end of truncated author & institution lists & builds toggle.\n   *\n   * @param {string} itemType The type of items supplied\n   * @param {DOMTokenList} items The items to which to add the trailing text\n   */\n  addTrailingText(itemType, items) {\n    if (itemType === 'author' && items.length > this.getDefaultMaxItems('author')) {\n      if (!this.hasToggleAuthor) {\n        this.buildSeeMoreLessToggle('author');\n        this.hasToggleAuthor = true;\n      }\n\n    }\n\n    if (itemType === 'institution' && items.length > this.getDefaultMaxItems('institution')) {\n      if (!this.hasToggleInstitution) {\n        this.buildSeeMoreLessToggle('institution');\n        this.hasToggleInstitution = true;\n      }\n\n    }\n\n    this.markLastNonExcessItem(itemType, items);\n  }\n\n  /**\n   * Builds the show/hide toggle for excess authors & institutions.\n   */\n  buildSeeMoreLessToggle(itemType) {\n    // This toggle only required due to screen width constraints. All content already accessible as\n    // it's not being hidden in the first place. Hence an aria-hidden li, rather than an anchor.\n    // Should conform to https://www.w3.org/TR/wai-aria/states_and_properties#aria-hidden\n    let toggle = this.doc.createElement('li');\n    let toggleOnText = 'see&nbsp;all';\n    let toggleOffText = 'see&nbsp;less';\n    toggle.setAttribute('aria-hidden', 'true');\n    toggle.classList.add('content-header__item_toggle', 'content-header__item_toggle--' + itemType);\n    toggle.innerHTML = '&nbsp;&hellip;&nbsp;' + toggleOnText;\n    toggle.addEventListener('click', e => {\n      let target = e.target;\n      if (target.innerHTML.indexOf(toggleOnText) > -1) {\n        [].forEach.call(this.doc.querySelectorAll('.content-header__item_toggle'), item => {\n          item.innerHTML = '&nbsp;' + toggleOffText;\n        });\n        this.clearExcessMark(this.authors);\n        this.clearExcessMark(this.institutions);\n        this.toggleExcessItems(this.authors);\n        this.toggleExcessItems(this.institutions);\n      } else {\n        [].forEach.call(this.doc.querySelectorAll('.content-header__item_toggle'), item => {\n          item.innerHTML = '&nbsp;&hellip;&nbsp;' + toggleOnText;\n        });\n        this.hideAllExcessItems('author', this.authors);\n        this.hideAllExcessItems('institution', this.institutions);\n      }\n    });\n    this.$elm.querySelector('.content-header__' + itemType + '_list').appendChild(toggle);\n  }\n\n};\n","'use strict';\n\nmodule.exports = class MainMenu {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n  }\n\n  /**\n   * Moves main menu from default non-js DOM position into position required by js implementation.\n   */\n  moveWithinDom() {\n    this.$elm.classList.add('main-menu--js');\n    let $globalWrapper = this.doc.querySelector('.global-wrapper');\n    if (!!$globalWrapper) {\n      $globalWrapper.insertBefore(this.$elm, $globalWrapper.firstElementChild);\n    }\n  }\n\n  /**\n   * Indicates whether the main menu is currently open.\n   *\n   * @returns {boolean} true if the main menu is currently open\n   */\n  isOpen() {\n    return this.$elm.classList.contains('main-menu--shown');\n  }\n\n  /**\n   * Closes the main menu\n   */\n  close () {\n    this.$elm.classList.remove('main-menu--shown');\n    this.doc.querySelector('.global-wrapper').classList.remove('pull-offscreen-right');\n  }\n\n  /**\n   * Opens the main menu\n   */\n  open () {\n    this.$elm.classList.add('main-menu--shown');\n    this.doc.querySelector('.global-wrapper').classList.add('pull-offscreen-right');\n  }\n\n};\n","'use strict';\nmodule.exports = class MediaChapterListingItem {\n\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      console.warn('No element provided');\n      return;\n    }\n\n    console.log('Initialising Chapter listing item...');\n\n    this.$elm = $elm;\n    this.startTime = $elm.dataset.startTime;\n    if (!this.startTime || isNaN(this.startTime) || this.startTime < 0) {\n      return;\n    }\n\n    this.window = _window;\n    this.document = doc;\n\n    // When ready, AudioPlayer dispatches a custom event 'playerReady' on window, that supplies that\n    // player's html element id.\n    _window.addEventListener('playerReady', this.listenForChapterChange.bind(this));\n    this.$link = this.createLink(doc, this.$elm, this.startTime);\n    this.setupEventHandlers(this.$link);\n\n  }\n\n  listenForChapterChange (e) {\n    let $player = this.document.querySelector('#' + e.detail);\n    if (!!$player) {\n      $player.addEventListener('chapterChanged', this.indicateChapterChanged.bind(this));\n    }\n  }\n\n  createLink(document, $rootElm, startTime) {\n    let $title = $rootElm.querySelector('.teaser__header_text');\n    if (!$title) {\n      return;\n    }\n\n    let titleText;\n    let $existingLink;\n    try {\n      $existingLink = $title.querySelector('.teaser__header_text_link');\n      titleText = $existingLink.innerHTML;\n      $existingLink.parentNode.removeChild($existingLink);\n    } catch (e) {\n      titleText = $title.innerHTML;\n    }\n\n    let $link = document.createElement('a');\n    $link.innerHTML = titleText;\n    $link.setAttribute('href', '#' + startTime);\n    $link.classList.add('teaser__header_text_link');\n    $title.innerHTML = '';\n    $title.appendChild($link);\n    return $link;\n  }\n\n  indicateChapterChanged(e) {\n    let currentChapterNumber = e.detail;\n    if (currentChapterNumber === this.window.parseInt(this.$elm.dataset.chapterNumber)) {\n      this.$elm.classList.add('current-chapter');\n    } else {\n      this.$elm.classList.remove('current-chapter');\n    }\n  }\n\n  setupEventHandlers($link) {\n    $link.addEventListener('chapterChanged', this.indicateChapterChanged);\n  }\n\n};\n","'use strict';\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = class SearchBox {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.$container = $elm.querySelector('fieldset');\n    this.$form = $elm.querySelector('form');\n    this.$input = $elm.querySelector('input[type=\"search\"]');\n    this.$limit = $elm.querySelector('input[type=\"checkbox\"]');\n    this.$elm = $elm;\n    this.$searchButton = $elm.querySelector('button[type=\"submit\"]');\n    this.$resetButton = $elm.querySelector('button[type=\"reset\"]');\n    this.$inner = $elm.querySelector('.search-box__inner');\n\n    // Check there's a search input field, if not everything else is pointless.\n    if (!this.$input) {\n      return;\n    }\n\n    // TODO: Remove if not ultimately useful.\n    this.isSearchLimited = this.$limit && this.$limit.checked;\n\n    this.$elm.classList.add('search-box--js');\n\n    // setup\n    this.$form.setAttribute('autocomplete', 'off');\n\n    if (!doc.querySelector('.search-box__output')) {\n      this.$output = doc.createElement('div');\n      this.$output.innerHTML = '';\n      this.$output.classList.add('search-box__output');\n      this.$output.addEventListener('keyup', e => {\n        SearchBox.handleKeyEntry(e, this);\n      });\n      this.$output.addEventListener('click', e => {\n        this.useSuggestion(e.target);\n      });\n      this.$inner.appendChild(this.$output);\n    }\n\n    this.keywords = [];\n\n    // events\n    this.$resetButton.addEventListener('click', this.reset.bind(this));\n    this.$input.addEventListener('keyup', e => {\n      SearchBox.handleKeyEntry(e, this);\n    });\n    this.$input.addEventListener('paste', this.showResetButton.bind(this));\n\n    // TODO: Remove this test data when decided how to populate this list of keywords with real data\n    SearchBox.setKeywords([\n                            'Xiao-Dong Li', 'Zhijian J Chen', 'Cell biology',\n                           'Immunology', 'bacteria',\n                          ], this);\n  }\n\n  /**\n   * Handles the reset button being pressed.\n   */\n  reset() {\n    this.hideResetButton();\n    if (this.$output) {\n      this.$output.innerHTML = '';\n    }\n\n    this.$input.focus();\n  }\n\n  /**\n   * Hides the reset button.\n   */\n  hideResetButton() {\n    this.$elm.classList.remove('search-box--populated');\n  }\n\n  /**\n   * Shows the reset button.\n   */\n  showResetButton() {\n    this.$elm.classList.add('search-box--populated');\n  }\n\n  /**\n   * Responds to the keyCode of a KeyboardEvent (used on the input field and suggestions).\n   *\n   * Takes care not to trap the tab character. Accessibility!\n   * Down arrow (keyCode 40): go to the next suggestion.\n   * Up arrow (keyCode 38): go to the previous suggestion.\n   * Return (keyCode 13): put the text of the current suggestion into the search box\n   * Any other key: use it to filter keywords; also show/hide reset button.\n   *\n   * @param {KeyboardEvent} e The event to respond to\n   * @param {SearchBox} searchBox Calling object (injected to make method more testable)\n   */\n  static handleKeyEntry(e, searchBox) {\n    let current = e.target;\n    if (e.keyCode && e.keyCode !== 9) {\n      switch (e.keyCode) {\n      case 40:\n        searchBox.nextSuggestion(current);\n        break;\n      case 38:\n        searchBox.prevSuggestion(current);\n        break;\n      case 13:\n        searchBox.useSuggestion(current);\n        break;\n      default:\n        searchBox.display(searchBox.filterKeywordsBySearchTerm(SearchBox.getKeywords(searchBox),\n                                                       searchBox.$input.value), searchBox.$output);\n        if (searchBox.$input.value.length > 0) {\n          searchBox.showResetButton();\n        } else {\n          searchBox.hideResetButton();\n        }\n\n        break;\n      }\n    }\n  }\n\n  /**\n   * Selects the search suggestion element after the current one.\n   *\n   * If already on the last one, loop to the beginning and select the input field.\n   *\n   * @param {HTMLElement} current The search suggestion or input field currently with focus\n   */\n  nextSuggestion(current) {\n    if (!this.$output) {\n      return;\n    }\n\n    if (current === this.$input) {\n      this.$output.querySelector('ul li:first-child').focus();\n    } else if (!!current.nextElementSibling) {\n      current.nextElementSibling.focus();\n    } else {\n      this.$input.focus();\n    }\n  }\n\n  /**\n   * Selects the search suggestion element before the current one.\n   *\n   * If already on the input field, loop to the end and select the last one.\n   *\n   * @param {HTMLElement} current The search suggestion or input field currently with focus\n   */\n  prevSuggestion(current) {\n    if (!this.$output) {\n      return;\n    }\n\n    if (current === this.$input) {\n      this.$output.querySelector('ul li:last-child').focus();\n    } else if (!!current.previousElementSibling) {\n      current.previousElementSibling.focus();\n    } else {\n      this.$input.focus();\n    }\n  }\n\n  /**\n   * Copy the display text of the current suggestion into the search field.\n   *\n   * @param {HTMLElement} target The element containing the text to use\n   */\n  useSuggestion(target) {\n    this.$input.value = target.innerHTML.replace(/<\\/?strong>/g, '');\n    if (this.$output) {\n      this.$output.innerHTML = '';\n      if (this.$input.value.length) {\n        this.$form.submit();\n      }\n    }\n  }\n\n  /**\n   * Gets the keywords for the supplied searchBox.\n   *\n   * @param {SearchBox} searchBox The injected search box\n   */\n  static getKeywords(searchBox) {\n    return searchBox.keywords;\n  }\n\n  /**\n   * Sets the keywords for the supplied searchBox.\n   *\n   * @param {Array} keywords The keywords for the searchBox\n   * @param {SearchBox} searchBox The injected search box\n   */\n  static setKeywords(keywords, searchBox) {\n    searchBox.keywords = keywords;\n  }\n\n  /**\n   * Filter keywords by the contents of the search field.\n   *\n   * @param {string} searchTerm The search term to filter the keywords by\n   * @param {Array} keywords The keywords to filter\n   */\n  filterKeywordsBySearchTerm(keywords, searchTerm) {\n    let matches;\n    if (searchTerm) {\n      matches = keywords.filter(keyword => keyword.toLowerCase().indexOf(\n                                                                  searchTerm.toLowerCase()) !== -1);\n\n      matches.sort();\n      for (let i = 0; i < matches.length; i += 1) {\n        matches[i] = SearchBox.embolden(matches[i], searchTerm);\n      }\n    }\n\n    return matches;\n  }\n\n  /**\n   * Returns phrase with specified (case insensitive) snippet emboldened.\n   *\n   * @param {string} phrase The phrase containing the text to embolden\n   * @param {string} snippet The substring of phrase to embolden\n   * @returns {string} The phrase with the snippet emboldened\n   */\n  static embolden(phrase, snippet) {\n    // Don't nest emboldening elements.\n    if (snippet.indexOf('<strong>') > -1) {\n      return phrase;\n    }\n\n    let snippetRx = new RegExp(snippet, 'i');\n    let toEmbolden = phrase.match(snippetRx) ? phrase.match(snippetRx)[0] : null;\n    if (!toEmbolden) {\n      return phrase;\n    }\n\n    return phrase.replace(toEmbolden, `<strong>${toEmbolden}</strong>`);\n  }\n\n  /**\n   * Update the search suggestions based on matches found.\n   *\n   * @param {Array} matches The matches found\n   * @param {HTMLElement} $output Element to contain the display\n   */\n  display(matches, $output) {\n    let outputString = '';\n\n    if ($output) {\n      $output.innerHTML = '';\n      this.nudgeOutputVertically('-47px');\n\n      if (matches && matches.length) {\n        matches.forEach(match => {\n          outputString += `<li tabindex=\"0\" class=\"search-box__suggestion\">${match}</li>`;\n        });\n\n        outputString = `<ul>${outputString}</ul>`;\n        $output.innerHTML = outputString;\n      }\n    }\n\n  }\n\n  /**\n   * Uses css transform to translate $output in the vertical axis.\n   *\n   * @param posnInPx The vertical offset to apply\n   */\n  nudgeOutputVertically(posnInPx) {\n    let posn;\n    if (typeof posnInPx === 'string' && posnInPx.indexOf('px') === posnInPx.length - 2) {\n      posn = posnInPx;\n    } else if (!isNaN(posnInPx)) {\n      posn = posnInPx + 'px';\n    }\n\n    utils.updateElementTranslate(this.$output, [0, posn]);\n  }\n\n  /**\n   * Toggle the flag that limits the search.\n   */\n  toggleSearchLimiting() {\n    this.isSearchLimited = !this.isSearchLimited;\n  }\n\n};\n","'use strict';\n\nmodule.exports = class SelectNav {\n\n  constructor($elm) {\n    if (!$elm) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.$elm.classList.add('select-nav--js');\n    this.$elm.querySelector('select').addEventListener('change', this.triggerSubmit.bind(this));\n  }\n\n  triggerSubmit() {\n    this.$elm.submit();\n  }\n\n};\n","'use strict';\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = class SiteHeader {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n\n    let SearchBox = require('./SearchBox');\n    let $searchBoxEl = $elm.querySelector('[data-behaviour=\"SearchBox\"]');\n    this.searchBox = new SearchBox($searchBoxEl, this.window, doc);\n    var searchToggle = $elm.querySelector('[rel=\"search\"]');\n    if (!!searchToggle) {\n      this.searchToggle = searchToggle.parentNode;\n      this.searchToggle.addEventListener('click', this.toggleSearchBox.bind(this));\n    }\n\n    this.$pageOverlay = null;\n\n    // N.B. $mainMenu is not part of this component's HTML hierarchy.\n    var mainMenu = doc.querySelector('#mainMenu');\n    if (!!mainMenu) {\n      let MainMenu = require('./MainMenu');\n      this.mainMenu = new MainMenu(mainMenu);\n\n      this.$mainMenuToggle = this.$elm.querySelector('a[href=\"#mainMenu\"]');\n      if (!!this.$mainMenuToggle) {\n        this.mainMenu.moveWithinDom();\n        this.$mainMenuToggle.addEventListener('click', this.toggleMainMenu.bind(this));\n      }\n    }\n  }\n\n  /**\n   * Toggles display of the main menu.\n   */\n  toggleMainMenu(e) {\n    if (this.mainMenu.isOpen()) {\n      this.mainMenu.close();\n      this.window.removeEventListener('keyup', this.checkForMenuClose.bind(this));\n      this.window.removeEventListener('click', this.checkForMenuClose.bind(this));\n    } else {\n      this.mainMenu.open();\n      this.window.addEventListener('keyup', this.checkForMenuClose.bind(this));\n      this.window.addEventListener('click', this.checkForMenuClose.bind(this));\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  checkForMenuClose(e) {\n    if (e.keyCode === 27 ||\n        (e.type === 'click' && !utils.areElementsNested(this.mainMenu.$elm, e.target))) {\n      this.mainMenu.close();\n    }\n  }\n\n  /**\n   * Toggles display of the search box.\n   *\n   * @param {Event} e The event causing the toggle to occur\n   */\n  toggleSearchBox(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.searchBoxIsOpen()) {\n      this.closeSearchBox();\n    } else {\n      this.openSearchBox();\n    }\n  }\n\n  /**\n   * Returns true if the search box is currently displayed.\n   *\n   * @returns {boolean} True if the search box is open\n   */\n  searchBoxIsOpen() {\n    return this.searchBox.$elm.classList.contains('search-box--shown');\n  }\n\n  /**\n   * Closes the search box.\n   */\n  closeSearchBox() {\n    this.searchBox.$elm.classList.remove('search-box--shown');\n    utils.updateElementTranslate(this.searchBox.$elm, [0, '-40px']);\n    if (this.searchBox.$output) {\n      this.searchBox.$output.innerHTML = '';\n    }\n\n    this.searchBox.$input.blur();\n    this.window.removeEventListener('keyup', this.checkForClose.bind(this));\n    this.window.removeEventListener('click', this.checkForClose.bind(this));\n    this.hidePageOverlay();\n  }\n\n  /**\n   * Decides whether to close the search box, based on the supplied event.\n   *\n   * @param e The KeyboardEvent provoking the check.\n   */\n  checkForClose(e) {\n    if (e.keyCode && e.keyCode === 27 ||\n        (e.type === 'click' && !utils.areElementsNested(this.searchBox.$elm, e.target))) {\n      this.closeSearchBox();\n    }\n  }\n\n  /**\n   * Opens the search box.\n   */\n  openSearchBox() {\n    let myHeight = this.window.getComputedStyle(this.$elm).height;\n    let adjustment = 20;\n    let offsetY = utils.adjustPxString(myHeight, adjustment);\n\n    // This is set in the site-header.scss.\n    let transitionDurationInMs = 150;\n    utils.updateElementTranslate(this.searchBox.$elm, [0, offsetY]);\n    utils.invertPxString(this.window.getComputedStyle(this.searchBox.$container).height);\n    this.searchBox.$elm.classList.add('search-box--shown');\n    this.window.addEventListener('keyup', this.checkForClose.bind(this));\n    this.window.addEventListener('click', this.checkForClose.bind(this));\n\n    this.window.setTimeout(() => {\n\n      // blur before focus forces the focus, a simple focus doesn't always behave as expected.\n      this.searchBox.$input.blur();\n      this.searchBox.$input.focus();\n    }, transitionDurationInMs);\n    this.showPageOverlay();\n  }\n\n  /**\n   * Creates the page overlay.\n   *\n   */\n  createPageOverlay() {\n    let className = 'overlay--semi-white';\n\n    if (!this.$pageOverlay) {\n      this.$pageOverlay = this.doc.createElement('div');\n      this.$pageOverlay.classList.add(className);\n    }\n\n    let $target = this.doc.querySelector('.global-inner');\n    $target.insertBefore(this.$pageOverlay,\n                         this.doc.querySelector('.site-header').nextElementSibling);\n  }\n\n  /**\n   * Shows the page overlay.\n   */\n  showPageOverlay() {\n    if (!this.$pageOverlay) {\n      this.createPageOverlay();\n    }\n\n    this.$pageOverlay.style.display = 'block';\n    this.$pageOverlay.style.height = this.doc.querySelector('.global-inner')\n                                         .getBoundingClientRect().height + 'px';\n  }\n\n  /**\n   * Hides the page overlay.\n   */\n  hidePageOverlay() {\n    this.$pageOverlay.style.display = 'none';\n  }\n\n};\n","\nmodule.exports = class ViewerModal {\n\n  constructor($elm) {\n    this.$elm = $elm;\n    this.$prev = document.createElement('div');\n    this.$next = document.createElement('div');\n\n    // build the modal\n    this.build();\n\n    // events\n    this.$prev.addEventListener('click', this.prev);\n    this.$next.addEventListener('click', this.next);\n  }\n\n  build() {\n    //\n  }\n\n  prev(e) {\n    e.preventDefault();\n  }\n\n  next(e) {\n    e.preventDefault();\n  }\n\n  close() {\n    //\n  }\n\n};\n","module.exports = () => {\n  'use strict';\n\n  /**\n   * Builds and returns specified HTML element, optionally adding it to the DOM.\n   *\n   * @param {string} elName Name of the HTML element to build\n   * @param {Array} [cssClasses] CSS class name(s) to set on the element\n   * @param {string} [textContent] Textual content of the element\n   * @param {string|Element} [parent] Parent element to attach to\n   * @param {string|Element|boolean} [attachBefore] Following sibling (1st if true, last if falsey)\n   *\n   * @returns {Element}\n   */\n  function buildElement(elName, cssClasses, textContent, parent, attachBefore) {\n\n    var $el = document.createElement(elName);\n    var $parent = typeof parent === 'string' ? document.querySelector(parent)\n      : parent;\n\n    // Work out what the new element's following sibling will be, based on value of attachBefore.\n    var $followingSibling = (function () {\n\n      if (!!attachBefore) {\n\n        if (typeof attachBefore === 'boolean') {\n          return $parent.firstElementChild;\n\n        } else if (typeof attachBefore === 'string') {\n          return document.querySelector(attachBefore);\n\n        } else if (attachBefore instanceof HTMLElement) {\n          return attachBefore;\n\n        }\n      }\n    }());\n\n    cssClasses.forEach(cssClass => {\n      $el.classList.add(cssClass);\n    });\n\n    if (textContent) {\n      $el.innerHTML = textContent;\n    }\n\n    if (!!$parent && !!$followingSibling) {\n      $parent.insertBefore($el, $followingSibling);\n    } else {\n      $parent.appendChild($el);\n    }\n\n    return $el;\n  }\n\n  var uniqueIds = (function uniqueIds() {\n\n    class UniqueIdentifiers {\n\n      constructor () {\n        this.used = [];\n      }\n\n      isValid(candidate, document) {\n        // Compulsory check that id is unique to this object's knowledge.\n        if (this.used.indexOf(candidate) > -1) {\n          return false;\n        }\n\n        // Optional check to see if id is unique in the DOM.\n        if (!!document) {\n          if (!!document.querySelector &&\n              typeof document.querySelector === 'function' &&\n              document.querySelector('#' + candidate)) {\n            return false;\n          }\n        }\n\n        return true;\n      }\n\n      /**\n       * Gets a unique id with optional prefix.\n       *\n       * @param {string} [prefix] Prefix to use for the id\n       * @param {HTMLDocument} [document] Enables checking for the id's uniqueness within the DOM\n       * @returns {string}\n       */\n      get(prefix, document) {\n        var _prefix = '' + prefix || 'default_';\n        var random = ('' + Math.random()).replace(/\\./, '');\n        var candidate = _prefix + random;\n        if (this.isValid(candidate)) {\n          return candidate;\n        }\n\n        this.get(prefix, document);\n      }\n    }\n\n    return new UniqueIdentifiers();\n  }());\n\n  /**\n   * Updates the CSS transform's translate function on the element in a vendor-prefix-aware fashion.\n   *\n   * Because of the way CSS transformations are combined into a matrix, this may not work\n   * as expected if other CSS transformations are also applied to the same element.\n   *\n   * @param {HTMLElement} $el The element to apply the transformation to.\n   * @param {Array} offset The offset for both axes, expressed as [x, y], e.g. [0, '20px']\n   */\n  function updateElementTranslate($el, offset) {\n    if (!($el instanceof HTMLElement && Array.isArray(offset))) {\n      return;\n    }\n\n    let props = ['webkitTransform', 'mozTransform', 'msTransform', 'oTransform', 'transform'];\n    let offsetX = offset[0];\n    let offsetY = offset[1] || 0;\n\n    props.forEach((prop) => {\n      $el.style[prop] = 'translate(' + offsetX + ', ' + offsetY + ')';\n    });\n  }\n\n  /**\n   * Add a quantity to a px amount expressed as a string, and return new string with updated value.\n   *\n   * For example: adjustPxString('97px', 8) returns '105px'\n   *\n   * @param {String} pxString The string representing the original quantity, e.g. '97px'\n   * @param adjustment The numeric adjustment to make, e.g. 8\n   * @returns {string} The modified value, as a string, e.g.: '105px'\n   */\n  function adjustPxString(pxString, adjustment) {\n    let originalSize = parseInt(pxString.match(/([-0-9.]+)px/)[1], 10);\n    let newSize = originalSize + adjustment;\n    return newSize + 'px';\n  }\n\n  /**\n   * Invert the px amount expressed as a string, and return new string with inverted value.\n   *\n   * For example: invertPxString('97px') returns '-97px'\n   *\n   * @param {String} pxString The string representing the original quantity, e.g. '97px'\n   * @returns {string} The modified value, as a string, e.g.: '-97px'\n   */\n  function invertPxString(pxString) {\n    let originalSize = parseInt(pxString.match(/([-0-9.]+)px/)[1], 10);\n    let newSize = originalSize * -1;\n    return newSize + 'px';\n  }\n\n  /**\n   * Returns true if $prospectiveDescendant is, or is a descendant of $prospectiveParent.\n   *\n   * @param {HTMLElement} $prospectiveParent el to test as a parent of the $prospectiveDescendant\n   * @param {HTMLElement} $prospectiveDescendant el to test as descendant of the $prospectiveParent\n   * @returns {boolean} Whether the s$prospectiveDescendant is, or descends from $prospectiveParent\n   */\n  function areElementsNested($prospectiveParent, $prospectiveDescendant) {\n    let relationship = $prospectiveParent.compareDocumentPosition($prospectiveDescendant);\n    return !!(\n      relationship & $prospectiveParent.DOCUMENT_POSITION_CONTAINED_BY || relationship === 0\n    );\n  }\n\n  /**\n   * Return the current viewport width.\n   *\n   * @returns {number} The current viewport width\n   */\n  function getViewportWidth() {\n    return document.documentElement.clientWidth;\n  }\n\n  /**\n   * Returns whether the display is considered to have a high pixel density ratio.\n   *\n   * @param window\n   * @returns {boolean} true if dpr >= 2, false if lower, or unknown.\n   */\n  function isHighDpr(window) {\n    if (!!window.devicePixelRatio) {\n      return window.devicePixelRatio >= 2;\n    }\n\n    return false;\n  }\n\n  return {\n    adjustPxString: adjustPxString,\n    areElementsNested: areElementsNested,\n    buildElement: buildElement,\n    getViewportWidth: getViewportWidth,\n    invertPxString: invertPxString,\n    isHighDpr: isHighDpr,\n    uniqueIds: uniqueIds,\n    updateElementTranslate: updateElementTranslate,\n  };\n\n};\n","'use strict';\n\n// Base level of feature support needed for the js loaded in this file.\n// Consider AJAXing in the rest if the test passes.\nif (window.localStorage && document.querySelector &&\n       window.addEventListener && !!(document.createElement('div')).classList) {\n\n  document.querySelector('html').classList.add('js');\n\n  let Components = {};\n\n  // import modules into the list of Components.\n  Components.ArticleDownloadLinksList = require('./components/ArticleDownloadLinksList');\n  Components.AudioPlayer = require('./components/AudioPlayer');\n  Components.ContentHeaderArticle = require('./components/ContentHeaderArticle');\n  Components.BackgroundImage = require('./components/BackgroundImage');\n  Components.SelectNav = require('./components/SelectNav');\n  Components.MainMenu = require('./components/MainMenu');\n  Components.MediaChapterListingItem = require('./components/MediaChapterListingItem');\n  Components.SiteHeader = require('./components/SiteHeader');\n  Components.SearchBox = require('./components/SearchBox');\n  Components.ViewerModal = require('./components/ViewerModal');\n\n  // App\n  let Elife = function Elife() {\n\n    function initialiseComponent($component) {\n      // When present, data-behaviour contains a space-separated list of handlers for that component\n      let handlers = $component.getAttribute('data-behaviour').trim().split(' ');\n      for (let i = 0; i < handlers.length; i += 1) {\n        let handler = handlers[i];\n        if (Components[handler] && typeof Components[handler] === 'function') {\n          new Components[handler]($component, window, window.document);\n        }\n      }\n    }\n\n    let components = document.querySelectorAll('[data-behaviour]');\n    if (components) {\n      [].forEach.call(components, initialiseComponent);\n    }\n\n  };\n\n  new Elife();\n}\n"]}