{"version":3,"sources":["node_modules/browser-pack/_prelude.js","assets/js/components/AllSubjectsListLink.js","main.js","assets/js/components/ArticleDownloadLinksList.js","assets/js/components/ArticleSection.js","assets/js/components/AudioPlayer.js","assets/js/components/BackgroundImage.js","assets/js/components/Carousel.js","assets/js/components/ContentHeaderArticle.js","assets/js/components/FragmentHandler.js","assets/js/components/MainMenu.js","assets/js/components/Math.js","assets/js/components/MediaChapterListingItem.js","assets/js/components/Pager.js","assets/js/components/SearchBox.js","assets/js/components/SelectNav.js","assets/js/components/SiteHeader.js","assets/js/components/ViewSelector.js","assets/js/components/ViewerModal.js","assets/js/libs/elife-utils.js","assets/js/main.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","AllSubjectsListLink","$elm","doc","arguments","undefined","window","document","this","HTMLElement","replaceSelfWithTargetFragment","value","$targetFrag","querySelector","findIdSelector","href","parentNode","replaceChild","substring","indexOf","2","utils","ArticleDownloadLinksList","_window","classList","add","moveList","$toggler","addEventListener","toggle","bind","$newParent","$followingSibling","nextElementSibling","insertBefore","preventDefault","stopPropagation","isOpen","close","open","contains","remove","checkForClose","areElementsNested","removeEventListener","../libs/elife-utils","3","ArticleSection","thresholdWidth","initialise","$headerLink","createHeaderLink","$body","setInitialState","expand","$header","$link","createElement","setAttribute","appendChild","firstElementChild","toggleState","dataset","initialState","viewportNoWiderThan","thresholdInPx","matchMedia","matches","MathJax","Hub","Queue","id","$descendentEl","detail","scrollIntoView","4","AudioPlayer","_this","HTMLAudioElement","console","log","$audioElement","uniqueId","uniqueIds","get","$playButton","buildPlayButton","$icon","$title","prepare$title","$progressTrack","buildProgressIndicator","$progressBar","$timeIndicators","buildTimeIndicators","$currentTime","$duration","duration","isPlaying","playerReady","usingMetadata","loadMetadata","episodeNumber","warn","player","innerHTML","secondsToMinutes","togglePlay","update","seekNewTime","CustomEvent","createEvent","initCustomEvent","dispatchEvent","parent","span","$togglePlayButton","pause","play","updateIconState","currentTime","Math","floor","pc","currentTime2Dis","style","width","chapterNumberOnLastUpdate","getCurrentChapterNumber","setCurrentChapterMetadata","getChapterMetadataAtTime","chapterMetadata","getCurrentChapterMetadata","number","changeChapter","title","ended","setTitle","episodeTitle","chapterChanged","hash","shouldPlay","newURL","location","isNaN","seek","newSeekPosition","parseInt","offsetX","availableWidth","clientWidth","durationProportionToSeek","time","chapterTitle","currentChapterMetadata","metadata","chapterNumber","forEach","chapter","chapters","chapterStartTime","nextChapterStartTime","prepareChapterMetadata","push","processMetadata","JSON","parse","replace","error","seconds","_seconds","mins","secs","state","src","getIconPath","alt","$barWrapper","buildElement","handleSeek","$button","$image","playerId","$container","iconName","5","BackgroundImage","sourceToUse","isValidThreshold","isThresholdMet","innerWidth","resizeHandler","init","calcSourceToUse","isHighDpr","setDarkBackground","setupEventHandlers","setLightBackground","candidate","Array","isArray","threshold","viewportWidth","getAttribute","backgroundImage","getBackgroundImagesString","color","path","grandient","sourceDefiner","lowResSource","highResSource","highResImageSource","lowResImageSource","6","Carousel","moveableStage","originalSlideWrappers","querySelectorAll","originalSlideCount","currentSlideCount","currentSlide","timerInterval","updateButtonAppearance","buildVisibleControls","buildControl$toggle","updateWidth","updateControlPanel","focus","handleKey","cancelTimer","setupTimer","adjustTranslateForResize","makeSingleSlideATVisible","buttons","button","$node","removeAttribute","$root","show","_this2","action","atShow","atHide","childNodes","$descendant","nodeType","ELEMENT_NODE","hasChildNodes","setATVisibility","slideNumber","_this3","$el","_slideNumber","slide","$previousWrapper","buildControl$traverser","$nextWrapper","previous","next","switches","buildControl$switches","$controlPanel","$visibleControlsWrapper","visibleControls","control","direction","_this4","_direction","text","$wrapper","userInitiatedProgression","_this5","quantity","$switches","buildControl$switch","activateSwitch","index","$item","$switch","currentButtonState","timerStopped","clearInterval","timer","_this6","startNewAdvancementTimer","intervalInMs","_this7","setInterval","keyCode","charCode","callback","extendStage","updateSlide","_this8","cloneNode","currentOffset","getCurrentOffset","currentWidthStringMatch","getComputedStyle","match","currentCarouselWidth","newOffset","updateElementTranslate","offsetStringMatch","transform","hideInvalidButtonChoice","updateActiveSwitch","logicalSlideNumber","getLogicalSlideNumber","currentLogicalSlide","aSwitch","actualSlideNumber","setSize","slideSetOfSlide","ceil","firstSlideOfSet","logicalSlideRequested","logicalSlideCurrent","slideOffset","abs","carouselWidth","expectedOffset","adjustPxString","7","ContentHeaderArticle","breakpointInPx","currentView","calcCurrentView","authors","institutions","hasToggleAuthor","hasToggleInstitution","hideAllExcessItems","newView","handleAnyExcessItems","itemType","items","clearExcessMark","toggleExcessItems","excessItems","getExcessItems","markAsExcess","markLastNonExcessItem","addTrailingText","defaultMaxItems","getDefaultMaxItems","slice","els","item","breakpoint","lastShownIndex","foundLastShown","lastShown","buildSeeMoreLessToggle","toggleOnText","toggleOffText","8","FragmentHandler","handleDomLoad","handleSectionOpeningViaHash","$section","$fragWithId","idToFind","collapsedSections","$collapsedSectionContainingFrag","$collapsedSection","isIdOfOrWithinSection","idOfCollapsedSection","getIdOfCollapsedSection","expandSection","9","MainMenu","$globalWrapper","10","loadDependencies","dependenciesAlreadySetup","setupProperties","load","HTML-CSS","linebreaks","automatic","SVG","resizeTimeout","resizeThrottler","setTimeout","script","type","setupResizeHandler","11","MediaChapterListingItem","startTime","listenForChapterChange","createLink","$player","indicateChapterChanged","$rootElm","titleText","$existingLink","removeChild","currentChapterNumber","12","Pager","$targetEl","find$targetEl","$loader","find$Loader","isCurrentlyLoading","timeoutThresholdInMs","handleLoadRequest","newData","normalisedData","normaliseData","regex","SyntaxError","data","frag","createDocumentFragment","$temp","child","loaderLink","getValidLoaderLink","search","redirectToFullResultsPage","pageNumber","$pagerTextWrapper","loadingTimer","clearTimeout","originalText","isLastPage","getPageNumberFromLoaderLink","validLoaderLink","history","pushState","injectNewData","handleError","clearLoadingState","updateUrl","updatePager","pageNum","loadNextPageData","XMLHttpRequest","then","handleLoad","setLoadingState","url","Promise","resolve","reject","xhr","responseText","setRequestHeader","send","$loaderTextWrapper","firstChild","targetid","dataNoLeadingWhitespace","13","SearchBox","$input","$resetButton","reset","handleInput","hideResetButton","$output","showResetButton","14","SelectNav","triggerSubmit","submit","15","SiteHeader","$searchBoxEl","searchBox","searchToggle","toggleSearchBox","$pageOverlay","mainMenu","$mainMenuToggle","moveWithinDom","toggleMainMenu","checkForMenuClose","searchBoxIsOpen","closeSearchBox","openSearchBox","blur","hidePageOverlay","myHeight","height","adjustment","offsetY","transitionDurationInMs","invertPxString","showPageOverlay","className","$target","createPageOverlay","display","getBoundingClientRect","./MainMenu","./SearchBox","16","ViewSelector","$jumpLinks","$jumpLinksToggle","cssFixedClassName","mainTarget","topSpaceWhenFixed","elmYOffset","offsetTop","handleScroll","toggleJumpLinks","pageYOffset","bottomOfMain","bottom","offsetHeight","amountToNudgeUp","top","innerHeight","17","ViewerModal","$prev","$next","build","prev","18","elName","cssClasses","textContent","attachBefore","$parent","cssClass","offset","calcOffset","prop","_getValueFromPxString","pxString","_getZeroAwarePxStringFromValue","requestedOperation","originalSize","adjustedSize","operation","$prospectiveParent","$prospectiveDescendant","Node","relationship","compareDocumentPosition","DOCUMENT_POSITION_CONTAINED_BY","devicePixelRatio","UniqueIdentifiers","used","prefix","_prefix","random","isValid","19","localStorage","Components","Elife","initialiseComponent","$component","handlers","trim","split","handler","singletons","isRegistered","isSingleton","register","componentName","registered","components","./components/AllSubjectsListLink","./components/ArticleDownloadLinksList","./components/ArticleSection","./components/AudioPlayer","./components/BackgroundImage","./components/Carousel","./components/ContentHeaderArticle","./components/FragmentHandler","./components/MainMenu","./components/Math","./components/MediaChapterListingItem","./components/Pager","./components/SearchBox","./components/SelectNav","./components/SiteHeader","./components/ViewSelector","./components/ViewerModal"],"mappings":"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","file":"main.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\n\nmodule.exports = class AllSubjectsListLink {\n\n  constructor($elm, _window = window, doc = document) {\n\n    if (!($elm instanceof HTMLElement)) {\n      return;\n    }\n\n    this.doc = doc;\n    this.$elm = $elm;\n    this.replaceSelfWithTargetFragment();\n  }\n\n  // Replace this.$elm with the same-page HTML fragment targeted by this.$elm.href\n  replaceSelfWithTargetFragment() {\n    let $targetFrag = this.doc.querySelector(AllSubjectsListLink.findIdSelector(this.$elm.href));\n    if ($targetFrag) {\n      this.$elm.parentNode.replaceChild($targetFrag, this.$elm);\n    }\n  }\n\n  static findIdSelector(href) {\n    if (href) {\n      return href.substring(href.indexOf('#'));\n    }\n  }\n\n};\n","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  function AllSubjectsListLink($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, AllSubjectsListLink);\n\n    if (!($elm instanceof HTMLElement)) {\n      return;\n    }\n\n    this.doc = doc;\n    this.$elm = $elm;\n    this.replaceSelfWithTargetFragment();\n  }\n\n  // Replace this.$elm with the same-page HTML fragment targeted by this.$elm.href\n\n\n  _createClass(AllSubjectsListLink, [{\n    key: 'replaceSelfWithTargetFragment',\n    value: function replaceSelfWithTargetFragment() {\n      var $targetFrag = this.doc.querySelector(AllSubjectsListLink.findIdSelector(this.$elm.href));\n      if ($targetFrag) {\n        this.$elm.parentNode.replaceChild($targetFrag, this.$elm);\n      }\n    }\n  }], [{\n    key: 'findIdSelector',\n    value: function findIdSelector(href) {\n      if (href) {\n        return href.substring(href.indexOf('#'));\n      }\n    }\n  }]);\n\n  return AllSubjectsListLink;\n}();\n\n},{}],2:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = function () {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  function ArticleDownloadLinksList($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, ArticleDownloadLinksList);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n\n    // One statement per class name because IE doesn't support multiple strings, comma separated.\n    this.$elm.classList.add('article-download-links-list--js');\n    this.$elm.classList.add('visuallyhidden');\n    this.moveList();\n    this.$toggler = this.doc.querySelector('.content-header__download_link');\n    this.$toggler.addEventListener('click', this.toggle.bind(this));\n  }\n\n  /**\n   * Moves the download links list to be by the icon this.$toggler\n   */\n\n\n  _createClass(ArticleDownloadLinksList, [{\n    key: 'moveList',\n    value: function moveList() {\n      var $newParent = this.doc.querySelector('.content-header_top');\n      var $followingSibling = $newParent.querySelector('.content-header__download_link').nextElementSibling;\n      this.$elm.parentNode.parentNode.classList.add('visuallyhidden');\n      $newParent.insertBefore(this.$elm, $followingSibling);\n    }\n\n    /**\n     * Toggles the download links list display.\n     *\n     * @param e The event triggering the display toggle\n     */\n\n  }, {\n    key: 'toggle',\n    value: function toggle(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      if (this.isOpen()) {\n        this.close();\n      } else {\n        this.open();\n      }\n    }\n\n    /**\n     * Returns whether links list is currently viewable.\n     *\n     * @returns {boolean} Whether links list is currently viewable\n     */\n\n  }, {\n    key: 'isOpen',\n    value: function isOpen() {\n      return !this.$elm.classList.contains('visuallyhidden');\n    }\n\n    /**\n     * Make viewable.\n     */\n\n  }, {\n    key: 'open',\n    value: function open() {\n      this.$elm.classList.remove('visuallyhidden');\n      this.window.addEventListener('click', this.checkForClose.bind(this));\n    }\n\n    /**\n     * Checks whether a click occurred outside this, and close this if it did.\n     *\n     * @param e The click event to evaluate the target of\n     */\n\n  }, {\n    key: 'checkForClose',\n    value: function checkForClose(e) {\n      if (!utils.areElementsNested(this.$elm, e.target)) {\n        this.close();\n      }\n    }\n\n    /**\n     * Make unviewable.\n     */\n\n  }, {\n    key: 'close',\n    value: function close() {\n      this.$elm.classList.add('visuallyhidden');\n      this.window.removeEventListener('click', this.checkForClose.bind(this));\n    }\n  }]);\n\n  return ArticleDownloadLinksList;\n}();\n\n},{\"../libs/elife-utils\":18}],3:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  function ArticleSection($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, ArticleSection);\n\n    if ($elm.classList.contains('article-section--first')) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n\n    this.thresholdWidth = 600;\n    this.initialise(this.$elm, doc);\n  }\n\n  _createClass(ArticleSection, [{\n    key: 'initialise',\n    value: function initialise($elm, doc) {\n      this.$elm.classList.add('article-section--js');\n      this.$headerLink = this.createHeaderLink($elm, doc);\n      this.$body = $elm.querySelector('.article-section__body');\n      this.setInitialState($elm, this.$headerLink, this.$body);\n      this.$elm.addEventListener('expandsection', this.expand.bind(this));\n    }\n  }, {\n    key: 'createHeaderLink',\n    value: function createHeaderLink($elm, doc) {\n      var $header = $elm.querySelector('.article-section__header');\n      var $link = doc.createElement('A');\n      $link.setAttribute('href', '#');\n      $link.classList.add('article-section__header_link');\n      $link.appendChild($header.firstElementChild);\n      $header.appendChild($link);\n      $link.addEventListener('click', this.toggleState.bind(this));\n      return $link;\n    }\n  }, {\n    key: 'setInitialState',\n    value: function setInitialState($elm, $headerLink, $body) {\n      if ($elm.dataset.initialState === 'closed' || this.viewportNoWiderThan(this.thresholdWidth)) {\n        $elm.classList.add('article-section--collapsed');\n        $headerLink.classList.add('article-section__header_link--closed');\n        $body.classList.add('visuallyhidden');\n      } else {\n        // Defensive: remove classes if they turn up here when they shouldn't\n        $headerLink.classList.remove('article-section__header_link--closed');\n        $body.classList.remove('visuallyhidden');\n      }\n    }\n  }, {\n    key: 'viewportNoWiderThan',\n    value: function viewportNoWiderThan(thresholdInPx) {\n      return this.window.matchMedia('(max-width: ' + thresholdInPx + 'px)').matches;\n    }\n  }, {\n    key: 'toggleState',\n    value: function toggleState(e) {\n      e.preventDefault();\n      this.$headerLink.classList.toggle('article-section__header_link--closed');\n      this.$elm.classList.toggle('article-section--collapsed');\n      this.$body.classList.toggle('visuallyhidden');\n      if (!this.$body.classList.contains('visuallyhidden') && !!this.window.MathJax) {\n        this.window.MathJax.Hub.Queue(['Rerender', this.window.MathJax.Hub, this.$elm.id]);\n      }\n    }\n  }, {\n    key: 'expand',\n    value: function expand(e) {\n      this.$headerLink.classList.remove('article-section__header_link--closed');\n      this.$elm.classList.remove('article-section--collapsed');\n      this.$body.classList.remove('visuallyhidden');\n      if (!!this.window.MathJax) {\n        this.window.MathJax.Hub.Queue(['Rerender', this.window.MathJax.Hub, this.$elm.id]);\n      }\n\n      var $descendentEl = this.doc.querySelector('#' + e.detail);\n      if (!!$descendentEl) {\n        $descendentEl.scrollIntoView();\n      }\n    }\n  }]);\n\n  return ArticleSection;\n}();\n\n},{}],4:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = require('../libs/elife-utils')();\nmodule.exports = function () {\n  function AudioPlayer($elm) {\n    var _this = this;\n\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, AudioPlayer);\n\n    if (!$elm) {\n      console.warn('No element provided');\n      return;\n    }\n\n    this.window = _window;\n    if (!this.window.HTMLAudioElement) {\n      console.warn('Audio element not supported');\n      return;\n    }\n\n    console.log('Initialising Audio Player...');\n\n    this.$elm = $elm;\n    this.$audioElement = this.$elm.querySelector('audio');\n    if (!this.$audioElement) {\n      console.warn('No audio element found');\n      return;\n    }\n\n    this.uniqueId = utils.uniqueIds.get('audio', doc);\n    this.$elm.id = this.uniqueId;\n    this.$playButton = AudioPlayer.buildPlayButton(this);\n    this.$icon = this.$playButton.querySelector('.audio-player__toggle_play_icon');\n\n    // $title must be prepared before buildProgressIndicator is called\n    this.$title = this.prepare$title(this.$elm.querySelector('.audio-player__header'), doc);\n    this.$progressTrack = AudioPlayer.buildProgressIndicator(this);\n    this.$progressBar = this.$progressTrack.querySelector('[class*=\"progress_bar\"]');\n    this.$timeIndicators = AudioPlayer.buildTimeIndicators(this);\n    this.$currentTime = this.$timeIndicators.querySelector('[class*=\"current_time\"]');\n    this.$duration = this.$timeIndicators.querySelector('[class*=\"duration\"]');\n\n    // state\n    this.duration = null;\n    this.isPlaying = false;\n\n    this.$elm.classList.add('audio-player--js');\n\n    this.$playButton.classList.add('loading');\n    this.$audioElement.addEventListener('loadedmetadata', function () {\n      _this.playerReady(_this);\n    });\n\n    this.usingMetadata = false; // set to true in loadMetadata if no errors thrown\n    this.loadMetadata(this.$elm.dataset.episodeNumber);\n  }\n\n  _createClass(AudioPlayer, [{\n    key: 'playerReady',\n    value: function playerReady(player) {\n      player.duration = player.$audioElement.duration;\n      player.$duration.innerHTML = AudioPlayer.secondsToMinutes(player.duration);\n      player.$playButton.addEventListener('click', function () {\n        player.togglePlay(player.$audioElement, player.$playButton);\n      }, false);\n      player.$audioElement.addEventListener('timeupdate', player.update.bind(player));\n      player.window.addEventListener('hashchange', player.seekNewTime.bind(player));\n      player.window.addEventListener('load', player.seekNewTime.bind(player));\n      this.$playButton.classList.remove('loading');\n\n      var playerReady = void 0;\n      try {\n        playerReady = new CustomEvent('playerReady', { detail: this.uniqueId });\n      } catch (e) {\n        // CustomEvent not supported, do it the old fashioned way\n        playerReady = document.createEvent('playerReady');\n        playerReady.initCustomEvent('playerReady', true, true, { detail: this.uniqueId });\n      }\n\n      player.window.dispatchEvent(playerReady);\n    }\n  }, {\n    key: 'prepare$title',\n    value: function prepare$title(parent, doc) {\n      var span = doc.createElement('span');\n      try {\n        span.innerHTML = parent.innerHTML;\n      } catch (e) {\n        return;\n      }\n\n      span.classList.add('audio-player__title');\n      parent.innerHTML = '';\n      parent.appendChild(span);\n      return span;\n    }\n\n    /**\n     * Converts seconds to a display of minutes & seconds.\n     *\n     * @param {Number} seconds The time to convert, in seconds\n     * @returns {string} The time in a [m]m:ss string\n     */\n\n  }, {\n    key: 'togglePlay',\n\n\n    //noinspection JSValidateJSDoc\n    /**\n     * Toggles play/pause state of media file.\n     *\n     * @param {HTMLAudioElement} $audioElement The audio element to toggle the play state of\n     * @param {HTMLButtonElement} $togglePlayButton The button controlling the playback\n     */\n    value: function togglePlay($audioElement, $togglePlayButton) {\n      if (this.isPlaying) {\n        this.pause($audioElement, $togglePlayButton);\n      } else {\n        this.play($audioElement, $togglePlayButton);\n      }\n    }\n  }, {\n    key: 'play',\n    value: function play($audioElement, $togglePlayButton) {\n      $audioElement.play();\n      AudioPlayer.updateIconState(this.$icon, 'pause');\n      $togglePlayButton.classList.add('audio-player__toggle_play--pauseable');\n      $togglePlayButton.classList.remove('audio-player__toggle_play--playable');\n      this.isPlaying = true;\n    }\n  }, {\n    key: 'pause',\n    value: function pause($audioElement, $togglePlayButton) {\n      $audioElement.pause();\n      AudioPlayer.updateIconState(this.$icon, 'play');\n      $togglePlayButton.classList.add('audio-player__toggle_play--playable');\n      $togglePlayButton.classList.remove('audio-player__toggle_play--pauseable');\n      this.isPlaying = false;\n    }\n\n    /**\n     * Update the progress bar and elapsed time indicator based on track's current time.\n     */\n\n  }, {\n    key: 'update',\n    value: function update() {\n      var currentTime = Math.floor(this.$audioElement.currentTime);\n      var pc = currentTime / this.duration * 100;\n      var currentTime2Dis = AudioPlayer.secondsToMinutes(currentTime);\n      this.$progressBar.style.width = pc + '%';\n      this.$currentTime.innerHTML = currentTime2Dis;\n\n      if (this.usingMetadata) {\n        var chapterNumberOnLastUpdate = this.getCurrentChapterNumber();\n        this.setCurrentChapterMetadata(this.getChapterMetadataAtTime(currentTime, this.chapterMetadata));\n        if (this.getCurrentChapterMetadata().number !== chapterNumberOnLastUpdate) {\n          this.changeChapter(this.getCurrentChapterNumber(), this.getCurrentChapterMetadata().title, this.$elm);\n        }\n      }\n\n      if (this.$audioElement.ended) {\n        AudioPlayer.updateIconState(this.$icon, 'play');\n        this.isPlaying = false;\n      }\n    }\n\n    /**\n     * Updates player title with chapter number & name, and dispatches chapterChanged event.\n     *\n     * @param {int} number New chapter number Used as value of detail property of\n     * @param {String} title new chapter title\n     * @param {HTMLElement} $elm Element from which to dispatch the event\n     */\n\n  }, {\n    key: 'changeChapter',\n    value: function changeChapter(number, title, $elm) {\n      this.setTitle(this.episodeTitle, title);\n      var chapterChanged = void 0;\n      try {\n        chapterChanged = new CustomEvent('chapterChanged', { detail: number });\n      } catch (e) {\n        // CustomEvent not supported, do it the old fashioned way\n        chapterChanged = document.createEvent('chapterChanged');\n        chapterChanged.initCustomEvent('chapterChanged', true, true, { detail: number });\n      }\n\n      $elm.dispatchEvent(chapterChanged);\n    }\n\n    /**\n     * Updates the icon state for the play button.\n     *\n     * @param $icon {HTMLImageElement} The img to update\n     * @param state {string} The state to update to (either 'play' or 'pause')\n     */\n\n  }, {\n    key: 'seekNewTime',\n    value: function seekNewTime(e) {\n      var hash;\n      var shouldPlay = false;\n      try {\n        hash = e.newURL.substring(e.newURL.indexOf('#') + 1);\n\n        // Should play when chapter changed within the page, but not autoplay on page load :-)\n        shouldPlay = true;\n      } catch (e) {\n        // newURL only available on hashchange event, but load event may also invoke this handler\n        hash = this.window.location.hash.substring(1);\n        shouldPlay = false;\n      }\n\n      if (!isNaN(hash) && hash >= 0) {\n        this.seek(hash, this.$audioElement);\n        if (!this.isPlaying && shouldPlay) {\n          this.play(this.$audioElement, this.$playButton);\n        }\n      }\n    }\n\n    /**\n     * Event handler to determine track seek time in response to user interaction.\n     *\n     * @param e The user-generated click event\n     * @param {AudioPlayer} player The audio player object that the new element belongs to\n     */\n\n  }, {\n    key: 'handleSeek',\n    value: function handleSeek(e, player) {\n      var newSeekPosition = parseInt(e.offsetX, 10);\n      var availableWidth = player.$progressTrack.clientWidth;\n      var durationProportionToSeek = newSeekPosition / parseInt(availableWidth, 10);\n      this.seek(durationProportionToSeek * player.duration, player.$audioElement);\n    }\n\n    //noinspection JSValidateJSDoc\n    /**\n     * Seeks a particular time in the media file.\n     *\n     * @param {Number} time The time to seek\n     * @param {HTMLAudioElement} $audioElement The audio element to toggle the play state of\n     */\n\n  }, {\n    key: 'seek',\n    value: function seek(time, $audioElement) {\n      $audioElement.currentTime = time;\n      this.update();\n    }\n\n    /**\n     * Builds the progress indicator.\n     *\n     * @param {AudioPlayer} player The audio player object that the new element belongs to\n     * @returns {Element} The progress indicator\n     */\n\n  }, {\n    key: 'setTitle',\n\n\n    /**\n     * Set the title based on both episode and chapter titles\n     * @param episodeTitle\n     * @param chapterTitle\n     */\n    value: function setTitle(episodeTitle, chapterTitle) {\n      this.title = episodeTitle;\n      if (!!chapterTitle) {\n        this.title += ': ' + chapterTitle;\n      }\n\n      this.$title.innerHTML = this.title;\n    }\n  }, {\n    key: 'getCurrentChapterMetadata',\n    value: function getCurrentChapterMetadata() {\n      return this.currentChapterMetadata;\n    }\n  }, {\n    key: 'setCurrentChapterMetadata',\n    value: function setCurrentChapterMetadata(metadata) {\n      this.currentChapterMetadata = metadata;\n    }\n  }, {\n    key: 'getCurrentChapterNumber',\n    value: function getCurrentChapterNumber() {\n      return this.getCurrentChapterMetadata().number || 0;\n    }\n\n    /**\n     * Returns a chapter's title and number, based on the playback position\n     * @param time\n     * @param {Array} chapterMetadata\n     * An array of objects that must contain as a minimum\n     * @returns {*}\n     */\n\n  }, {\n    key: 'getChapterMetadataAtTime',\n    value: function getChapterMetadataAtTime(time, chapterMetadata) {\n      if (!chapterMetadata) {\n        return '';\n      }\n\n      var chapterTitle = '';\n      var chapterNumber = 0;\n      chapterMetadata.forEach(function (chapter, i, chapters) {\n        var chapterStartTime = parseInt(chapter.time, 10);\n        var nextChapterStartTime = i < chapters.length - 1 ? chapters[i + 1].time : null;\n        if (time >= chapterStartTime) {\n          if (!nextChapterStartTime || time < nextChapterStartTime) {\n            chapterTitle = chapter.title;\n            chapterNumber = chapter.number;\n          }\n        }\n      });\n\n      return {\n        title: chapterTitle,\n        number: chapterNumber\n      };\n    }\n\n    /**\n     * Sets episode title and respective chapter information from metadata\n     * @param metadata\n     */\n\n  }, {\n    key: 'processMetadata',\n    value: function processMetadata(metadata) {\n      this.episodeTitle = 'Episode ' + metadata.number;\n      this.setTitle(this.episodeTitle);\n\n      this.chapterMetadata = this.prepareChapterMetadata(metadata);\n      this.currentChapterMetadata = { number: 0, title: '' };\n    }\n\n    /**\n     * Returns array of objects describing respective chapter information\n     * @param metadata\n     * @returns {Array} of objects containing time, number and title properties\n     */\n\n  }, {\n    key: 'prepareChapterMetadata',\n    value: function prepareChapterMetadata(metadata) {\n      var chapterMetadata = [];\n      metadata.chapters.forEach(function (chapter) {\n        chapterMetadata.push({\n          time: chapter.time,\n          number: chapter.number,\n          title: chapter.number + '. ' + chapter.title\n        });\n      });\n\n      return chapterMetadata;\n    }\n\n    /**\n     * Metadata is expected in the data-metadata attribute of $elm as a JSON-like string with single-\n     * quoted instead of double-quoted values.\n     */\n\n  }, {\n    key: 'loadMetadata',\n    value: function loadMetadata() {\n      try {\n        this.processMetadata(JSON.parse(this.$elm.dataset.metadata.replace(/'/g, '\"')));\n        this.usingMetadata = true;\n      } catch (e) {\n        console.error(e);\n        this.usingMetadata = false;\n      }\n    }\n  }], [{\n    key: 'secondsToMinutes',\n    value: function secondsToMinutes(seconds) {\n      var _seconds = parseInt(seconds, 10);\n      var mins = Math.floor(_seconds / 60);\n      var secs = _seconds % 60;\n      if (secs <= 9) {\n        secs = '0' + secs;\n      }\n\n      return mins + ':' + secs;\n    }\n  }, {\n    key: 'updateIconState',\n    value: function updateIconState($icon, state) {\n      if (state !== 'play' && state !== 'pause') {\n\n        return;\n      }\n\n      $icon.src = AudioPlayer.getIconPath(state);\n      $icon.alt = state;\n    }\n  }, {\n    key: 'buildProgressIndicator',\n    value: function buildProgressIndicator(player) {\n      var $barWrapper = utils.buildElement('div', ['audio-player__progress'], '', '#' + player.uniqueId + ' [class*=\"audio-player__container\"]');\n\n      utils.buildElement('div', ['audio-player__progress_bar'], '', $barWrapper);\n\n      $barWrapper.addEventListener('click', function (e) {\n        player.handleSeek(e, player);\n      }, false);\n\n      return $barWrapper;\n    }\n\n    /**\n     * Builds the play button.\n     *\n     * @param {AudioPlayer} player The audio player object that the new element belongs to\n     * @returns {Element} The play/pause button\n     */\n\n  }, {\n    key: 'buildPlayButton',\n    value: function buildPlayButton(player) {\n      var $button = utils.buildElement('button', ['audio-player__toggle_play'], '', '#' + player.uniqueId + ' [class*=\"audio-player\"]', true);\n      var $image = utils.buildElement('img', ['audio-player__toggle_play_icon'], '', $button);\n      $image.src = AudioPlayer.getIconPath('play');\n      $image.alt = 'Play';\n      return $button;\n    }\n\n    /**\n     * Builds the current time and duration indicators.\n     *\n     * @param {AudioPlayer} player The audio player object that the new element belongs to\n     * @returns {Element} An element containing the current time and duration indicators.\n     */\n\n  }, {\n    key: 'buildTimeIndicators',\n    value: function buildTimeIndicators(player) {\n      var playerId = player.uniqueId;\n      var $container = utils.buildElement('div', ['audio-player__times'], '', '#' + playerId + ' [class*=audio-player__header]', true);\n\n      utils.buildElement('span', ['audio-player__current_time'], '0:00', $container);\n      utils.buildElement('span', ['audio-player__duration'], '0:00', $container);\n      return $container;\n    }\n  }, {\n    key: 'getIconPath',\n    value: function getIconPath(iconName) {\n\n      if (iconName !== 'play' && iconName !== 'pause') {\n        return;\n      }\n\n      return '../../assets/img/icons/audio-' + iconName + '.svg';\n    }\n  }]);\n\n  return AudioPlayer;\n}();\n\n},{\"../libs/elife-utils\":18}],5:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = function () {\n  function BackgroundImage($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, BackgroundImage);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n\n    this.sourceToUse = null;\n    this.thresholdWidth = parseInt(this.$elm.dataset.thresholdWidth, 10);\n    if (this.isValidThreshold(this.thresholdWidth) && !this.isThresholdMet(this.thresholdWidth, this.window.innerWidth)) {\n      this.window.addEventListener('resize', this.resizeHandler.bind(this));\n    } else {\n      this.init();\n    }\n  }\n\n  _createClass(BackgroundImage, [{\n    key: 'init',\n    value: function init() {\n      this.sourceToUse = this.calcSourceToUse(this.$elm, utils.isHighDpr(this.window));\n      this.setDarkBackground();\n      this.setupEventHandlers(this.$elm, this.setLightBackground.bind(this), this.setDarkBackground.bind(this));\n    }\n  }, {\n    key: 'isValidThreshold',\n    value: function isValidThreshold(candidate) {\n      return !(typeof candidate === 'boolean' || candidate === null || Array.isArray(candidate) || isNaN(candidate) || candidate < 0);\n    }\n  }, {\n    key: 'isThresholdMet',\n    value: function isThresholdMet(threshold, viewportWidth) {\n      return viewportWidth >= threshold;\n    }\n  }, {\n    key: 'resizeHandler',\n    value: function resizeHandler() {\n      if (this.isThresholdMet(this.thresholdWidth, this.window.innerWidth)) {\n        this.window.removeEventListener('resize', this.resizeHandler.bind(this));\n        this.init();\n      }\n    }\n  }, {\n    key: 'setupEventHandlers',\n    value: function setupEventHandlers($elm, setLightBackground, setDarkBackground) {\n      if ($elm.getAttribute('data-invert-bgcol-on-hover') !== null) {\n        $elm.addEventListener('mouseenter', setLightBackground);\n        $elm.addEventListener('mouseleave', setDarkBackground);\n      }\n    }\n  }, {\n    key: 'setDarkBackground',\n    value: function setDarkBackground() {\n      if (!!this.sourceToUse) {\n        this.$elm.style.backgroundImage = this.getBackgroundImagesString(this.sourceToUse, 'linear-gradient(to top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5))');\n        this.$elm.style.color = '#fff';\n      }\n    }\n  }, {\n    key: 'setLightBackground',\n    value: function setLightBackground() {\n      if (!!this.sourceToUse) {\n        this.$elm.style.backgroundImage = this.getBackgroundImagesString(this.sourceToUse, 'linear-gradient(to top, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5))');\n        this.$elm.style.color = '#212121';\n      }\n    }\n  }, {\n    key: 'getBackgroundImagesString',\n    value: function getBackgroundImagesString(path, grandient) {\n      if (!path || !path.length || path.length === 0) {\n        return '';\n      }\n\n      return grandient + ', url(' + path + ')';\n    }\n  }, {\n    key: 'calcSourceToUse',\n    value: function calcSourceToUse(sourceDefiner, isHighDpr) {\n      var lowResSource = '';\n      var highResSource = '';\n      if (!sourceDefiner) {\n        return '';\n      }\n\n      if (!!sourceDefiner.dataset) {\n        highResSource = sourceDefiner.dataset.highResImageSource;\n        lowResSource = sourceDefiner.dataset.lowResImageSource;\n      } else {\n        highResSource = sourceDefiner.getAttribute('data-highResImageSource');\n        lowResSource = sourceDefiner.getAttribute('data-lowResImageSource');\n      }\n\n      if (isHighDpr && !highResSource || !isHighDpr && !lowResSource) {\n        return '';\n      }\n\n      if (isHighDpr) {\n        return highResSource;\n      }\n\n      return lowResSource;\n    }\n  }]);\n\n  return BackgroundImage;\n}();\n\n},{\"../libs/elife-utils\":18}],6:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = function () {\n  function Carousel($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, Carousel);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n\n    this.moveableStage = this.$elm.querySelector('.carousel__items');\n    this.originalSlideWrappers = this.moveableStage.querySelectorAll('.carousel-item');\n    this.originalSlideCount = this.originalSlideWrappers.length;\n    this.currentSlideCount = this.originalSlideCount;\n\n    if (this.originalSlideCount < 2) {\n      return;\n    }\n\n    this.init();\n  }\n\n  _createClass(Carousel, [{\n    key: 'init',\n    value: function init() {\n      var _this = this;\n\n      this.currentSlide = 1;\n      this.timerInterval = 10000;\n\n      this.$elm.querySelector('.carousel__heading').classList.add('visuallyhidden');\n      this.updateButtonAppearance();\n      this.$elm.appendChild(this.buildVisibleControls());\n      this.$toggler = this.buildControl$toggle();\n      this.$elm.insertBefore(this.$toggler, this.$elm.querySelector('.carousel__items'));\n      this.updateWidth();\n      this.updateControlPanel(this.currentSlide);\n      this.togglePlay(this.$toggler);\n      this.$toggler.focus();\n\n      this.window.addEventListener('keydown', this.handleKey.bind(this));\n      this.window.addEventListener('blur', this.cancelTimer.bind(this));\n      this.window.addEventListener('focus', this.setupTimer.bind(this));\n      this.window.addEventListener('resize', function () {\n        _this.updateWidth();\n        _this.adjustTranslateForResize();\n      });\n      this.makeSingleSlideATVisible(this.currentSlide);\n    }\n  }, {\n    key: 'updateButtonAppearance',\n    value: function updateButtonAppearance() {\n      var buttons = this.$elm.querySelectorAll('.carousel-item__cta .button');\n      buttons.forEach(function (button) {\n        button.classList.add('button--outline');\n      });\n    }\n  }, {\n    key: 'atHide',\n    value: function atHide($node) {\n      $node.setAttribute('tabindex', -1);\n      $node.setAttribute('aria-hidden', true);\n    }\n  }, {\n    key: 'atShow',\n    value: function atShow($node) {\n      $node.removeAttribute('tabindex', -1);\n      $node.removeAttribute('aria-hidden', true);\n    }\n  }, {\n    key: 'setATVisibility',\n    value: function setATVisibility($root, show) {\n      var _this2 = this;\n\n      var action = void 0;\n      if (show) {\n        action = this.atShow;\n      } else {\n        action = this.atHide;\n      }\n\n      action.call(this, $root);\n      [].forEach.call($root.childNodes, function ($descendant) {\n        if ($descendant.nodeType === $descendant.ELEMENT_NODE) {\n          action.call(_this2, $descendant);\n          if ($descendant.hasChildNodes()) {\n            _this2.setATVisibility($descendant, show);\n          }\n        }\n      });\n    }\n  }, {\n    key: 'makeSingleSlideATVisible',\n    value: function makeSingleSlideATVisible(slideNumber) {\n      var _this3 = this;\n\n      [].forEach.call(this.moveableStage.querySelectorAll('.carousel-item'), function ($el) {\n        _this3.setATVisibility($el, false);\n      });\n      var _slideNumber = slideNumber || 1;\n      var slide = this.$elm.querySelectorAll('.carousel-item__inner')[_slideNumber - 1];\n      this.setATVisibility(slide, true);\n      slide.focus();\n    }\n\n    /**\n     * Builds and returns all controls for the carousel\n     *\n     * @returns {Element} The control panel\n     */\n\n  }, {\n    key: 'buildVisibleControls',\n    value: function buildVisibleControls() {\n      // Btn wrappers needed to reserve space in case buttons are removed, to stop things moving about\n      var $previousWrapper = this.buildControl$traverser('previous');\n      var $nextWrapper = this.buildControl$traverser('next');\n\n      this.buttons = {\n        previous: $previousWrapper.querySelector('button'),\n        next: $nextWrapper.querySelector('button')\n      };\n\n      // switches are the circular buttons for depicting/going to a slide\n      this.switches = this.buildControl$switches(this.originalSlideCount);\n\n      var $controlPanel = utils.buildElement('div', ['carousel__control_panel']);\n      var $visibleControlsWrapper = utils.buildElement('div', ['carousel__control_panel__visible']);\n      var visibleControls = [$previousWrapper, this.switches, $nextWrapper];\n      visibleControls.forEach(function (control) {\n        $visibleControlsWrapper.appendChild(control);\n      });\n\n      $controlPanel.appendChild($visibleControlsWrapper);\n\n      return $controlPanel;\n    }\n\n    /**\n     * Returns a div-wrapped button for a next or previous control, with event listener\n     *\n     * @param {String} direction 'previous' | 'next'\n     * @returns {Element} A div-wrapped button\n     */\n\n  }, {\n    key: 'buildControl$traverser',\n    value: function buildControl$traverser(direction) {\n      var _this4 = this;\n\n      var _direction = direction === 'previous' ? 'previous' : 'next';\n      var text = direction + ' item';\n      var $wrapper = utils.buildElement('div', ['carousel__control_wrapper']);\n      var $button = utils.buildElement('button', ['carousel__control', 'carousel__control--traverse', 'carousel__control--' + _direction], '', $wrapper);\n      $button.addEventListener('click', function () {\n        _this4.userInitiatedProgression(_this4[_direction]);\n      });\n\n      utils.buildElement('span', ['visuallyhidden'], text, $button);\n      return $wrapper;\n    }\n\n    /**\n     * Builds and returns a visually hidden play/pause toggle (button & label), with event listener\n     *\n     * @returns {Element} The toggler\n     */\n\n  }, {\n    key: 'buildControl$toggle',\n    value: function buildControl$toggle() {\n      var _this5 = this;\n\n      var $button = utils.buildElement('button', ['carousel__control--toggler', 'visuallyhidden'], 'Play carousel');\n      $button.setAttribute('aria-label', 'The carousel is now paused. Play carousel');\n      $button.addEventListener('click', function () {\n        _this5.togglePlay($button);\n      });\n      return $button;\n    }\n\n    /**\n     * Builds and returns a list of switches, with event listener attached\n     *\n     * @param quantity The number of switches to build\n     * @returns {Element} The list of switches\n     */\n\n  }, {\n    key: 'buildControl$switches',\n    value: function buildControl$switches(quantity) {\n      var $switches = utils.buildElement('ol', ['carousel__control_switches']);\n      for (var i = 1; i <= quantity; i += 1) {\n        $switches.appendChild(this.buildControl$switch('Go to item ' + i + ' of ' + this.originalSlideCount, i));\n      }\n\n      $switches.addEventListener('click', this.activateSwitch.bind(this));\n      return $switches;\n    }\n\n    /**\n     * Builds and returns a switch\n     * @param text The next for the switch (visually hidden)\n     * @returns {Element} The switch\n     */\n\n  }, {\n    key: 'buildControl$switch',\n    value: function buildControl$switch(text, index) {\n      var $item = utils.buildElement('li', ['carousel__control--switch-item']);\n      var $button = utils.buildElement('button', ['carousel__control', 'carousel__control--switch'], '', $item);\n      var $switch = utils.buildElement('span', ['visuallyhidden'], '' + index, $button);\n      $switch.setAttribute('aria-label', text);\n      return $item;\n    }\n\n    /**\n     * Toggles the play/pause state of the carousel based on the current value of the toggle button.\n     *\n     * @param $button The toggler\n     */\n\n  }, {\n    key: 'togglePlay',\n    value: function togglePlay($button) {\n      var currentButtonState = $button.innerHTML;\n      if (currentButtonState === 'Pause carousel') {\n        $button.innerHTML = 'Play carousel';\n        $button.setAttribute('aria-label', 'The carousel is now paused. Play carousel');\n        this.timerStopped = true;\n        this.cancelTimer();\n      } else {\n        $button.innerHTML = 'Pause carousel';\n        $button.setAttribute('aria-label', 'The carousel is now playing. Pause carousel');\n        this.timerStopped = false;\n        this.setupTimer();\n      }\n    }\n  }, {\n    key: 'cancelTimer',\n    value: function cancelTimer() {\n      this.window.clearInterval(this.timer);\n    }\n  }, {\n    key: 'setupTimer',\n    value: function setupTimer() {\n      var _this6 = this;\n\n      // make sure old timer stopped before starting a new one\n      this.cancelTimer();\n\n      // Indicates whether timer should run at all on this carousel (hard stop, not pause).\n      this.timerStopped = false;\n      this.timer = this.startNewAdvancementTimer(this.timerInterval);\n\n      // mousing over the carousel cancels the timer\n      this.$elm.addEventListener('mouseenter', this.cancelTimer.bind(this));\n\n      // mouse out from the carousel resets the timer\n      this.$elm.addEventListener('mouseleave', function () {\n        _this6.cancelTimer();\n        if (!_this6.timerStopped) {\n          _this6.timer = _this6.startNewAdvancementTimer(_this6.timerInterval);\n        }\n      });\n    }\n  }, {\n    key: 'startNewAdvancementTimer',\n    value: function startNewAdvancementTimer(intervalInMs) {\n      var _this7 = this;\n\n      return this.window.setInterval(function () {\n        if (!_this7.timerStopped) {\n          _this7.next();\n        }\n      }, intervalInMs);\n    }\n  }, {\n    key: 'handleKey',\n    value: function handleKey(e) {\n      var code = e.keyCode || e.charCode;\n      if (code === 37 /*left arrow*/ || code === 39 /*right arrow*/) {\n          this.timerStopped = true;\n          if (code === 37) {\n            this.userInitiatedProgression(this.previous);\n          } else {\n            this.userInitiatedProgression(this.next);\n          }\n        }\n    }\n  }, {\n    key: 'userInitiatedProgression',\n    value: function userInitiatedProgression(callback) {\n      // Any user-activation of a control permanently stops the timer\n      this.timerStopped = true;\n      if (!!callback && typeof callback === 'function') {\n        callback.call(this, true);\n      }\n    }\n  }, {\n    key: 'next',\n    value: function next() {\n      if (this.currentSlide % this.originalSlideCount === 0) {\n        this.extendStage();\n      }\n\n      this.updateSlide();\n      this.updateControlPanel(this.currentSlide);\n    }\n  }, {\n    key: 'previous',\n    value: function previous() {\n      if (this.currentSlide > 1) {\n        this.updateSlide('previous');\n        this.updateControlPanel(this.currentSlide);\n      }\n    }\n  }, {\n    key: 'extendStage',\n    value: function extendStage() {\n      var _this8 = this;\n\n      // Make room for another slide set\n      this.currentSlideCount += this.originalSlideCount;\n      this.updateWidth();\n\n      // Clone in the new slide set\n      [].forEach.call(this.originalSlideWrappers, function (slide) {\n        _this8.moveableStage.appendChild(slide.cloneNode(true));\n      });\n    }\n\n    /**\n     * Translates moveableStage 1 slide's width in the appropriate direction\n     * @param {String} direction 'next' | 'previous' Direction to move\n     */\n\n  }, {\n    key: 'updateSlide',\n    value: function updateSlide(direction) {\n      var currentOffset = this.getCurrentOffset();\n      var currentWidthStringMatch = this.window.getComputedStyle(this.$elm).width.match(/^([0-9]+)px/);\n      var currentCarouselWidth = this.window.parseInt(currentWidthStringMatch[1], 10);\n      var newOffset = void 0;\n      if (direction === 'previous') {\n        this.currentSlide -= 1;\n        newOffset = currentOffset + currentCarouselWidth;\n      } else {\n        this.currentSlide += 1;\n        newOffset = currentOffset - currentCarouselWidth;\n      }\n\n      utils.updateElementTranslate(this.moveableStage, [newOffset + 'px', 0]);\n    }\n\n    /**\n     * Returns the current numerical value of moveableStage's X translation in px\n     *\n     * @returns {number} Numerical value of the X translation of moveableStage\n     */\n\n  }, {\n    key: 'getCurrentOffset',\n    value: function getCurrentOffset() {\n      var offsetStringMatch = this.moveableStage.style.transform.match(/translate\\((.*)px,[^)]+\\)/);\n      if (!offsetStringMatch) {\n        return 0;\n      }\n\n      return this.window.parseInt(offsetStringMatch[1], 10);\n    }\n  }, {\n    key: 'updateControlPanel',\n    value: function updateControlPanel(currentSlide) {\n      this.hideInvalidButtonChoice(currentSlide);\n      this.updateActiveSwitch(currentSlide);\n    }\n\n    /**\n     * Hides previous button if on first slide.\n     *\n     * @param {number} currentSlide The number of the current slide\n     */\n\n  }, {\n    key: 'hideInvalidButtonChoice',\n    value: function hideInvalidButtonChoice(currentSlide) {\n      this.buttons.previous.classList.remove('hidden');\n      this.buttons.next.classList.remove('hidden');\n      var logicalSlideNumber = this.getLogicalSlideNumber(currentSlide);\n      if (logicalSlideNumber === 1) {\n        this.buttons.previous.classList.add('hidden');\n      } else if (logicalSlideNumber === this.originalSlideCount) {\n        this.buttons.next.classList.add('hidden');\n      }\n    }\n\n    /**\n     * Activate the switch indicating the current logical slide\n     *\n     * @param {number} currentSlide The number of the current slide\n     */\n\n  }, {\n    key: 'updateActiveSwitch',\n    value: function updateActiveSwitch(currentSlide) {\n      var currentLogicalSlide = this.getLogicalSlideNumber(currentSlide);\n      [].forEach.call(this.switches.querySelectorAll('.carousel__control--switch'), function (aSwitch, i) {\n        if (i === currentLogicalSlide - 1) {\n          aSwitch.classList.add('active');\n        } else {\n          aSwitch.classList.remove('active');\n        }\n      });\n    }\n\n    /**\n     * Returns the number of the side within its set.\n     *\n     * E.g. where there's 3 slides in a set, and the actualSlideNumber is 8, this indicates that it's\n     * the 2nd slide in the 3rd slide set, so its logical number is 2.\n     * (A slide set is a clone of the starting slides to facilitate perpetual scroll.)\n     *\n     * @param {number} actualSlideNumber Number of the slide to evaluate\n     * @returns {number}\n     */\n\n  }, {\n    key: 'getLogicalSlideNumber',\n    value: function getLogicalSlideNumber(actualSlideNumber) {\n      var setSize = this.originalSlideCount;\n      var slideSetOfSlide = Math.ceil(actualSlideNumber / setSize);\n      var firstSlideOfSet = setSize * slideSetOfSlide - (setSize - 1);\n      return actualSlideNumber - firstSlideOfSet + 1;\n    }\n\n    /**\n     * Move to the closest slide with the same logical number as the activated switch\n     *\n     * @param {Event} e The event\n     */\n\n  }, {\n    key: 'activateSwitch',\n    value: function activateSwitch(e) {\n      var logicalSlideRequested = this.window.parseInt(e.target.querySelector('span').innerHTML, 10);\n      var logicalSlideCurrent = this.getLogicalSlideNumber(this.currentSlide);\n      var slideOffset = logicalSlideRequested - logicalSlideCurrent;\n\n      if (logicalSlideRequested === logicalSlideCurrent) {\n        return;\n      }\n\n      var callback = slideOffset < 0 ? this.previous : this.next;\n\n      for (var i = 0; i < Math.abs(slideOffset); i += 1) {\n        this.userInitiatedProgression(callback);\n      }\n    }\n  }, {\n    key: 'adjustTranslateForResize',\n    value: function adjustTranslateForResize() {\n      var carouselWidth = window.getComputedStyle(this.$elm).width.match(/([0-9]+)px/)[1];\n      var currentSlide = this.currentSlide;\n      var expectedOffset = (currentSlide - 1) * carouselWidth * -1;\n      this.moveableStage.style.transform = 'translate(' + expectedOffset + 'px, 0)';\n    }\n  }, {\n    key: 'updateWidth',\n    value: function updateWidth() {\n      this.moveableStage.style.width = utils.adjustPxString(this.window.getComputedStyle(this.$elm).width, this.currentSlideCount, 'multiply');\n    }\n  }]);\n\n  return Carousel;\n}();\n\n},{\"../libs/elife-utils\":18}],7:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  function ContentHeaderArticle($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, ContentHeaderArticle);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n    this.$elm.classList.add('content-header-article--js');\n\n    // Should track SASS variable $bkpt-content-header--medium-width.\n    this.breakpointInPx = 768;\n    this.currentView = this.calcCurrentView(this.breakpointInPx);\n\n    this.authors = $elm.querySelectorAll('.content-header__author_list_item');\n    this.institutions = $elm.querySelectorAll('.content-header__institution_list_item');\n\n    this.hasToggleAuthor = false;\n    this.hasToggleInstitution = false;\n    this.hideAllExcessItems('author', this.authors);\n    this.hideAllExcessItems('institution', this.institutions);\n\n    var _this = this;\n    this.window.addEventListener('resize', function () {\n      var newView = _this.calcCurrentView(_this.breakpointInPx);\n      if (newView !== _this.currentView) {\n        _this.currentView = newView;\n        _this.handleAnyExcessItems('author', _this.authors);\n        _this.handleAnyExcessItems('institution', _this.institutions);\n      }\n    });\n  }\n\n  _createClass(ContentHeaderArticle, [{\n    key: 'handleAnyExcessItems',\n    value: function handleAnyExcessItems(itemType, items) {\n      var toggle = this.$elm.querySelector('.content-header__item_toggle');\n      if (toggle && toggle.innerHTML.indexOf('less') > -1 && this.currentView === 'wide') {\n        this.clearExcessMark(items);\n        this.toggleExcessItems(items);\n      } else {\n        this.clearExcessMark(items);\n        var excessItems = this.getExcessItems(itemType, items);\n        this.markAsExcess(excessItems);\n        this.toggleExcessItems(items);\n        this.markLastNonExcessItem(itemType, items);\n      }\n    }\n\n    /**\n     * Determine excess by itemType from items supplied and hides those.\n     *\n     * @param {string} itemType 'author' or 'institution'\n     * @param {DOMTokenList} items List of items to identify the excess within, and hide those\n     */\n\n  }, {\n    key: 'hideAllExcessItems',\n    value: function hideAllExcessItems(itemType, items) {\n      var excessItems = this.getExcessItems(itemType, items);\n      this.markAsExcess(excessItems);\n      this.toggleExcessItems(items);\n      this.addTrailingText(itemType, items);\n    }\n\n    /**\n     * Returns max number authors or institutions to be displayed by default at current screen width.\n     *\n     * Returns null if itemType is invalid.\n     *\n     * @param {string} itemType 'author' or 'institution'\n     * @returns {number|null} Number of the type of item to display by default at current screen width\n     */\n\n  }, {\n    key: 'getDefaultMaxItems',\n    value: function getDefaultMaxItems(itemType) {\n      if (this.currentView === 'wide') {\n        if (itemType === 'author') {\n          return 16;\n        }\n\n        if (itemType === 'institution') {\n          return 10;\n        }\n      } else {\n        if (itemType === 'author') {\n          return 1;\n        }\n\n        if (itemType === 'institution') {\n          return 0;\n        }\n      }\n\n      return null;\n    }\n\n    /**\n     * Returns array of elements in excess of the default max items, or null if itemType invalid.\n     *\n     * The returned array is a subset of the list supplied, or empty if there are no excess items.\n     *\n     * @param {string} itemType 'author' or 'institution'\n     * @param {DOMTokenList} items List of items from which to identify the excess\n     * @returns {Array|null} Items in excess of the default maximum for the current screen width\n     */\n\n  }, {\n    key: 'getExcessItems',\n    value: function getExcessItems(itemType, items) {\n      if (itemType !== 'author' && itemType !== 'institution') {\n        return null;\n      }\n\n      var defaultMaxItems = this.getDefaultMaxItems(itemType);\n      if (items.length > defaultMaxItems) {\n        return [].slice.call(items, defaultMaxItems);\n      }\n\n      return [];\n    }\n\n    /**\n     * Marks supplied list elements as excess.\n     *\n     * @param {Array} els The elements to mark as excess\n     */\n\n  }, {\n    key: 'markAsExcess',\n    value: function markAsExcess(els) {\n      els.forEach(function ($el) {\n        $el.classList.add('excess-item');\n      });\n    }\n\n    /**\n     * Clears any excess mark from all elements in the supplied list.\n     *\n     * @param {DOMTokenList} els The elements to clear the excess mark from\n     */\n\n  }, {\n    key: 'clearExcessMark',\n    value: function clearExcessMark(els) {\n      [].forEach.call(els, function ($el) {\n        $el.classList.remove('excess-item');\n      });\n    }\n\n    /**\n     * Toggles the display of any excess items found in the supplied list of elements.\n      * @param {DOMTokenList} items The elements to inspect for excess items, and to toggle those found\n     */\n\n  }, {\n    key: 'toggleExcessItems',\n    value: function toggleExcessItems(items) {\n      [].forEach.call(items, function (item) {\n        if (item.classList.contains('excess-item')) {\n          item.classList.add('visuallyhidden');\n        } else {\n          item.classList.remove('visuallyhidden');\n        }\n      });\n    }\n\n    /**\n     * Returns the name of the current view.\n     *\n     * @param {number} breakpoint The px viewport width that determines the view.\n     *\n     * @returns {string} the view name ('wide' or 'narrow').\n     */\n\n  }, {\n    key: 'calcCurrentView',\n    value: function calcCurrentView(breakpoint) {\n      return this.window.matchMedia('(min-width: ' + breakpoint + 'px)').matches ? 'wide' : 'narrow';\n    }\n\n    /**\n     * Marks the last shown non-excess item with particlular class (so not if showing last in list).\n     *\n     * @param {string} itemType 'author' or 'institution'\n     * @param {DOMTokenList} items List of items to act upon\n     */\n\n  }, {\n    key: 'markLastNonExcessItem',\n    value: function markLastNonExcessItem(itemType, items) {\n      var lastShownIndex = null;\n      var foundLastShown = false;\n      [].forEach.call(items, function (item, i) {\n\n        // Clear old any obsolete determination of what's the last non-excess item.\n        items[i].classList.remove('content-header__' + itemType + '--last-non-excess');\n        if (item.classList.contains('excess-item') && !foundLastShown) {\n          lastShownIndex = i - 1;\n          foundLastShown = true;\n        }\n      });\n\n      if (lastShownIndex !== null && lastShownIndex > -1) {\n        var lastShown = items[lastShownIndex].querySelector('.content-header__' + itemType);\n        if (lastShown) {\n          lastShown.classList.add('content-header__' + itemType + '--last-non-excess');\n        }\n      }\n    }\n\n    /**\n     * Adds trailing text to the visible end of truncated author & institution lists & builds toggle.\n     *\n     * @param {string} itemType The type of items supplied\n     * @param {DOMTokenList} items The items to which to add the trailing text\n     */\n\n  }, {\n    key: 'addTrailingText',\n    value: function addTrailingText(itemType, items) {\n      if (itemType === 'author' && items.length > this.getDefaultMaxItems('author')) {\n        if (!this.hasToggleAuthor) {\n          this.buildSeeMoreLessToggle('author');\n          this.hasToggleAuthor = true;\n        }\n      }\n\n      if (itemType === 'institution' && items.length > this.getDefaultMaxItems('institution')) {\n        if (!this.hasToggleInstitution) {\n          this.buildSeeMoreLessToggle('institution');\n          this.hasToggleInstitution = true;\n        }\n      }\n\n      this.markLastNonExcessItem(itemType, items);\n    }\n\n    /**\n     * Builds the show/hide toggle for excess authors & institutions.\n     */\n\n  }, {\n    key: 'buildSeeMoreLessToggle',\n    value: function buildSeeMoreLessToggle(itemType) {\n      var _this2 = this;\n\n      // This toggle only required due to screen width constraints. All content already accessible as\n      // it's not being hidden in the first place. Hence an aria-hidden li, rather than an anchor.\n      // Should conform to https://www.w3.org/TR/wai-aria/states_and_properties#aria-hidden\n      var toggle = this.doc.createElement('li');\n      var toggleOnText = 'see&nbsp;all';\n      var toggleOffText = 'see&nbsp;less';\n      toggle.setAttribute('aria-hidden', 'true');\n      toggle.classList.add('content-header__item_toggle', 'content-header__item_toggle--' + itemType);\n      toggle.innerHTML = '&nbsp;&hellip;&nbsp;' + toggleOnText;\n      toggle.addEventListener('click', function (e) {\n        var target = e.target;\n        if (target.innerHTML.indexOf(toggleOnText) > -1) {\n          [].forEach.call(_this2.doc.querySelectorAll('.content-header__item_toggle'), function (item) {\n            item.innerHTML = '&nbsp;' + toggleOffText;\n          });\n          _this2.clearExcessMark(_this2.authors);\n          _this2.clearExcessMark(_this2.institutions);\n          _this2.toggleExcessItems(_this2.authors);\n          _this2.toggleExcessItems(_this2.institutions);\n        } else {\n          [].forEach.call(_this2.doc.querySelectorAll('.content-header__item_toggle'), function (item) {\n            item.innerHTML = '&nbsp;&hellip;&nbsp;' + toggleOnText;\n          });\n          _this2.hideAllExcessItems('author', _this2.authors);\n          _this2.hideAllExcessItems('institution', _this2.institutions);\n        }\n      });\n      this.$elm.querySelector('.content-header__' + itemType + '_list').appendChild(toggle);\n    }\n  }]);\n\n  return ContentHeaderArticle;\n}();\n\n},{}],8:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = require('../libs/elife-utils')();\n\n/**\n * FragmentHandler mediates how the hash controls the opening of article sections.\n * It has no dedicated pattern template and its data-behaviour may live on any element, but note\n * that because it's a singleton only one will be instansiated.\n * @type {FragmentHandler}\n */\nmodule.exports = function () {\n  _createClass(FragmentHandler, null, [{\n    key: 'isSingleton',\n    value: function isSingleton() {\n      return true;\n    }\n  }]);\n\n  function FragmentHandler($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, FragmentHandler);\n\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n    this.window.addEventListener('DOMContentLoaded', this.handleDomLoad.bind(this));\n  }\n\n  _createClass(FragmentHandler, [{\n    key: 'handleDomLoad',\n    value: function handleDomLoad(e) {\n      this.handleSectionOpeningViaHash(e);\n      this.window.addEventListener('hashchange', this.handleSectionOpeningViaHash.bind(this));\n    }\n\n    /**\n     * Indicates whether an HTML element with a given id is found as/within a specific chunk of html\n     *\n     * @param {String} id The id  of the HTML element to search for\n     * @param {HTMLElement} $section The element to search/search within\n     * @param {HTMLDocument} doc\n     * @param {Function} areElementsNested Handles determination of nesting\n     * @returns {boolean} true if element with id is $section, or is contained within $section\n     */\n\n  }, {\n    key: 'isIdOfOrWithinSection',\n    value: function isIdOfOrWithinSection(id, $section, doc, areElementsNested) {\n      if (id === $section.id) {\n        return true;\n      }\n\n      var $fragWithId = doc.querySelector('#' + id);\n      return areElementsNested($section, $fragWithId);\n    }\n\n    /**\n     * Returns the id of the collapsed section containing the html element with idToFind, or null.\n     *\n     * @param {String} idToFind The id to search for\n     * @param {HTMLDocument} doc\n     * @param {Function} areElementsNested Handles determination of nesting\n     * @returns {String} The id of the collapsed section containing idToFind, or null\n     */\n\n  }, {\n    key: 'getIdOfCollapsedSection',\n    value: function getIdOfCollapsedSection(idToFind, doc, areElementsNested) {\n      var _this = this;\n\n      var collapsedSections = doc.querySelectorAll('.article-section--collapsed');\n      if (!collapsedSections) {\n        return null;\n      }\n\n      var $collapsedSectionContainingFrag = void 0;\n      [].forEach.call(collapsedSections, function ($collapsedSection) {\n        if (!$collapsedSectionContainingFrag) {\n          if (_this.isIdOfOrWithinSection(idToFind, $collapsedSection, doc, areElementsNested)) {\n            $collapsedSectionContainingFrag = $collapsedSection;\n          }\n        }\n      });\n\n      if (!!$collapsedSectionContainingFrag) {\n        return $collapsedSectionContainingFrag.id;\n      }\n\n      return null;\n    }\n\n    /**\n     * Fires a custom expandsection event on the collapsed article section containing id from hash.\n     *\n     * @param e\n     * @returns {boolean} False if no hash found\n     */\n\n  }, {\n    key: 'handleSectionOpeningViaHash',\n    value: function handleSectionOpeningViaHash(e) {\n\n      // TODO: Code similar to that in Audioplayer.seekNewTime(), refactor out into common\n      var hash = '';\n\n      // event was hashChange\n      if (!!e.newURL) {\n        hash = e.newURL.substring(e.newURL.indexOf('#') + 1);\n      } else {\n        hash = this.window.location.hash.substring(1);\n      }\n\n      if (!hash) {\n        return false;\n      }\n\n      var idOfCollapsedSection = this.getIdOfCollapsedSection(hash, this.doc, utils.areElementsNested);\n      if (!!idOfCollapsedSection) {\n        // emit a section open event with the id of the section to open\n        // TODO: Used in several places, refactor out into common\n        var expandSection = void 0;\n        try {\n          expandSection = new CustomEvent('expandsection', { detail: hash });\n        } catch (e) {\n          // CustomEvent not supported, do it the old fashioned way\n          expandSection = document.createEvent('expandsection');\n          expandSection.initCustomEvent('expandsection', true, true, { detail: hash });\n        }\n\n        this.doc.querySelector('#' + idOfCollapsedSection).dispatchEvent(expandSection);\n      }\n    }\n  }]);\n\n  return FragmentHandler;\n}();\n\n},{\"../libs/elife-utils\":18}],9:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  function MainMenu($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, MainMenu);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n  }\n\n  /**\n   * Moves main menu from default non-js DOM position into position required by js implementation.\n   */\n\n\n  _createClass(MainMenu, [{\n    key: 'moveWithinDom',\n    value: function moveWithinDom() {\n      this.$elm.classList.add('main-menu--js');\n      var $globalWrapper = this.doc.querySelector('.global-wrapper');\n      if (!!$globalWrapper) {\n        $globalWrapper.insertBefore(this.$elm, $globalWrapper.firstElementChild);\n      }\n    }\n\n    /**\n     * Indicates whether the main menu is currently open.\n     *\n     * @returns {boolean} true if the main menu is currently open\n     */\n\n  }, {\n    key: 'isOpen',\n    value: function isOpen() {\n      return this.$elm.classList.contains('main-menu--shown');\n    }\n\n    /**\n     * Closes the main menu\n     */\n\n  }, {\n    key: 'close',\n    value: function close() {\n      this.$elm.classList.remove('main-menu--shown');\n      this.doc.querySelector('.global-wrapper').classList.remove('pull-offscreen-right');\n    }\n\n    /**\n     * Opens the main menu\n     */\n\n  }, {\n    key: 'open',\n    value: function open() {\n      this.$elm.classList.add('main-menu--shown');\n      this.doc.querySelector('.global-wrapper').classList.add('pull-offscreen-right');\n    }\n  }]);\n\n  return MainMenu;\n}();\n\n},{}],10:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  function Math($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, Math);\n\n    this.window = _window;\n    Math.loadDependencies(doc);\n  }\n\n  _createClass(Math, null, [{\n    key: 'loadDependencies',\n    value: function loadDependencies(doc) {\n      if (!Math.dependenciesAlreadySetup(doc)) {\n        Math.setupProperties();\n        Math.load(doc);\n      }\n    }\n  }, {\n    key: 'dependenciesAlreadySetup',\n    value: function dependenciesAlreadySetup(doc) {\n      return !!doc.querySelector('script[src*=\"mathjax\"]');\n    }\n  }, {\n    key: 'setupProperties',\n    value: function setupProperties() {\n      window.MathJax = {\n        'HTML-CSS': {\n          linebreaks: { automatic: true, width: '75% container' }\n        },\n        SVG: {\n          linebreaks: { automatic: true, width: '75% container' }\n        }\n      };\n    }\n  }, {\n    key: 'setupResizeHandler',\n    value: function setupResizeHandler() {\n      var resizeTimeout = void 0;\n      var resizeThrottler = function resizeThrottler() {\n        if (!resizeTimeout) {\n          resizeTimeout = setTimeout(function () {\n            resizeTimeout = null;\n\n            // TODO: change so exactly one rerender regardless of number of Math instances.\n            // Consider tacking at the same time as fragment handler.\n            if (!!this.window.MathJax) {\n              this.window.MathJax.Hub.Queue(['Rerender', this.window.MathJax.Hub]);\n            }\n          }, 300);\n        }\n      };\n\n      window.addEventListener('resize', resizeThrottler);\n    }\n  }, {\n    key: 'load',\n    value: function load(doc) {\n      var script = doc.createElement('script');\n      script.type = 'text/javascript';\n      script.addEventListener('load', Math.setupResizeHandler);\n      script.src = 'https://cdn.mathjax.org/mathjax/2.7-latest/MathJax.js?config=MML_HTMLorMML';\n      doc.querySelector('body').appendChild(script);\n    }\n  }]);\n\n  return Math;\n}();\n\n},{}],11:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  function MediaChapterListingItem($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, MediaChapterListingItem);\n\n    if (!$elm) {\n      console.warn('No element provided');\n      return;\n    }\n\n    console.log('Initialising Chapter listing item...');\n\n    this.$elm = $elm;\n    this.startTime = $elm.dataset.startTime;\n    if (!this.startTime || isNaN(this.startTime) || this.startTime < 0) {\n      return;\n    }\n\n    this.window = _window;\n    this.document = doc;\n\n    // When ready, AudioPlayer dispatches a custom event 'playerReady' on window, that supplies that\n    // player's html element id.\n    _window.addEventListener('playerReady', this.listenForChapterChange.bind(this));\n    this.$link = this.createLink(doc, this.$elm, this.startTime);\n    this.setupEventHandlers(this.$link);\n  }\n\n  _createClass(MediaChapterListingItem, [{\n    key: 'listenForChapterChange',\n    value: function listenForChapterChange(e) {\n      var $player = this.document.querySelector('#' + e.detail);\n      if (!!$player) {\n        $player.addEventListener('chapterChanged', this.indicateChapterChanged.bind(this));\n      }\n    }\n  }, {\n    key: 'createLink',\n    value: function createLink(document, $rootElm, startTime) {\n      var $title = $rootElm.querySelector('.teaser__header_text');\n      if (!$title) {\n        return;\n      }\n\n      var titleText = void 0;\n      var $existingLink = void 0;\n      try {\n        $existingLink = $title.querySelector('.teaser__header_text_link');\n        titleText = $existingLink.innerHTML;\n        $existingLink.parentNode.removeChild($existingLink);\n      } catch (e) {\n        titleText = $title.innerHTML;\n      }\n\n      var $link = document.createElement('a');\n      $link.innerHTML = titleText;\n      $link.setAttribute('href', '#' + startTime);\n      $link.classList.add('teaser__header_text_link');\n      $title.innerHTML = '';\n      $title.appendChild($link);\n      return $link;\n    }\n  }, {\n    key: 'indicateChapterChanged',\n    value: function indicateChapterChanged(e) {\n      var currentChapterNumber = e.detail;\n      if (currentChapterNumber === this.window.parseInt(this.$elm.dataset.chapterNumber)) {\n        this.$elm.classList.add('current-chapter');\n      } else {\n        this.$elm.classList.remove('current-chapter');\n      }\n    }\n  }, {\n    key: 'setupEventHandlers',\n    value: function setupEventHandlers($link) {\n      $link.addEventListener('chapterChanged', this.indicateChapterChanged);\n    }\n  }]);\n\n  return MediaChapterListingItem;\n}();\n\n},{}],12:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = function () {\n  function Pager($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, Pager);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n\n    this.$targetEl = this.find$targetEl();\n    this.$loader = this.find$Loader();\n    if (!(this.$loader && this.$targetEl)) {\n      return;\n    }\n\n    this.isCurrentlyLoading = false;\n    this.timeoutThresholdInMs = 10000;\n    this.$loader.addEventListener('click', this.handleLoadRequest.bind(this));\n  }\n\n  _createClass(Pager, [{\n    key: 'injectNewData',\n    value: function injectNewData(newData) {\n      var normalisedData = Pager.normaliseData(newData);\n      var regex = /.*<ol[^>]*class=\"[^\"]*(grid-listing|listing-list)[^\"]*\"[^>]*>(<li>?.*<\\/li>)<\\/ol>.*/;\n      var match = normalisedData.match(regex);\n\n      if (!(match && match[2])) {\n        throw new SyntaxError('Loaded data doesn\\'t match required format');\n      }\n\n      var data = match[2];\n      var frag = this.doc.createDocumentFragment();\n      var $temp = this.doc.createElement('div');\n      $temp.innerHTML = data;\n      while ($temp.firstElementChild) {\n        var child = $temp.firstElementChild;\n        frag.appendChild(child);\n      }\n\n      this.$targetEl.appendChild(frag);\n    }\n  }, {\n    key: 'redirectToFullResultsPage',\n    value: function redirectToFullResultsPage() {\n      var loaderLink = this.getValidLoaderLink();\n      if (loaderLink) {\n        this.window.location.search = loaderLink;\n      }\n    }\n  }, {\n    key: 'handleError',\n    value: function handleError() {\n      this.redirectToFullResultsPage();\n    }\n  }, {\n    key: 'getValidLoaderLink',\n    value: function getValidLoaderLink() {\n      var match = this.$loader.href.match(/\\?page=([0-9]+)/);\n      if (match) {\n        return match[0];\n      }\n    }\n  }, {\n    key: 'getPageNumberFromLoaderLink',\n    value: function getPageNumberFromLoaderLink() {\n      var loaderLink = this.getValidLoaderLink();\n      if (loaderLink) {\n        var pageNumber = loaderLink.match(/\\?page=([0-9]+)/)[1];\n        return this.window.parseInt(pageNumber, 10);\n      }\n    }\n  }, {\n    key: 'setLoadingState',\n    value: function setLoadingState() {\n      var _this = this;\n\n      this.isCurrentlyLoading = true;\n      this.$loader.classList.add('button--inactive');\n      var $pagerTextWrapper = this.$loader.querySelector('.pager__text_wrapper');\n      if ($pagerTextWrapper) {\n        $pagerTextWrapper.innerHTML = 'Loading...';\n        $pagerTextWrapper.classList.add('loading');\n      }\n\n      // If the loading takes longer than timeoutThresholdInMs, try to go to the full results page.\n      this.loadingTimer = this.window.setTimeout(function () {\n        _this.redirectToFullResultsPage();\n      }, this.timeoutThresholdInMs);\n    }\n  }, {\n    key: 'clearLoadingState',\n    value: function clearLoadingState() {\n      this.window.clearTimeout(this.loadingTimer);\n      this.isCurrentlyLoading = false;\n      var $pagerTextWrapper = this.$loader.querySelector('.pager__text_wrapper');\n      if ($pagerTextWrapper) {\n        $pagerTextWrapper.classList.remove('loading');\n        $pagerTextWrapper.innerHTML = !!this.$loader.originalText ? this.$loader.originalText : 'Load more';\n      }\n\n      this.$loader.classList.remove('button--inactive');\n    }\n  }, {\n    key: 'updatePager',\n    value: function updatePager(data) {\n      if (Pager.isLastPage(data)) {\n        this.$loader.parentNode.removeChild(this.$loader);\n      } else {\n        var pageNumber = this.getPageNumberFromLoaderLink();\n        if (!isNaN(pageNumber)) {\n          pageNumber += 1;\n          this.$loader.href = '?page=' + pageNumber;\n        }\n      }\n    }\n  }, {\n    key: 'updateUrl',\n    value: function updateUrl() {\n      var validLoaderLink = this.getValidLoaderLink();\n      if (validLoaderLink) {\n        this.window.history.pushState(null, '', validLoaderLink);\n      }\n    }\n  }, {\n    key: 'handleLoad',\n    value: function handleLoad(data) {\n      var normalisedData = void 0;\n      try {\n        normalisedData = Pager.normaliseData(data);\n        this.injectNewData(normalisedData);\n      } catch (e) {\n        this.handleError(e);\n        return;\n      }\n\n      this.clearLoadingState();\n      this.updateUrl();\n      this.updatePager(normalisedData);\n    }\n  }, {\n    key: 'handleLoadRequest',\n    value: function handleLoadRequest(e) {\n      e.preventDefault();\n\n      if (this.isCurrentlyLoading) {\n        return;\n      }\n\n      var pageNum = this.getPageNumberFromLoaderLink();\n      this.loadNextPageData('?page=' + pageNum, this.window.XMLHttpRequest).then(this.handleLoad.bind(this), this.handleError.bind(this));\n      this.setLoadingState();\n    }\n  }, {\n    key: 'loadNextPageData',\n    value: function loadNextPageData(url, XMLHttpRequest) {\n\n      return new Promise(function resolver(resolve, reject) {\n        var xhr = new XMLHttpRequest();\n        xhr.addEventListener('load', function () {\n          resolve(xhr.responseText);\n        });\n        xhr.addEventListener('error', reject);\n        xhr.open('GET', url);\n        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n        xhr.send();\n      });\n    }\n  }, {\n    key: 'find$Loader',\n    value: function find$Loader() {\n      var $loader = this.$elm.querySelector('.button--full:first-child.button--full:last-child');\n      if (!$loader) {\n        return;\n      }\n\n      $loader.id = utils.uniqueIds.get('pager', this.doc);\n      $loader.originalText = $loader.innerHTML;\n      var $loaderTextWrapper = this.doc.createElement('span');\n      $loaderTextWrapper.classList.add('pager__text_wrapper');\n      $loaderTextWrapper.innerHTML = $loader.originalText;\n      $loader.replaceChild($loaderTextWrapper, $loader.firstChild);\n\n      return $loader;\n    }\n  }, {\n    key: 'find$targetEl',\n    value: function find$targetEl() {\n      return this.doc.querySelector('#' + this.$elm.dataset.targetid);\n    }\n  }], [{\n    key: 'normaliseData',\n    value: function normaliseData(data) {\n      var dataNoLeadingWhitespace = data.replace(/^\\s+([^\\s])/gm, '$1');\n      return dataNoLeadingWhitespace.replace(/\\n/g, '');\n    }\n  }, {\n    key: 'isLastPage',\n    value: function isLastPage(data) {\n      return !data.match(/class=\"pager\".*button--default.*button--default/g);\n    }\n  }]);\n\n  return Pager;\n}();\n\n},{\"../libs/elife-utils\":18}],13:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n\n  // Injecting window and document to allow easier mocking\n  function SearchBox($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, SearchBox);\n\n    try {\n      this.$elm = $elm;\n      this.$input = this.$elm.querySelector('input[type=\"search\"]');\n    } catch (e) {\n      return;\n    }\n\n    this.$container = $elm.querySelector('fieldset');\n    this.$resetButton = $elm.querySelector('button[type=\"reset\"]');\n\n    this.$elm.classList.add('search-box--js');\n\n    // events\n    this.$resetButton.addEventListener('click', this.reset.bind(this));\n    this.$input.addEventListener('keyup', this.handleInput.bind(this));\n    this.$input.addEventListener('paste', this.handleInput.bind(this));\n  }\n\n  /**\n   * Handles the reset button being pressed.\n   */\n\n\n  _createClass(SearchBox, [{\n    key: 'reset',\n    value: function reset() {\n      this.hideResetButton();\n      if (this.$output) {\n        this.$output.innerHTML = '';\n      }\n\n      this.$input.focus();\n    }\n\n    /**\n     * Hides the reset button.\n     */\n\n  }, {\n    key: 'hideResetButton',\n    value: function hideResetButton() {\n      this.$elm.classList.remove('search-box--populated');\n    }\n\n    /**\n     * Shows the reset button.\n     */\n\n  }, {\n    key: 'showResetButton',\n    value: function showResetButton() {\n      this.$elm.classList.add('search-box--populated');\n    }\n\n    /**\n     * Show/hide reset button, depending on whether there's text to clear or not.\n     */\n\n  }, {\n    key: 'handleInput',\n    value: function handleInput(e) {\n      if (e.keyCode === /*Tab*/9) {\n        return;\n      }\n\n      if (this.$input.value.length > 0) {\n        this.showResetButton();\n      } else {\n        this.hideResetButton();\n      }\n    }\n  }]);\n\n  return SearchBox;\n}();\n\n},{}],14:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  function SelectNav($elm) {\n    _classCallCheck(this, SelectNav);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.$elm.classList.add('select-nav--js');\n    this.$elm.querySelector('select').addEventListener('change', this.triggerSubmit.bind(this));\n  }\n\n  _createClass(SelectNav, [{\n    key: 'triggerSubmit',\n    value: function triggerSubmit() {\n      this.$elm.submit();\n    }\n  }]);\n\n  return SelectNav;\n}();\n\n},{}],15:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = function () {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  function SiteHeader($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, SiteHeader);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n\n    var SearchBox = require('./SearchBox');\n    var $searchBoxEl = $elm.querySelector('[data-behaviour=\"SearchBox\"]');\n    this.searchBox = new SearchBox($searchBoxEl, this.window, doc);\n    var searchToggle = $elm.querySelector('[rel=\"search\"]');\n    if (!!searchToggle) {\n      this.searchToggle = searchToggle.parentNode;\n      this.searchToggle.addEventListener('click', this.toggleSearchBox.bind(this));\n    }\n\n    this.$pageOverlay = null;\n\n    // N.B. $mainMenu is not part of this component's HTML hierarchy.\n    var mainMenu = doc.querySelector('#mainMenu');\n    if (!!mainMenu) {\n      var MainMenu = require('./MainMenu');\n      this.mainMenu = new MainMenu(mainMenu);\n\n      this.$mainMenuToggle = this.$elm.querySelector('a[href=\"#mainMenu\"]');\n      if (!!this.$mainMenuToggle) {\n        this.mainMenu.moveWithinDom();\n        this.$mainMenuToggle.addEventListener('click', this.toggleMainMenu.bind(this));\n      }\n    }\n  }\n\n  /**\n   * Toggles display of the main menu.\n   */\n\n\n  _createClass(SiteHeader, [{\n    key: 'toggleMainMenu',\n    value: function toggleMainMenu(e) {\n      if (this.mainMenu.isOpen()) {\n        this.mainMenu.close();\n        this.window.removeEventListener('keyup', this.checkForMenuClose.bind(this));\n        this.doc.querySelector('.global-inner').removeEventListener('click', this.checkForMenuClose.bind(this));\n      } else {\n        this.mainMenu.open();\n        this.window.addEventListener('keyup', this.checkForMenuClose.bind(this));\n        this.doc.querySelector('.global-inner').addEventListener('click', this.checkForMenuClose.bind(this));\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }, {\n    key: 'checkForMenuClose',\n    value: function checkForMenuClose(e) {\n      if (e.keyCode === 27 || e.type === 'click') {\n        this.mainMenu.close();\n      }\n    }\n\n    /**\n     * Toggles display of the search box.\n     *\n     * @param {Event} e The event causing the toggle to occur\n     */\n\n  }, {\n    key: 'toggleSearchBox',\n    value: function toggleSearchBox(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      if (this.searchBoxIsOpen()) {\n        this.closeSearchBox();\n      } else {\n        this.openSearchBox();\n      }\n    }\n\n    /**\n     * Returns true if the search box is currently displayed.\n     *\n     * @returns {boolean} True if the search box is open\n     */\n\n  }, {\n    key: 'searchBoxIsOpen',\n    value: function searchBoxIsOpen() {\n      return this.searchBox.$elm.classList.contains('search-box--shown');\n    }\n\n    /**\n     * Closes the search box.\n     */\n\n  }, {\n    key: 'closeSearchBox',\n    value: function closeSearchBox() {\n      this.searchBox.$elm.classList.remove('search-box--shown');\n      utils.updateElementTranslate(this.searchBox.$elm, [0, '-40px']);\n      if (this.searchBox.$output) {\n        this.searchBox.$output.innerHTML = '';\n      }\n\n      this.searchBox.$input.blur();\n      this.window.removeEventListener('keyup', this.checkForClose.bind(this));\n      this.window.removeEventListener('click', this.checkForClose.bind(this));\n      this.hidePageOverlay();\n    }\n\n    /**\n     * Decides whether to close the search box, based on the supplied event.\n     *\n     * @param e The KeyboardEvent provoking the check.\n     */\n\n  }, {\n    key: 'checkForClose',\n    value: function checkForClose(e) {\n      if (e.keyCode && e.keyCode === 27 || e.type === 'click' && !utils.areElementsNested(this.searchBox.$elm, e.target)) {\n        this.closeSearchBox();\n      }\n    }\n\n    /**\n     * Opens the search box.\n     */\n\n  }, {\n    key: 'openSearchBox',\n    value: function openSearchBox() {\n      var _this = this;\n\n      var myHeight = this.window.getComputedStyle(this.$elm).height;\n      var adjustment = 20;\n      var offsetY = utils.adjustPxString(myHeight, adjustment, 'add');\n\n      // This is set in the site-header.scss.\n      var transitionDurationInMs = 150;\n      utils.updateElementTranslate(this.searchBox.$elm, [0, offsetY]);\n      utils.invertPxString(this.window.getComputedStyle(this.searchBox.$container).height);\n      this.searchBox.$elm.classList.add('search-box--shown');\n      this.window.addEventListener('keyup', this.checkForClose.bind(this));\n      this.window.addEventListener('click', this.checkForClose.bind(this));\n\n      this.window.setTimeout(function () {\n\n        // blur before focus forces the focus, a simple focus doesn't always behave as expected.\n        _this.searchBox.$input.blur();\n        _this.searchBox.$input.focus();\n      }, transitionDurationInMs);\n      this.showPageOverlay();\n    }\n\n    /**\n     * Creates the page overlay.\n     *\n     */\n\n  }, {\n    key: 'createPageOverlay',\n    value: function createPageOverlay() {\n      var className = 'overlay--semi-white';\n\n      if (!this.$pageOverlay) {\n        this.$pageOverlay = this.doc.createElement('div');\n        this.$pageOverlay.classList.add(className);\n      }\n\n      var $target = this.doc.querySelector('.global-inner');\n      $target.insertBefore(this.$pageOverlay, this.doc.querySelector('.site-header').nextElementSibling);\n    }\n\n    /**\n     * Shows the page overlay.\n     */\n\n  }, {\n    key: 'showPageOverlay',\n    value: function showPageOverlay() {\n      if (!this.$pageOverlay) {\n        this.createPageOverlay();\n      }\n\n      this.$pageOverlay.style.display = 'block';\n      this.$pageOverlay.style.height = this.doc.querySelector('.global-inner').getBoundingClientRect().height + 'px';\n    }\n\n    /**\n     * Hides the page overlay.\n     */\n\n  }, {\n    key: 'hidePageOverlay',\n    value: function hidePageOverlay() {\n      this.$pageOverlay.style.display = 'none';\n    }\n  }]);\n\n  return SiteHeader;\n}();\n\n},{\"../libs/elife-utils\":18,\"./MainMenu\":9,\"./SearchBox\":13}],16:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  function ViewSelector($elm) {\n    var _window = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window;\n\n    var doc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : document;\n\n    _classCallCheck(this, ViewSelector);\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n    this.$jumpLinks = this.$elm.querySelector('.view-selector__jump_links');\n    this.$jumpLinksToggle = this.$elm.querySelector('.view-selector__jump_links_header');\n    this.cssFixedClassName = 'view-selector--fixed';\n\n    this.mainTarget = this.doc.querySelector('[role=\"main\"]');\n\n    // matches top padding in scss\n    var topSpaceWhenFixed = 30;\n\n    this.elmYOffset = this.$elm.offsetTop - topSpaceWhenFixed;\n    this.window.addEventListener('scroll', this.handleScroll.bind(this));\n    this.$jumpLinksToggle.addEventListener('click', this.toggleJumpLinks.bind(this));\n    this.toggleJumpLinks();\n  }\n\n  _createClass(ViewSelector, [{\n    key: 'handleScroll',\n    value: function handleScroll() {\n\n      // If it's position is fixed\n      if (this.$elm.classList.contains(this.cssFixedClassName)) {\n\n        // Allow it to scroll again if it could keep its position & not scroll off top of screen\n        if (this.window.pageYOffset < this.elmYOffset) {\n          this.$elm.classList.remove(this.cssFixedClassName);\n          return;\n        }\n\n        // Allow it to scroll again if it would otherwise over-/under-lay following element\n        var bottomOfMain = this.mainTarget.getBoundingClientRect().bottom;\n        if (bottomOfMain < this.$elm.offsetHeight) {\n          var amountToNudgeUp = bottomOfMain - this.$elm.offsetHeight;\n          this.$elm.style.top = amountToNudgeUp + 'px';\n          return;\n        }\n\n        // Ensure top of component is not off top of screen once bottom of main is off screen bottom\n        // Safety net: required because a fast scroll may prevent all code running as desired.\n        if (bottomOfMain >= this.window.innerHeight) {\n          this.$elm.style.top = '0px';\n        }\n\n        return;\n      }\n\n      // Otherwise fix its position if it would otherwise scroll off the top of the screen\n      if (this.window.pageYOffset >= this.elmYOffset) {\n        this.$elm.classList.add(this.cssFixedClassName);\n        this.$elm.style.top = '0px';\n      }\n    }\n  }, {\n    key: 'toggleJumpLinks',\n    value: function toggleJumpLinks() {\n      this.$jumpLinks.classList.toggle('visuallyhidden');\n      this.$jumpLinksToggle.classList.toggle('view-selector__jump_links_header--closed');\n      this.handleScroll();\n    }\n  }]);\n\n  return ViewSelector;\n}();\n\n},{}],17:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  function ViewerModal($elm) {\n    _classCallCheck(this, ViewerModal);\n\n    this.$elm = $elm;\n    this.$prev = document.createElement('div');\n    this.$next = document.createElement('div');\n\n    // build the modal\n    this.build();\n\n    // events\n    this.$prev.addEventListener('click', this.prev);\n    this.$next.addEventListener('click', this.next);\n  }\n\n  _createClass(ViewerModal, [{\n    key: 'build',\n    value: function build() {\n      //\n    }\n  }, {\n    key: 'prev',\n    value: function prev(e) {\n      e.preventDefault();\n    }\n  }, {\n    key: 'next',\n    value: function next(e) {\n      e.preventDefault();\n    }\n  }, {\n    key: 'close',\n    value: function close() {\n      //\n    }\n  }]);\n\n  return ViewerModal;\n}();\n\n},{}],18:[function(require,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nmodule.exports = function () {\n  'use strict';\n\n  /**\n   * Builds and returns specified HTML element, optionally adding it to the DOM.\n   *\n   * @param {string} elName Name of the HTML element to build\n   * @param {Array} [cssClasses] CSS class name(s) to set on the element\n   * @param {string} [textContent] Textual content of the element\n   * @param {string|Element} [parent] Parent element to attach to\n   * @param {string|Element|boolean} [attachBefore] Following sibling (1st if true, last if falsey)\n   *\n   * @returns {Element}\n   */\n\n  function buildElement(elName, cssClasses, textContent, parent, attachBefore) {\n\n    var $el = document.createElement(elName);\n    var $parent = typeof parent === 'string' ? document.querySelector(parent) : parent;\n\n    // Work out what the new element's following sibling will be, based on value of attachBefore.\n    var $followingSibling = function () {\n\n      if (!!attachBefore) {\n\n        if (typeof attachBefore === 'boolean') {\n          return $parent.firstElementChild;\n        } else if (typeof attachBefore === 'string') {\n          return document.querySelector(attachBefore);\n        } else if (attachBefore instanceof HTMLElement) {\n          return attachBefore;\n        }\n      }\n    }();\n\n    if (Array.isArray(cssClasses)) {\n      cssClasses.forEach(function (cssClass) {\n        $el.classList.add(cssClass);\n      });\n    }\n\n    if (textContent) {\n      $el.innerHTML = textContent;\n    }\n\n    if (!!$parent) {\n      // TODO: Handle what happens if following sibling is not a child of parent\n      if (!!$followingSibling) {\n        $parent.insertBefore($el, $followingSibling);\n      } else {\n        $parent.appendChild($el);\n      }\n    }\n\n    return $el;\n  }\n\n  var uniqueIds = function uniqueIds() {\n    var UniqueIdentifiers = function () {\n      function UniqueIdentifiers() {\n        _classCallCheck(this, UniqueIdentifiers);\n\n        this.used = [];\n      }\n\n      _createClass(UniqueIdentifiers, [{\n        key: 'isValid',\n        value: function isValid(candidate, document) {\n          // Compulsory check that id is unique to this object's knowledge.\n          if (this.used.indexOf(candidate) > -1) {\n            return false;\n          }\n\n          // Optional check to see if id is unique in the DOM.\n          if (!!document) {\n            if (!!document.querySelector && typeof document.querySelector === 'function' && document.querySelector('#' + candidate)) {\n              return false;\n            }\n          }\n\n          return true;\n        }\n\n        /**\n         * Gets a unique id with optional prefix.\n         *\n         * @param {string} [prefix] Prefix to use for the id\n         * @param {HTMLDocument} [document] Enables checking for the id's uniqueness within the DOM\n         * @returns {string}\n         */\n\n      }, {\n        key: 'get',\n        value: function get(prefix, document) {\n          var _prefix = '' + prefix || 'default_';\n          var random = ('' + Math.random()).replace(/\\./, '');\n          var candidate = _prefix + random;\n          if (this.isValid(candidate, document)) {\n            this.used.push(candidate);\n            return candidate;\n          }\n\n          this.get(prefix, document);\n        }\n      }]);\n\n      return UniqueIdentifiers;\n    }();\n\n    return new UniqueIdentifiers();\n  }();\n\n  /**\n   * Updates the CSS transform's translate function on the element in a vendor-prefix-aware fashion.\n   *\n   * Because of the way CSS transformations are combined into a matrix, this may not work\n   * as expected if other CSS transformations are also applied to the same element.\n   *\n   * @param {HTMLElement} $el The element to apply the transformation to.\n   * @param {Array} offset The offset for both axes, expressed as [x, y], e.g. [0, '20px']\n   */\n  function updateElementTranslate($el, offset) {\n    if (!($el instanceof HTMLElement && Array.isArray(offset))) {\n      return false;\n    }\n\n    function calcOffset(value) {\n      if (!value) {\n        return '0px';\n      }\n\n      if (typeof value === 'number') {\n        return value + 'px';\n      }\n\n      if (typeof value === 'string') {\n        value += 'px';\n        return value.replace(/((px)+)$/, 'px');\n      }\n    }\n\n    var offsetX = calcOffset(offset[0]);\n    var offsetY = calcOffset(offset[1]);\n\n    var props = ['webkitTransform', 'mozTransform', 'msTransform', 'oTransform', 'transform'];\n    props.forEach(function (prop) {\n      // Only set the vendor prefixed properties where they are supported\n      if ($el.style[prop] !== undefined) {\n        $el.style[prop] = 'translate(' + offsetX + ', ' + offsetY + ')';\n      }\n    });\n  }\n\n  function _getValueFromPxString(pxString) {\n    if (pxString === '0') {\n      return 0;\n    }\n\n    return parseInt(pxString.match(/([-0-9.]+)px/)[1], 10);\n  }\n\n  function _getZeroAwarePxStringFromValue(value) {\n    if (value === 0) {\n      return '' + value;\n    }\n\n    return value + 'px';\n  }\n\n  /**\n   * Add a quantity to a px amount expressed as a string, and return new string with updated value.\n   *\n   * For example: adjustPxString('97px', 8) returns '105px'\n   *\n   * @param {String} pxString The string representing the original quantity, e.g. '97px'\n   * @param adjustment The numeric adjustment to make, e.g. 8\n   * @param operation\n   * @returns {string} The modified value, as a string, e.g.: '105px'\n   */\n  function adjustPxString(pxString, adjustment, requestedOperation) {\n    var originalSize = _getValueFromPxString(pxString);\n    var adjustedSize = originalSize;\n    var operation = 'add';\n    if (['subtract', 'multiply', 'divide'].indexOf(requestedOperation) > -1) {\n      operation = requestedOperation;\n    }\n\n    switch (operation) {\n      case 'add':\n        adjustedSize = originalSize + adjustment;\n        break;\n      case 'subtract':\n        adjustedSize = originalSize - adjustment;\n        break;\n      case 'multiply':\n        adjustedSize = originalSize * adjustment;\n        break;\n      case 'divide':\n        adjustedSize = originalSize / adjustment;\n        break;\n      default:\n        break;\n    }\n    return _getZeroAwarePxStringFromValue(adjustedSize);\n  }\n\n  /**\n   * Invert the px amount expressed as a string, and return new string with inverted value.\n   *\n   * For example: invertPxString('97px') returns '-97px'\n   *\n   * @param {String} pxString The string representing the original quantity, e.g. '97px'\n   * @returns {string} The modified value, as a string, e.g.: '-97px'\n   */\n  function invertPxString(pxString) {\n    var originalSize = _getValueFromPxString(pxString);\n    var adjustedSize = originalSize * -1;\n    return _getZeroAwarePxStringFromValue(adjustedSize);\n  }\n\n  /**\n   * Returns true if $prospectiveDescendant is, or is a descendant of $prospectiveParent.\n   *\n   * @param {Node} $prospectiveParent el to test as a parent of the $prospectiveDescendant\n   * @param {Node} $prospectiveDescendant el to test as descendant of the $prospectiveParent\n   * @returns {boolean} Whether the $prospectiveDescendant is, or descends from $prospectiveParent\n   */\n  function areElementsNested($prospectiveParent, $prospectiveDescendant) {\n    if (!($prospectiveParent instanceof Node && $prospectiveDescendant instanceof Node)) {\n      return false;\n    }\n\n    var relationship = $prospectiveParent.compareDocumentPosition($prospectiveDescendant);\n    return !!(relationship & $prospectiveParent.DOCUMENT_POSITION_CONTAINED_BY || relationship === 0);\n  }\n\n  /**\n   * Returns whether the display is considered to have a high pixel density ratio.\n   *\n   * @param window\n   * @returns {boolean} true if dpr >= 2, false if lower, or unknown.\n   */\n  function isHighDpr(window) {\n    if (!!window.devicePixelRatio) {\n      return window.devicePixelRatio >= 2;\n    }\n\n    return false;\n  }\n\n  return {\n    adjustPxString: adjustPxString,\n    areElementsNested: areElementsNested,\n    buildElement: buildElement,\n    invertPxString: invertPxString,\n    isHighDpr: isHighDpr,\n    uniqueIds: uniqueIds,\n    updateElementTranslate: updateElementTranslate\n  };\n};\n\n},{}],19:[function(require,module,exports){\n'use strict';\n\n// Base level of feature support needed for the js loaded in this file.\n// Consider AJAXing in the rest if the test passes.\n\nif (window.localStorage && document.querySelector && window.addEventListener && !!document.createElement('div').classList) {\n  (function () {\n\n    document.querySelector('html').classList.add('js');\n\n    var Components = {};\n\n    // import modules into the list of Components.\n    Components.AllSubjectsListLink = require('./components/AllSubjectsListLink');\n    Components.ArticleDownloadLinksList = require('./components/ArticleDownloadLinksList');\n    Components.ArticleSection = require('./components/ArticleSection');\n    Components.AudioPlayer = require('./components/AudioPlayer');\n    Components.BackgroundImage = require('./components/BackgroundImage');\n    Components.Carousel = require('./components/Carousel');\n    Components.ContentHeaderArticle = require('./components/ContentHeaderArticle');\n    Components.FragmentHandler = require('./components/FragmentHandler');\n    Components.MainMenu = require('./components/MainMenu');\n    Components.Math = require('./components/Math');\n    Components.MediaChapterListingItem = require('./components/MediaChapterListingItem');\n    Components.Pager = require('./components/Pager');\n    Components.SearchBox = require('./components/SearchBox');\n    Components.SelectNav = require('./components/SelectNav');\n    Components.SiteHeader = require('./components/SiteHeader');\n    Components.ViewerModal = require('./components/ViewerModal');\n    Components.ViewSelector = require('./components/ViewSelector');\n\n    // App\n    var Elife = function Elife() {\n\n      var singletons = function () {\n        var registered = [];\n\n        function isRegistered(componentName) {\n          return registered.indexOf(componentName) > -1;\n        }\n\n        function register(componentName) {\n          registered.push(componentName);\n        }\n\n        return {\n          isRegistered: isRegistered,\n          register: register\n        };\n      }();\n\n      function initialiseComponent($component) {\n        // When present, data-behaviour contains a space-separated list of handlers for that component\n        var handlers = $component.getAttribute('data-behaviour').trim().split(' ');\n        for (var i = 0; i < handlers.length; i += 1) {\n          var handler = handlers[i];\n          if (!singletons.isRegistered(handler)) {\n            if (!!Components[handler] && typeof Components[handler] === 'function') {\n              new Components[handler]($component, window, window.document);\n            }\n\n            if (typeof Components[handler].isSingleton === 'function' && Components[handler].isSingleton()) {\n              singletons.register(handler);\n            }\n          }\n        }\n      }\n\n      var components = document.querySelectorAll('[data-behaviour]');\n      if (components) {\n        [].forEach.call(components, initialiseComponent);\n      }\n    };\n\n    new Elife();\n  })();\n}\n\n},{\"./components/AllSubjectsListLink\":1,\"./components/ArticleDownloadLinksList\":2,\"./components/ArticleSection\":3,\"./components/AudioPlayer\":4,\"./components/BackgroundImage\":5,\"./components/Carousel\":6,\"./components/ContentHeaderArticle\":7,\"./components/FragmentHandler\":8,\"./components/MainMenu\":9,\"./components/Math\":10,\"./components/MediaChapterListingItem\":11,\"./components/Pager\":12,\"./components/SearchBox\":13,\"./components/SelectNav\":14,\"./components/SiteHeader\":15,\"./components/ViewSelector\":16,\"./components/ViewerModal\":17}]},{},[19])\n\n","'use strict';\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = class ArticleDownloadLinksList {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n\n    // One statement per class name because IE doesn't support multiple strings, comma separated.\n    this.$elm.classList.add('article-download-links-list--js');\n    this.$elm.classList.add('visuallyhidden');\n    this.moveList();\n    this.$toggler = this.doc.querySelector('.content-header__download_link');\n    this.$toggler.addEventListener('click', this.toggle.bind(this));\n  }\n\n  /**\n   * Moves the download links list to be by the icon this.$toggler\n   */\n  moveList() {\n    let $newParent = this.doc.querySelector('.content-header_top');\n    let $followingSibling =\n      $newParent.querySelector('.content-header__download_link').nextElementSibling;\n    this.$elm.parentNode.parentNode.classList.add('visuallyhidden');\n    $newParent.insertBefore(this.$elm, $followingSibling);\n  }\n\n  /**\n   * Toggles the download links list display.\n   *\n   * @param e The event triggering the display toggle\n   */\n  toggle(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.isOpen()) {\n      this.close();\n    } else {\n      this.open();\n    }\n\n  }\n\n  /**\n   * Returns whether links list is currently viewable.\n   *\n   * @returns {boolean} Whether links list is currently viewable\n   */\n  isOpen() {\n    return !this.$elm.classList.contains('visuallyhidden');\n  }\n\n  /**\n   * Make viewable.\n   */\n  open() {\n    this.$elm.classList.remove('visuallyhidden');\n    this.window.addEventListener('click', this.checkForClose.bind(this));\n  }\n\n  /**\n   * Checks whether a click occurred outside this, and close this if it did.\n   *\n   * @param e The click event to evaluate the target of\n   */\n  checkForClose(e) {\n    if (!utils.areElementsNested(this.$elm, e.target)) {\n      this.close();\n    }\n  }\n\n  /**\n   * Make unviewable.\n   */\n  close() {\n    this.$elm.classList.add('visuallyhidden');\n    this.window.removeEventListener('click', this.checkForClose.bind(this));\n  }\n\n};\n","'use strict';\n\nmodule.exports = class ArticleSection {\n\n  constructor($elm, _window = window, doc = document) {\n\n    if ($elm.classList.contains('article-section--first')) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n\n    this.thresholdWidth = 600;\n    this.initialise(this.$elm, doc);\n  }\n\n  initialise($elm, doc) {\n    this.$elm.classList.add('article-section--js');\n    this.$headerLink = this.createHeaderLink($elm, doc);\n    this.$body = $elm.querySelector('.article-section__body');\n    this.setInitialState($elm, this.$headerLink, this.$body);\n    this.$elm.addEventListener('expandsection', this.expand.bind(this));\n  }\n\n  createHeaderLink($elm, doc) {\n    let $header = $elm.querySelector('.article-section__header');\n    let $link = doc.createElement('A');\n    $link.setAttribute('href', '#');\n    $link.classList.add('article-section__header_link');\n    $link.appendChild($header.firstElementChild);\n    $header.appendChild($link);\n    $link.addEventListener('click', this.toggleState.bind(this));\n    return $link;\n  }\n\n  setInitialState($elm, $headerLink, $body) {\n    if ($elm.dataset.initialState === 'closed' || this.viewportNoWiderThan(this.thresholdWidth)) {\n      $elm.classList.add('article-section--collapsed');\n      $headerLink.classList.add('article-section__header_link--closed');\n      $body.classList.add('visuallyhidden');\n    } else {\n      // Defensive: remove classes if they turn up here when they shouldn't\n      $headerLink.classList.remove('article-section__header_link--closed');\n      $body.classList.remove('visuallyhidden');\n    }\n\n  }\n\n  viewportNoWiderThan(thresholdInPx) {\n    return this.window.matchMedia('(max-width: ' + thresholdInPx + 'px)').matches;\n  }\n\n  toggleState(e) {\n    e.preventDefault();\n    this.$headerLink.classList.toggle('article-section__header_link--closed');\n    this.$elm.classList.toggle('article-section--collapsed');\n    this.$body.classList.toggle('visuallyhidden');\n    if (!this.$body.classList.contains('visuallyhidden') && !!this.window.MathJax) {\n      this.window.MathJax.Hub.Queue(['Rerender', this.window.MathJax.Hub, this.$elm.id]);\n    }\n  }\n\n  expand(e) {\n    this.$headerLink.classList.remove('article-section__header_link--closed');\n    this.$elm.classList.remove('article-section--collapsed');\n    this.$body.classList.remove('visuallyhidden');\n    if (!!this.window.MathJax) {\n      this.window.MathJax.Hub.Queue(['Rerender', this.window.MathJax.Hub, this.$elm.id]);\n    }\n\n    let $descendentEl = this.doc.querySelector('#' + e.detail);\n    if (!!$descendentEl) {\n      $descendentEl.scrollIntoView();\n    }\n  }\n\n};\n","'use strict';\nvar utils = require('../libs/elife-utils')();\nmodule.exports = class AudioPlayer {\n\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      console.warn('No element provided');\n      return;\n    }\n\n    this.window = _window;\n    if (!this.window.HTMLAudioElement) {\n      console.warn('Audio element not supported');\n      return;\n    }\n\n    console.log('Initialising Audio Player...');\n\n    this.$elm = $elm;\n    this.$audioElement = this.$elm.querySelector('audio');\n    if (!this.$audioElement) {\n      console.warn('No audio element found');\n      return;\n    }\n\n    this.uniqueId = utils.uniqueIds.get('audio', doc);\n    this.$elm.id = this.uniqueId;\n    this.$playButton = AudioPlayer.buildPlayButton(this);\n    this.$icon = this.$playButton.querySelector('.audio-player__toggle_play_icon');\n\n    // $title must be prepared before buildProgressIndicator is called\n    this.$title = this.prepare$title(this.$elm.querySelector('.audio-player__header'), doc);\n    this.$progressTrack = AudioPlayer.buildProgressIndicator(this);\n    this.$progressBar = this.$progressTrack.querySelector('[class*=\"progress_bar\"]');\n    this.$timeIndicators = AudioPlayer.buildTimeIndicators(this);\n    this.$currentTime = this.$timeIndicators.querySelector('[class*=\"current_time\"]');\n    this.$duration = this.$timeIndicators.querySelector('[class*=\"duration\"]');\n\n    // state\n    this.duration = null;\n    this.isPlaying = false;\n\n    this.$elm.classList.add('audio-player--js');\n\n    this.$playButton.classList.add('loading');\n    this.$audioElement.addEventListener('loadedmetadata', () => {\n      this.playerReady(this);\n    });\n\n    this.usingMetadata = false;  // set to true in loadMetadata if no errors thrown\n    this.loadMetadata(this.$elm.dataset.episodeNumber);\n\n  }\n\n  playerReady(player) {\n    player.duration = player.$audioElement.duration;\n    player.$duration.innerHTML = AudioPlayer.secondsToMinutes(player.duration);\n    player.$playButton.addEventListener('click', () => {\n      player.togglePlay(player.$audioElement, player.$playButton);\n    }, false);\n    player.$audioElement.addEventListener('timeupdate', player.update.bind(player));\n    player.window.addEventListener('hashchange', player.seekNewTime.bind(player));\n    player.window.addEventListener('load', player.seekNewTime.bind(player));\n    this.$playButton.classList.remove('loading');\n\n    let playerReady;\n    try {\n      playerReady = new CustomEvent('playerReady', { detail: this.uniqueId });\n    } catch (e) {\n      // CustomEvent not supported, do it the old fashioned way\n      playerReady = document.createEvent('playerReady');\n      playerReady.initCustomEvent('playerReady', true, true, { detail: this.uniqueId });\n    }\n\n    player.window.dispatchEvent(playerReady);\n\n  }\n\n  prepare$title(parent, doc) {\n    let span = doc.createElement('span');\n    try {\n      span.innerHTML = parent.innerHTML;\n    } catch (e) {\n      return;\n    }\n\n    span.classList.add('audio-player__title');\n    parent.innerHTML = '';\n    parent.appendChild(span);\n    return span;\n  }\n\n  /**\n   * Converts seconds to a display of minutes & seconds.\n   *\n   * @param {Number} seconds The time to convert, in seconds\n   * @returns {string} The time in a [m]m:ss string\n   */\n  static secondsToMinutes(seconds) {\n    let _seconds = parseInt(seconds, 10);\n    let mins = Math.floor(_seconds / 60);\n    let secs = _seconds % 60;\n    if (secs <= 9) {\n      secs = '0' + secs;\n    }\n\n    return `${mins}:${secs}`;\n  }\n\n  //noinspection JSValidateJSDoc\n  /**\n   * Toggles play/pause state of media file.\n   *\n   * @param {HTMLAudioElement} $audioElement The audio element to toggle the play state of\n   * @param {HTMLButtonElement} $togglePlayButton The button controlling the playback\n   */\n  togglePlay($audioElement, $togglePlayButton) {\n    if (this.isPlaying) {\n      this.pause($audioElement, $togglePlayButton);\n    } else {\n      this.play($audioElement, $togglePlayButton);\n    }\n  }\n\n  play($audioElement, $togglePlayButton) {\n    $audioElement.play();\n    AudioPlayer.updateIconState(this.$icon, 'pause');\n    $togglePlayButton.classList.add('audio-player__toggle_play--pauseable');\n    $togglePlayButton.classList.remove('audio-player__toggle_play--playable');\n    this.isPlaying = true;\n  }\n\n  pause ($audioElement, $togglePlayButton) {\n    $audioElement.pause();\n    AudioPlayer.updateIconState(this.$icon, 'play');\n    $togglePlayButton.classList.add('audio-player__toggle_play--playable');\n    $togglePlayButton.classList.remove('audio-player__toggle_play--pauseable');\n    this.isPlaying = false;\n  }\n\n  /**\n   * Update the progress bar and elapsed time indicator based on track's current time.\n   */\n  update() {\n    let currentTime = Math.floor(this.$audioElement.currentTime);\n    let pc = (currentTime / this.duration) * 100;\n    let currentTime2Dis = AudioPlayer.secondsToMinutes(currentTime);\n    this.$progressBar.style.width = `${pc}%`;\n    this.$currentTime.innerHTML = currentTime2Dis;\n\n    if (this.usingMetadata) {\n      let chapterNumberOnLastUpdate = this.getCurrentChapterNumber();\n      this.setCurrentChapterMetadata(this.getChapterMetadataAtTime(currentTime,\n                                                                   this.chapterMetadata));\n      if (this.getCurrentChapterMetadata().number !== chapterNumberOnLastUpdate) {\n        this.changeChapter(this.getCurrentChapterNumber(),\n                           this.getCurrentChapterMetadata().title,\n                           this.$elm);\n      }\n    }\n\n    if (this.$audioElement.ended) {\n      AudioPlayer.updateIconState(this.$icon, 'play');\n      this.isPlaying = false;\n    }\n  }\n\n  /**\n   * Updates player title with chapter number & name, and dispatches chapterChanged event.\n   *\n   * @param {int} number New chapter number Used as value of detail property of\n   * @param {String} title new chapter title\n   * @param {HTMLElement} $elm Element from which to dispatch the event\n   */\n  changeChapter(number, title, $elm) {\n    this.setTitle(this.episodeTitle, title);\n    let chapterChanged;\n    try {\n      chapterChanged = new CustomEvent('chapterChanged', { detail: number });\n    } catch (e) {\n      // CustomEvent not supported, do it the old fashioned way\n      chapterChanged = document.createEvent('chapterChanged');\n      chapterChanged.initCustomEvent('chapterChanged', true, true, { detail: number });\n    }\n\n    $elm.dispatchEvent(chapterChanged);\n  }\n\n  /**\n   * Updates the icon state for the play button.\n   *\n   * @param $icon {HTMLImageElement} The img to update\n   * @param state {string} The state to update to (either 'play' or 'pause')\n   */\n  static updateIconState($icon, state) {\n    if (state !== 'play' && state !== 'pause') {\n\n      return;\n    }\n\n    $icon.src = AudioPlayer.getIconPath((state));\n    $icon.alt = state;\n  }\n\n  seekNewTime(e) {\n    var hash;\n    var shouldPlay = false;\n    try {\n      hash = e.newURL.substring(e.newURL.indexOf('#') + 1);\n\n      // Should play when chapter changed within the page, but not autoplay on page load :-)\n      shouldPlay = true;\n    } catch (e) {\n      // newURL only available on hashchange event, but load event may also invoke this handler\n      hash = this.window.location.hash.substring(1);\n      shouldPlay = false;\n    }\n\n    if (!isNaN(hash) && hash >= 0) {\n      this.seek(hash, this.$audioElement);\n      if (!this.isPlaying && shouldPlay) {\n        this.play(this.$audioElement, this.$playButton);\n      }\n    }\n  }\n\n  /**\n   * Event handler to determine track seek time in response to user interaction.\n   *\n   * @param e The user-generated click event\n   * @param {AudioPlayer} player The audio player object that the new element belongs to\n   */\n  handleSeek(e, player) {\n    var newSeekPosition = parseInt(e.offsetX, 10);\n    var availableWidth = player.$progressTrack.clientWidth;\n    var durationProportionToSeek = (newSeekPosition / parseInt(availableWidth, 10));\n    this.seek(durationProportionToSeek * player.duration, player.$audioElement);\n  }\n\n  //noinspection JSValidateJSDoc\n  /**\n   * Seeks a particular time in the media file.\n   *\n   * @param {Number} time The time to seek\n   * @param {HTMLAudioElement} $audioElement The audio element to toggle the play state of\n   */\n  seek(time, $audioElement) {\n    $audioElement.currentTime = time;\n    this.update();\n  }\n\n  /**\n   * Builds the progress indicator.\n   *\n   * @param {AudioPlayer} player The audio player object that the new element belongs to\n   * @returns {Element} The progress indicator\n   */\n  static buildProgressIndicator(player) {\n    var $barWrapper = utils.buildElement('div',\n                               ['audio-player__progress'],\n                               '',\n                               '#' + player.uniqueId + ' [class*=\"audio-player__container\"]');\n\n    utils.buildElement('div', ['audio-player__progress_bar'], '', $barWrapper);\n\n    $barWrapper.addEventListener('click', function (e) {\n      player.handleSeek(e, player);\n    }, false);\n\n    return $barWrapper;\n  }\n\n  /**\n   * Builds the play button.\n   *\n   * @param {AudioPlayer} player The audio player object that the new element belongs to\n   * @returns {Element} The play/pause button\n   */\n  static buildPlayButton(player) {\n    var $button = utils.buildElement('button',\n                              ['audio-player__toggle_play'],\n                              '',\n                              '#' + player.uniqueId + ' [class*=\"audio-player\"]',\n                              true);\n    var $image = utils.buildElement('img',\n                       ['audio-player__toggle_play_icon'],\n                       '',\n                       $button);\n    $image.src = AudioPlayer.getIconPath('play');\n    $image.alt = 'Play';\n    return $button;\n  }\n\n  /**\n   * Builds the current time and duration indicators.\n   *\n   * @param {AudioPlayer} player The audio player object that the new element belongs to\n   * @returns {Element} An element containing the current time and duration indicators.\n   */\n  static buildTimeIndicators(player) {\n    var playerId = player.uniqueId;\n    var $container = utils.buildElement('div',\n                                        ['audio-player__times'],\n                                        '',\n                                        '#' + playerId + ' [class*=audio-player__header]',\n                                        true);\n\n    utils.buildElement('span', ['audio-player__current_time'], '0:00', $container);\n    utils.buildElement('span', ['audio-player__duration'], '0:00', $container);\n    return $container;\n  }\n\n  static getIconPath(iconName) {\n\n    if (iconName !== 'play' && iconName !== 'pause') {\n      return;\n    }\n\n    return `../../assets/img/icons/audio-${iconName}.svg`;\n  }\n\n  /**\n   * Set the title based on both episode and chapter titles\n   * @param episodeTitle\n   * @param chapterTitle\n   */\n  setTitle(episodeTitle, chapterTitle) {\n    this.title = episodeTitle;\n    if (!!chapterTitle) {\n      this.title += ': ' + chapterTitle;\n    }\n\n    this.$title.innerHTML = this.title;\n  }\n\n  getCurrentChapterMetadata() {\n    return this.currentChapterMetadata;\n  }\n\n  setCurrentChapterMetadata(metadata) {\n    this.currentChapterMetadata = metadata;\n  }\n\n  getCurrentChapterNumber() {\n    return this.getCurrentChapterMetadata().number || 0;\n  }\n\n  /**\n   * Returns a chapter's title and number, based on the playback position\n   * @param time\n   * @param {Array} chapterMetadata\n   * An array of objects that must contain as a minimum\n   * @returns {*}\n   */\n  getChapterMetadataAtTime(time, chapterMetadata) {\n    if (!chapterMetadata) {\n      return '';\n    }\n\n    let chapterTitle = '';\n    let chapterNumber = 0;\n    chapterMetadata.forEach(function (chapter, i, chapters) {\n      let chapterStartTime = parseInt(chapter.time, 10);\n      let nextChapterStartTime = i < chapters.length - 1 ? chapters[i + 1].time : null;\n      if (time >= chapterStartTime) {\n        if (!nextChapterStartTime || time < nextChapterStartTime) {\n          chapterTitle = chapter.title;\n          chapterNumber = chapter.number;\n        }\n      }\n    });\n\n    return {\n      title: chapterTitle,\n      number: chapterNumber\n    };\n  }\n\n  /**\n   * Sets episode title and respective chapter information from metadata\n   * @param metadata\n   */\n  processMetadata(metadata) {\n    this.episodeTitle = 'Episode ' + metadata.number;\n    this.setTitle(this.episodeTitle);\n\n    this.chapterMetadata = this.prepareChapterMetadata(metadata);\n    this.currentChapterMetadata = { number: 0, title: '' };\n  }\n\n  /**\n   * Returns array of objects describing respective chapter information\n   * @param metadata\n   * @returns {Array} of objects containing time, number and title properties\n   */\n  prepareChapterMetadata(metadata) {\n    let chapterMetadata = [];\n    metadata.chapters.forEach((chapter) => {\n      chapterMetadata.push(\n        {\n          time: chapter.time,\n          number: chapter.number,\n          title: chapter.number + '. ' + chapter.title\n        }\n      );\n    });\n\n    return chapterMetadata;\n  }\n\n  /**\n   * Metadata is expected in the data-metadata attribute of $elm as a JSON-like string with single-\n   * quoted instead of double-quoted values.\n   */\n  loadMetadata() {\n    try {\n      this.processMetadata(JSON.parse(this.$elm.dataset.metadata.replace(/'/g, '\"')));\n      this.usingMetadata = true;\n    } catch (e) {\n      console.error(e);\n      this.usingMetadata = false;\n    }\n  }\n};\n","'use strict';\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = class BackgroundImage {\n\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n\n    this.sourceToUse = null;\n    this.thresholdWidth = parseInt(this.$elm.dataset.thresholdWidth, 10);\n    if (this.isValidThreshold(this.thresholdWidth) &&\n        !this.isThresholdMet(this.thresholdWidth, this.window.innerWidth)) {\n      this.window.addEventListener('resize', this.resizeHandler.bind(this));\n    } else {\n      this.init();\n    }\n\n  }\n\n  init() {\n    this.sourceToUse = this.calcSourceToUse(this.$elm, utils.isHighDpr(this.window));\n    this.setDarkBackground();\n    this.setupEventHandlers(this.$elm,\n                            this.setLightBackground.bind(this),\n                            this.setDarkBackground.bind(this));\n  }\n\n  isValidThreshold(candidate) {\n    return !(\n      typeof candidate === 'boolean' ||\n      candidate === null ||\n      Array.isArray(candidate) ||\n      isNaN(candidate) ||\n      candidate < 0\n    );\n\n  }\n\n  isThresholdMet(threshold, viewportWidth) {\n    return viewportWidth >= threshold;\n  }\n\n  resizeHandler() {\n    if (this.isThresholdMet(this.thresholdWidth, this.window.innerWidth)) {\n      this.window.removeEventListener('resize', this.resizeHandler.bind(this));\n      this.init();\n    }\n  }\n\n  setupEventHandlers($elm, setLightBackground, setDarkBackground) {\n    if ($elm.getAttribute('data-invert-bgcol-on-hover') !== null) {\n      $elm.addEventListener('mouseenter', setLightBackground);\n      $elm.addEventListener('mouseleave', setDarkBackground);\n    }\n  }\n\n  setDarkBackground() {\n    if (!!this.sourceToUse) {\n      this.$elm.style.backgroundImage = this.getBackgroundImagesString(this.sourceToUse,\n                      'linear-gradient(to top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5))');\n      this.$elm.style.color = '#fff';\n    }\n  }\n\n  setLightBackground() {\n    if (!!this.sourceToUse) {\n      this.$elm.style.backgroundImage = this.getBackgroundImagesString(this.sourceToUse,\n                     'linear-gradient(to top, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5))');\n      this.$elm.style.color = '#212121';\n    }\n  }\n\n  getBackgroundImagesString(path, grandient) {\n    if (!path || !path.length || path.length === 0) {\n      return '';\n    }\n\n    return grandient + ', url(' + path + ')';\n  }\n\n  calcSourceToUse(sourceDefiner, isHighDpr) {\n    var lowResSource = '';\n    var highResSource = '';\n    if (!sourceDefiner) {\n      return '';\n    }\n\n    if (!!sourceDefiner.dataset) {\n      highResSource = sourceDefiner.dataset.highResImageSource;\n      lowResSource = sourceDefiner.dataset.lowResImageSource;\n    } else {\n      highResSource = sourceDefiner.getAttribute('data-highResImageSource');\n      lowResSource = sourceDefiner.getAttribute('data-lowResImageSource');\n    }\n\n    if (isHighDpr && !highResSource || !isHighDpr && !lowResSource) {\n      return '';\n    }\n\n    if (isHighDpr) {\n      return highResSource;\n    }\n\n    return lowResSource;\n  }\n\n};\n","'use strict';\n\nconst utils = require('../libs/elife-utils')();\n\nmodule.exports = class Carousel {\n\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n\n    this.moveableStage = this.$elm.querySelector('.carousel__items');\n    this.originalSlideWrappers = this.moveableStage.querySelectorAll('.carousel-item');\n    this.originalSlideCount = this.originalSlideWrappers.length;\n    this.currentSlideCount = this.originalSlideCount;\n\n    if (this.originalSlideCount < 2) {\n      return;\n    }\n\n    this.init();\n\n  }\n\n  init() {\n    this.currentSlide = 1;\n    this.timerInterval = 10000;\n\n    this.$elm.querySelector('.carousel__heading').classList.add('visuallyhidden');\n    this.updateButtonAppearance();\n    this.$elm.appendChild(this.buildVisibleControls());\n    this.$toggler = this.buildControl$toggle();\n    this.$elm.insertBefore(this.$toggler, this.$elm.querySelector('.carousel__items'));\n    this.updateWidth();\n    this.updateControlPanel(this.currentSlide);\n    this.togglePlay(this.$toggler);\n    this.$toggler.focus();\n\n    this.window.addEventListener('keydown', this.handleKey.bind(this));\n    this.window.addEventListener('blur', this.cancelTimer.bind(this));\n    this.window.addEventListener('focus', this.setupTimer.bind(this));\n    this.window.addEventListener('resize', () => {\n      this.updateWidth();\n      this.adjustTranslateForResize();\n    });\n    this.makeSingleSlideATVisible(this.currentSlide);\n  }\n\n  updateButtonAppearance () {\n    let buttons = this.$elm.querySelectorAll('.carousel-item__cta .button');\n    buttons.forEach((button) => {\n      button.classList.add('button--outline');\n    });\n\n  }\n\n  atHide($node) {\n    $node.setAttribute('tabindex', -1);\n    $node.setAttribute('aria-hidden', true);\n  }\n\n  atShow($node) {\n    $node.removeAttribute('tabindex', -1);\n    $node.removeAttribute('aria-hidden', true);\n  }\n\n  setATVisibility($root, show) {\n    let action;\n    if (show) {\n      action = this.atShow;\n    } else {\n      action = this.atHide;\n    }\n\n    action.call(this, $root);\n    [].forEach.call($root.childNodes, ($descendant) => {\n      if ($descendant.nodeType === $descendant.ELEMENT_NODE) {\n        action.call(this, $descendant);\n        if ($descendant.hasChildNodes())  {\n          this.setATVisibility($descendant, show);\n        }\n      }\n    });\n  }\n\n  makeSingleSlideATVisible(slideNumber) {\n    [].forEach.call(this.moveableStage.querySelectorAll('.carousel-item'), ($el) => {\n      this.setATVisibility($el, false);\n    });\n    let _slideNumber = slideNumber || 1;\n    let slide = this.$elm.querySelectorAll('.carousel-item__inner')[_slideNumber - 1];\n    this.setATVisibility(slide, true);\n    slide.focus();\n  }\n\n  /**\n   * Builds and returns all controls for the carousel\n   *\n   * @returns {Element} The control panel\n   */\n  buildVisibleControls() {\n    // Btn wrappers needed to reserve space in case buttons are removed, to stop things moving about\n    let $previousWrapper = this.buildControl$traverser('previous');\n    let $nextWrapper = this.buildControl$traverser('next');\n\n    this.buttons = {\n      previous: $previousWrapper.querySelector('button'),\n      next: $nextWrapper.querySelector('button')\n    };\n\n    // switches are the circular buttons for depicting/going to a slide\n    this.switches = this.buildControl$switches(this.originalSlideCount);\n\n    let $controlPanel = utils.buildElement('div', ['carousel__control_panel']);\n    let $visibleControlsWrapper = utils.buildElement('div', ['carousel__control_panel__visible']);\n    let visibleControls = [$previousWrapper, this.switches, $nextWrapper];\n    visibleControls.forEach(function (control) {\n      $visibleControlsWrapper.appendChild(control);\n    });\n\n    $controlPanel.appendChild($visibleControlsWrapper);\n\n    return $controlPanel;\n  }\n\n  /**\n   * Returns a div-wrapped button for a next or previous control, with event listener\n   *\n   * @param {String} direction 'previous' | 'next'\n   * @returns {Element} A div-wrapped button\n   */\n  buildControl$traverser(direction) {\n    let _direction = direction === 'previous' ? 'previous' : 'next';\n    let text = direction + ' item';\n    let $wrapper = utils.buildElement('div', ['carousel__control_wrapper']);\n    let $button = utils.buildElement('button',\n                                     ['carousel__control',\n                                      'carousel__control--traverse',\n                                      'carousel__control--' + _direction\n                                     ],\n                                     '',\n                                     $wrapper);\n    $button.addEventListener('click', () => {\n      this.userInitiatedProgression(this[_direction]);\n    });\n\n    utils.buildElement('span', ['visuallyhidden'], text, $button);\n    return $wrapper;\n  }\n\n  /**\n   * Builds and returns a visually hidden play/pause toggle (button & label), with event listener\n   *\n   * @returns {Element} The toggler\n   */\n  buildControl$toggle() {\n    let $button = utils.buildElement('button', ['carousel__control--toggler', 'visuallyhidden'],\n                                     'Play carousel');\n    $button.setAttribute('aria-label', 'The carousel is now paused. Play carousel');\n    $button.addEventListener('click', () => {\n      this.togglePlay($button);\n    });\n    return $button;\n  }\n\n  /**\n   * Builds and returns a list of switches, with event listener attached\n   *\n   * @param quantity The number of switches to build\n   * @returns {Element} The list of switches\n   */\n  buildControl$switches(quantity) {\n    let $switches = utils.buildElement('ol', ['carousel__control_switches']);\n    for (let i = 1; i <= quantity; i += 1) {\n      $switches.appendChild(this.buildControl$switch('Go to item ' + i + ' of ' +\n                                                     this.originalSlideCount, i));\n    }\n\n    $switches.addEventListener('click', this.activateSwitch.bind(this));\n    return $switches;\n  }\n\n  /**\n   * Builds and returns a switch\n   * @param text The next for the switch (visually hidden)\n   * @returns {Element} The switch\n   */\n  buildControl$switch(text, index) {\n    let $item = utils.buildElement('li', ['carousel__control--switch-item']);\n    let $button =  utils.buildElement('button',\n                                      [\n                                        'carousel__control',\n                                        'carousel__control--switch'\n                                      ],\n                                      '',\n                                      $item);\n    let $switch = utils.buildElement('span', ['visuallyhidden'], '' + index, $button);\n    $switch.setAttribute('aria-label', text);\n    return $item;\n  }\n\n  /**\n   * Toggles the play/pause state of the carousel based on the current value of the toggle button.\n   *\n   * @param $button The toggler\n   */\n  togglePlay($button) {\n    let currentButtonState = $button.innerHTML;\n    if (currentButtonState === 'Pause carousel') {\n      $button.innerHTML = 'Play carousel';\n      $button.setAttribute('aria-label', 'The carousel is now paused. Play carousel');\n      this.timerStopped = true;\n      this.cancelTimer();\n    } else {\n      $button.innerHTML = 'Pause carousel';\n      $button.setAttribute('aria-label', 'The carousel is now playing. Pause carousel');\n      this.timerStopped = false;\n      this.setupTimer();\n    }\n  }\n\n  cancelTimer() {\n    this.window.clearInterval(this.timer);\n  }\n\n  setupTimer() {\n    // make sure old timer stopped before starting a new one\n    this.cancelTimer();\n\n    // Indicates whether timer should run at all on this carousel (hard stop, not pause).\n    this.timerStopped = false;\n    this.timer = this.startNewAdvancementTimer(this.timerInterval);\n\n    // mousing over the carousel cancels the timer\n    this.$elm.addEventListener('mouseenter', this.cancelTimer.bind(this));\n\n    // mouse out from the carousel resets the timer\n    this.$elm.addEventListener('mouseleave', () => {\n      this.cancelTimer();\n      if (!this.timerStopped) {\n        this.timer = this.startNewAdvancementTimer(this.timerInterval);\n      }\n    });\n  }\n\n  startNewAdvancementTimer(intervalInMs) {\n    return this.window.setInterval(() => {\n      if (!this.timerStopped) {\n        this.next();\n      }\n    }, intervalInMs);\n  }\n\n  handleKey(e) {\n    let code = e.keyCode || e.charCode;\n    if (code === 37/*left arrow*/ || code === 39/*right arrow*/) {\n      this.timerStopped = true;\n      if (code === 37) {\n        this.userInitiatedProgression(this.previous);\n      } else {\n        this.userInitiatedProgression(this.next);\n      }\n    }\n  }\n\n  userInitiatedProgression(callback) {\n    // Any user-activation of a control permanently stops the timer\n    this.timerStopped = true;\n    if (!!callback && typeof callback === 'function') {\n      callback.call(this, true);\n    }\n  }\n\n  next() {\n    if (this.currentSlide % this.originalSlideCount === 0) {\n      this.extendStage();\n    }\n\n    this.updateSlide();\n    this.updateControlPanel(this.currentSlide);\n  }\n\n  previous() {\n    if (this.currentSlide > 1) {\n      this.updateSlide('previous');\n      this.updateControlPanel(this.currentSlide);\n    }\n  }\n\n  extendStage () {\n    // Make room for another slide set\n    this.currentSlideCount += this.originalSlideCount;\n    this.updateWidth();\n\n    // Clone in the new slide set\n    [].forEach.call(this.originalSlideWrappers, (slide) => {\n      this.moveableStage.appendChild(slide.cloneNode(true));\n    });\n  }\n\n  /**\n   * Translates moveableStage 1 slide's width in the appropriate direction\n   * @param {String} direction 'next' | 'previous' Direction to move\n   */\n  updateSlide(direction) {\n    let currentOffset = this.getCurrentOffset();\n    let currentWidthStringMatch = this.window.getComputedStyle(this.$elm).width\n                                      .match(/^([0-9]+)px/);\n    let currentCarouselWidth = this.window.parseInt(currentWidthStringMatch[1], 10);\n    let newOffset;\n    if (direction === 'previous') {\n      this.currentSlide -= 1;\n      newOffset = currentOffset + currentCarouselWidth;\n    } else {\n      this.currentSlide += 1;\n      newOffset = currentOffset - currentCarouselWidth;\n    }\n\n    utils.updateElementTranslate(this.moveableStage, [newOffset + 'px', 0]);\n  }\n\n  /**\n   * Returns the current numerical value of moveableStage's X translation in px\n   *\n   * @returns {number} Numerical value of the X translation of moveableStage\n   */\n  getCurrentOffset() {\n    let offsetStringMatch = this.moveableStage.style.transform.match(/translate\\((.*)px,[^)]+\\)/);\n    if (!offsetStringMatch) {\n      return 0;\n    }\n\n    return this.window.parseInt(offsetStringMatch[1], 10);\n  }\n\n  updateControlPanel(currentSlide) {\n    this.hideInvalidButtonChoice(currentSlide);\n    this.updateActiveSwitch(currentSlide);\n  }\n\n  /**\n   * Hides previous button if on first slide.\n   *\n   * @param {number} currentSlide The number of the current slide\n   */\n  hideInvalidButtonChoice(currentSlide) {\n    this.buttons.previous.classList.remove('hidden');\n    this.buttons.next.classList.remove('hidden');\n    let logicalSlideNumber = this.getLogicalSlideNumber(currentSlide);\n    if (logicalSlideNumber === 1) {\n      this.buttons.previous.classList.add('hidden');\n    } else if (logicalSlideNumber === this.originalSlideCount) {\n      this.buttons.next.classList.add('hidden');\n    }\n  }\n\n  /**\n   * Activate the switch indicating the current logical slide\n   *\n   * @param {number} currentSlide The number of the current slide\n   */\n  updateActiveSwitch(currentSlide) {\n    let currentLogicalSlide = this.getLogicalSlideNumber(currentSlide);\n    [].forEach.call(this.switches.querySelectorAll('.carousel__control--switch'), (aSwitch, i) => {\n      if (i === currentLogicalSlide - 1) {\n        aSwitch.classList.add('active');\n      } else {\n        aSwitch.classList.remove('active');\n      }\n    });\n  }\n\n  /**\n   * Returns the number of the side within its set.\n   *\n   * E.g. where there's 3 slides in a set, and the actualSlideNumber is 8, this indicates that it's\n   * the 2nd slide in the 3rd slide set, so its logical number is 2.\n   * (A slide set is a clone of the starting slides to facilitate perpetual scroll.)\n   *\n   * @param {number} actualSlideNumber Number of the slide to evaluate\n   * @returns {number}\n   */\n  getLogicalSlideNumber(actualSlideNumber) {\n    let setSize = this.originalSlideCount;\n    let slideSetOfSlide = Math.ceil(actualSlideNumber / setSize);\n    let firstSlideOfSet = setSize *  slideSetOfSlide - (setSize - 1);\n    return actualSlideNumber - firstSlideOfSet + 1;\n  }\n\n  /**\n   * Move to the closest slide with the same logical number as the activated switch\n   *\n   * @param {Event} e The event\n   */\n  activateSwitch(e) {\n    let logicalSlideRequested = this.window.parseInt(e.target.querySelector('span').innerHTML, 10);\n    let logicalSlideCurrent = this.getLogicalSlideNumber(this.currentSlide);\n    let slideOffset = logicalSlideRequested - logicalSlideCurrent;\n\n    if (logicalSlideRequested === logicalSlideCurrent) {\n      return;\n    }\n\n    let callback = slideOffset < 0 ? this.previous : this.next;\n\n    for (let i = 0; i < Math.abs(slideOffset); i += 1) {\n      this.userInitiatedProgression(callback);\n    }\n  }\n\n  adjustTranslateForResize() {\n    let carouselWidth = window.getComputedStyle(this.$elm).width.match(/([0-9]+)px/)[1];\n    let currentSlide = this.currentSlide;\n    let expectedOffset = (currentSlide - 1) * carouselWidth * -1;\n    this.moveableStage.style.transform = 'translate(' + expectedOffset + 'px, 0)';\n  }\n\n  updateWidth() {\n    this.moveableStage.style.width = utils.adjustPxString(\n      this.window.getComputedStyle(this.$elm).width,\n      this.currentSlideCount,\n      'multiply');\n  }\n\n};\n","'use strict';\n\nmodule.exports = class ContentHeaderArticle {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n    this.$elm.classList.add('content-header-article--js');\n\n    // Should track SASS variable $bkpt-content-header--medium-width.\n    this.breakpointInPx = 768;\n    this.currentView = this.calcCurrentView(this.breakpointInPx);\n\n    this.authors = $elm.querySelectorAll('.content-header__author_list_item');\n    this.institutions = $elm.querySelectorAll('.content-header__institution_list_item');\n\n    this.hasToggleAuthor = false;\n    this.hasToggleInstitution = false;\n    this.hideAllExcessItems('author', this.authors);\n    this.hideAllExcessItems('institution', this.institutions);\n\n    let _this = this;\n    this.window.addEventListener('resize', () => {\n      let newView = _this.calcCurrentView(_this.breakpointInPx);\n      if (newView !== _this.currentView) {\n        _this.currentView = newView;\n        _this.handleAnyExcessItems('author', _this.authors);\n        _this.handleAnyExcessItems('institution', _this.institutions);\n      }\n    });\n\n  }\n\n  handleAnyExcessItems(itemType, items) {\n    let toggle = this.$elm.querySelector('.content-header__item_toggle');\n    if (toggle && toggle.innerHTML.indexOf('less') > -1 && this.currentView === 'wide') {\n      this.clearExcessMark(items);\n      this.toggleExcessItems(items);\n    } else {\n      this.clearExcessMark(items);\n      let excessItems = this.getExcessItems(itemType, items);\n      this.markAsExcess(excessItems);\n      this.toggleExcessItems(items);\n      this.markLastNonExcessItem(itemType, items);\n    }\n  }\n\n  /**\n   * Determine excess by itemType from items supplied and hides those.\n   *\n   * @param {string} itemType 'author' or 'institution'\n   * @param {DOMTokenList} items List of items to identify the excess within, and hide those\n   */\n  hideAllExcessItems(itemType, items) {\n    let excessItems = this.getExcessItems(itemType, items);\n    this.markAsExcess(excessItems);\n    this.toggleExcessItems(items);\n    this.addTrailingText(itemType, items);\n  }\n\n  /**\n   * Returns max number authors or institutions to be displayed by default at current screen width.\n   *\n   * Returns null if itemType is invalid.\n   *\n   * @param {string} itemType 'author' or 'institution'\n   * @returns {number|null} Number of the type of item to display by default at current screen width\n   */\n  getDefaultMaxItems(itemType) {\n    if (this.currentView === 'wide') {\n      if (itemType === 'author') {\n        return 16;\n      }\n\n      if (itemType === 'institution') {\n        return 10;\n      }\n\n    } else {\n      if (itemType === 'author') {\n        return 1;\n      }\n\n      if (itemType === 'institution') {\n        return 0;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Returns array of elements in excess of the default max items, or null if itemType invalid.\n   *\n   * The returned array is a subset of the list supplied, or empty if there are no excess items.\n   *\n   * @param {string} itemType 'author' or 'institution'\n   * @param {DOMTokenList} items List of items from which to identify the excess\n   * @returns {Array|null} Items in excess of the default maximum for the current screen width\n   */\n  getExcessItems(itemType, items) {\n    if (itemType !== 'author' && itemType !== 'institution') {\n      return null;\n    }\n\n    let defaultMaxItems = this.getDefaultMaxItems(itemType);\n    if (items.length > defaultMaxItems) {\n      return [].slice.call(items, defaultMaxItems);\n    }\n\n    return [];\n  }\n\n  /**\n   * Marks supplied list elements as excess.\n   *\n   * @param {Array} els The elements to mark as excess\n   */\n  markAsExcess(els) {\n    els.forEach(function ($el) {\n      $el.classList.add('excess-item');\n    });\n  }\n\n  /**\n   * Clears any excess mark from all elements in the supplied list.\n   *\n   * @param {DOMTokenList} els The elements to clear the excess mark from\n   */\n  clearExcessMark(els) {\n    [].forEach.call(els, function ($el) {\n      $el.classList.remove('excess-item');\n    });\n  }\n\n  /**\n   * Toggles the display of any excess items found in the supplied list of elements.\n\n   * @param {DOMTokenList} items The elements to inspect for excess items, and to toggle those found\n   */\n  toggleExcessItems(items) {\n    [].forEach.call(items, function (item) {\n      if (item.classList.contains('excess-item')) {\n        item.classList.add('visuallyhidden');\n      } else {\n        item.classList.remove('visuallyhidden');\n      }\n    });\n  }\n\n  /**\n   * Returns the name of the current view.\n   *\n   * @param {number} breakpoint The px viewport width that determines the view.\n   *\n   * @returns {string} the view name ('wide' or 'narrow').\n   */\n  calcCurrentView(breakpoint) {\n    return this.window.matchMedia('(min-width: ' + breakpoint + 'px)').matches ? 'wide' : 'narrow';\n  }\n\n  /**\n   * Marks the last shown non-excess item with particlular class (so not if showing last in list).\n   *\n   * @param {string} itemType 'author' or 'institution'\n   * @param {DOMTokenList} items List of items to act upon\n   */\n  markLastNonExcessItem(itemType, items) {\n    let lastShownIndex = null;\n    let foundLastShown = false;\n    [].forEach.call(items, function (item, i) {\n\n      // Clear old any obsolete determination of what's the last non-excess item.\n      items[i].classList.remove('content-header__' + itemType + '--last-non-excess');\n      if (item.classList.contains('excess-item') && !foundLastShown) {\n        lastShownIndex = i - 1;\n        foundLastShown = true;\n      }\n    });\n\n    if (lastShownIndex !== null && lastShownIndex > -1) {\n      let lastShown = items[lastShownIndex].querySelector('.content-header__' + itemType);\n      if (lastShown) {\n        lastShown.classList.add('content-header__' + itemType + '--last-non-excess');\n      }\n    }\n\n  }\n\n  /**\n   * Adds trailing text to the visible end of truncated author & institution lists & builds toggle.\n   *\n   * @param {string} itemType The type of items supplied\n   * @param {DOMTokenList} items The items to which to add the trailing text\n   */\n  addTrailingText(itemType, items) {\n    if (itemType === 'author' && items.length > this.getDefaultMaxItems('author')) {\n      if (!this.hasToggleAuthor) {\n        this.buildSeeMoreLessToggle('author');\n        this.hasToggleAuthor = true;\n      }\n\n    }\n\n    if (itemType === 'institution' && items.length > this.getDefaultMaxItems('institution')) {\n      if (!this.hasToggleInstitution) {\n        this.buildSeeMoreLessToggle('institution');\n        this.hasToggleInstitution = true;\n      }\n\n    }\n\n    this.markLastNonExcessItem(itemType, items);\n  }\n\n  /**\n   * Builds the show/hide toggle for excess authors & institutions.\n   */\n  buildSeeMoreLessToggle(itemType) {\n    // This toggle only required due to screen width constraints. All content already accessible as\n    // it's not being hidden in the first place. Hence an aria-hidden li, rather than an anchor.\n    // Should conform to https://www.w3.org/TR/wai-aria/states_and_properties#aria-hidden\n    let toggle = this.doc.createElement('li');\n    let toggleOnText = 'see&nbsp;all';\n    let toggleOffText = 'see&nbsp;less';\n    toggle.setAttribute('aria-hidden', 'true');\n    toggle.classList.add('content-header__item_toggle', 'content-header__item_toggle--' + itemType);\n    toggle.innerHTML = '&nbsp;&hellip;&nbsp;' + toggleOnText;\n    toggle.addEventListener('click', e => {\n      let target = e.target;\n      if (target.innerHTML.indexOf(toggleOnText) > -1) {\n        [].forEach.call(this.doc.querySelectorAll('.content-header__item_toggle'), item => {\n          item.innerHTML = '&nbsp;' + toggleOffText;\n        });\n        this.clearExcessMark(this.authors);\n        this.clearExcessMark(this.institutions);\n        this.toggleExcessItems(this.authors);\n        this.toggleExcessItems(this.institutions);\n      } else {\n        [].forEach.call(this.doc.querySelectorAll('.content-header__item_toggle'), item => {\n          item.innerHTML = '&nbsp;&hellip;&nbsp;' + toggleOnText;\n        });\n        this.hideAllExcessItems('author', this.authors);\n        this.hideAllExcessItems('institution', this.institutions);\n      }\n    });\n    this.$elm.querySelector('.content-header__' + itemType + '_list').appendChild(toggle);\n  }\n\n};\n","'use strict';\n\nconst utils = require('../libs/elife-utils')();\n\n/**\n * FragmentHandler mediates how the hash controls the opening of article sections.\n * It has no dedicated pattern template and its data-behaviour may live on any element, but note\n * that because it's a singleton only one will be instansiated.\n * @type {FragmentHandler}\n */\nmodule.exports = class FragmentHandler {\n\n  static isSingleton()  {\n    return true;\n  }\n\n  constructor($elm, _window = window, doc = document) {\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n    this.window.addEventListener('DOMContentLoaded', this.handleDomLoad.bind(this));\n  }\n\n  handleDomLoad(e) {\n    this.handleSectionOpeningViaHash(e);\n    this.window.addEventListener('hashchange', this.handleSectionOpeningViaHash.bind(this));\n  }\n\n  /**\n   * Indicates whether an HTML element with a given id is found as/within a specific chunk of html\n   *\n   * @param {String} id The id  of the HTML element to search for\n   * @param {HTMLElement} $section The element to search/search within\n   * @param {HTMLDocument} doc\n   * @param {Function} areElementsNested Handles determination of nesting\n   * @returns {boolean} true if element with id is $section, or is contained within $section\n   */\n  isIdOfOrWithinSection(id, $section, doc, areElementsNested) {\n    if (id === $section.id) {\n      return true;\n    }\n\n    let $fragWithId = doc.querySelector('#' + id);\n    return areElementsNested($section, $fragWithId);\n  }\n\n  /**\n   * Returns the id of the collapsed section containing the html element with idToFind, or null.\n   *\n   * @param {String} idToFind The id to search for\n   * @param {HTMLDocument} doc\n   * @param {Function} areElementsNested Handles determination of nesting\n   * @returns {String} The id of the collapsed section containing idToFind, or null\n   */\n  getIdOfCollapsedSection(idToFind, doc, areElementsNested) {\n    let collapsedSections = doc.querySelectorAll('.article-section--collapsed');\n    if (!collapsedSections) {\n      return null;\n    }\n\n    let $collapsedSectionContainingFrag;\n    [].forEach.call(collapsedSections, ($collapsedSection) => {\n      if (!$collapsedSectionContainingFrag) {\n        if (this.isIdOfOrWithinSection(idToFind, $collapsedSection, doc, areElementsNested)) {\n          $collapsedSectionContainingFrag = $collapsedSection;\n        }\n      }\n    });\n\n    if (!!$collapsedSectionContainingFrag) {\n      return $collapsedSectionContainingFrag.id;\n    }\n\n    return null;\n  }\n\n  /**\n   * Fires a custom expandsection event on the collapsed article section containing id from hash.\n   *\n   * @param e\n   * @returns {boolean} False if no hash found\n   */\n  handleSectionOpeningViaHash(e) {\n\n    // TODO: Code similar to that in Audioplayer.seekNewTime(), refactor out into common\n    let hash = '';\n\n    // event was hashChange\n    if (!!e.newURL) {\n      hash = e.newURL.substring(e.newURL.indexOf('#') + 1);\n    } else {\n      hash = this.window.location.hash.substring(1);\n    }\n\n    if (!hash) {\n      return false;\n    }\n\n    let idOfCollapsedSection = this.getIdOfCollapsedSection(hash, this.doc,\n                                                            utils.areElementsNested);\n    if (!!idOfCollapsedSection) {\n      // emit a section open event with the id of the section to open\n      // TODO: Used in several places, refactor out into common\n      let expandSection;\n      try {\n        expandSection = new CustomEvent('expandsection', { detail: hash });\n      } catch (e) {\n        // CustomEvent not supported, do it the old fashioned way\n        expandSection = document.createEvent('expandsection');\n        expandSection.initCustomEvent('expandsection', true, true, { detail: hash });\n      }\n\n      this.doc.querySelector('#' + idOfCollapsedSection).dispatchEvent(expandSection);\n\n    }\n  }\n};\n","'use strict';\n\nmodule.exports = class MainMenu {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n  }\n\n  /**\n   * Moves main menu from default non-js DOM position into position required by js implementation.\n   */\n  moveWithinDom() {\n    this.$elm.classList.add('main-menu--js');\n    let $globalWrapper = this.doc.querySelector('.global-wrapper');\n    if (!!$globalWrapper) {\n      $globalWrapper.insertBefore(this.$elm, $globalWrapper.firstElementChild);\n    }\n  }\n\n  /**\n   * Indicates whether the main menu is currently open.\n   *\n   * @returns {boolean} true if the main menu is currently open\n   */\n  isOpen() {\n    return this.$elm.classList.contains('main-menu--shown');\n  }\n\n  /**\n   * Closes the main menu\n   */\n  close () {\n    this.$elm.classList.remove('main-menu--shown');\n    this.doc.querySelector('.global-wrapper').classList.remove('pull-offscreen-right');\n  }\n\n  /**\n   * Opens the main menu\n   */\n  open () {\n    this.$elm.classList.add('main-menu--shown');\n    this.doc.querySelector('.global-wrapper').classList.add('pull-offscreen-right');\n  }\n\n};\n","'use strict';\n\nmodule.exports = class Math {\n\n  constructor($elm, _window = window, doc = document) {\n    this.window = _window;\n    Math.loadDependencies(doc);\n  }\n\n  static loadDependencies(doc) {\n    if (!Math.dependenciesAlreadySetup(doc)) {\n      Math.setupProperties();\n      Math.load(doc);\n    }\n  }\n\n  static dependenciesAlreadySetup(doc) {\n    return !!doc.querySelector('script[src*=\"mathjax\"]');\n  }\n\n  static setupProperties() {\n    window.MathJax = {\n      'HTML-CSS': {\n        linebreaks: { automatic: true, width: '75% container' }\n      },\n      SVG: {\n        linebreaks: { automatic: true, width: '75% container' }\n      }\n    };\n  }\n\n  static setupResizeHandler() {\n    let resizeTimeout;\n    let resizeThrottler = function resizeThrottler() {\n      if (!resizeTimeout) {\n        resizeTimeout = setTimeout(function () {\n          resizeTimeout = null;\n\n          // TODO: change so exactly one rerender regardless of number of Math instances.\n          // Consider tacking at the same time as fragment handler.\n          if (!!this.window.MathJax) {\n            this.window.MathJax.Hub.Queue(['Rerender', this.window.MathJax.Hub]);\n          }\n        }, 300);\n      }\n    };\n\n    window.addEventListener('resize', resizeThrottler);\n  }\n\n  static load(doc) {\n    let script = doc.createElement('script');\n    script.type = 'text/javascript';\n    script.addEventListener('load', Math.setupResizeHandler);\n    script.src  = 'https://cdn.mathjax.org/mathjax/2.7-latest/MathJax.js?config=MML_HTMLorMML';\n    doc.querySelector('body').appendChild(script);\n  }\n\n};\n","'use strict';\nmodule.exports = class MediaChapterListingItem {\n\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      console.warn('No element provided');\n      return;\n    }\n\n    console.log('Initialising Chapter listing item...');\n\n    this.$elm = $elm;\n    this.startTime = $elm.dataset.startTime;\n    if (!this.startTime || isNaN(this.startTime) || this.startTime < 0) {\n      return;\n    }\n\n    this.window = _window;\n    this.document = doc;\n\n    // When ready, AudioPlayer dispatches a custom event 'playerReady' on window, that supplies that\n    // player's html element id.\n    _window.addEventListener('playerReady', this.listenForChapterChange.bind(this));\n    this.$link = this.createLink(doc, this.$elm, this.startTime);\n    this.setupEventHandlers(this.$link);\n\n  }\n\n  listenForChapterChange (e) {\n    let $player = this.document.querySelector('#' + e.detail);\n    if (!!$player) {\n      $player.addEventListener('chapterChanged', this.indicateChapterChanged.bind(this));\n    }\n  }\n\n  createLink(document, $rootElm, startTime) {\n    let $title = $rootElm.querySelector('.teaser__header_text');\n    if (!$title) {\n      return;\n    }\n\n    let titleText;\n    let $existingLink;\n    try {\n      $existingLink = $title.querySelector('.teaser__header_text_link');\n      titleText = $existingLink.innerHTML;\n      $existingLink.parentNode.removeChild($existingLink);\n    } catch (e) {\n      titleText = $title.innerHTML;\n    }\n\n    let $link = document.createElement('a');\n    $link.innerHTML = titleText;\n    $link.setAttribute('href', '#' + startTime);\n    $link.classList.add('teaser__header_text_link');\n    $title.innerHTML = '';\n    $title.appendChild($link);\n    return $link;\n  }\n\n  indicateChapterChanged(e) {\n    let currentChapterNumber = e.detail;\n    if (currentChapterNumber === this.window.parseInt(this.$elm.dataset.chapterNumber)) {\n      this.$elm.classList.add('current-chapter');\n    } else {\n      this.$elm.classList.remove('current-chapter');\n    }\n  }\n\n  setupEventHandlers($link) {\n    $link.addEventListener('chapterChanged', this.indicateChapterChanged);\n  }\n\n};\n","'use strict';\n\nconst utils = require('../libs/elife-utils')();\n\nmodule.exports = class Pager {\n\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n\n    this.$targetEl = this.find$targetEl();\n    this.$loader = this.find$Loader();\n    if (!(this.$loader && this.$targetEl)) {\n      return;\n    }\n\n    this.isCurrentlyLoading = false;\n    this.timeoutThresholdInMs = 10000;\n    this.$loader.addEventListener('click', this.handleLoadRequest.bind(this));\n  }\n\n  static normaliseData(data) {\n    let dataNoLeadingWhitespace = data.replace(/^\\s+([^\\s])/gm, '$1');\n    return dataNoLeadingWhitespace.replace(/\\n/g, '');\n  }\n\n  injectNewData(newData) {\n    let normalisedData = Pager.normaliseData(newData);\n    let regex =\n      /.*<ol[^>]*class=\"[^\"]*(grid-listing|listing-list)[^\"]*\"[^>]*>(<li>?.*<\\/li>)<\\/ol>.*/;\n    let match = normalisedData.match(regex);\n\n    if (!(match && match[2])) {\n      throw new SyntaxError('Loaded data doesn\\'t match required format');\n    }\n\n    let data = match[2];\n    let frag = this.doc.createDocumentFragment();\n    let $temp = this.doc.createElement('div');\n    $temp.innerHTML = data;\n    while ($temp.firstElementChild) {\n      let child = $temp.firstElementChild;\n      frag.appendChild(child);\n    }\n\n    this.$targetEl.appendChild(frag);\n  }\n\n  redirectToFullResultsPage() {\n    let loaderLink = this.getValidLoaderLink();\n    if (loaderLink) {\n      this.window.location.search = loaderLink;\n    }\n  }\n\n  handleError () {\n    this.redirectToFullResultsPage();\n  }\n\n  getValidLoaderLink() {\n    let match = this.$loader.href.match(/\\?page=([0-9]+)/);\n    if (match) {\n      return match[0];\n    }\n  }\n\n  getPageNumberFromLoaderLink() {\n    let loaderLink = this.getValidLoaderLink();\n    if (loaderLink) {\n      let pageNumber = loaderLink.match(/\\?page=([0-9]+)/)[1];\n      return this.window.parseInt(pageNumber, 10);\n    }\n  }\n\n  static isLastPage(data) {\n    return !data.match(/class=\"pager\".*button--default.*button--default/g);\n  }\n\n  setLoadingState () {\n    this.isCurrentlyLoading = true;\n    this.$loader.classList.add('button--inactive');\n    let $pagerTextWrapper = this.$loader.querySelector('.pager__text_wrapper');\n    if ($pagerTextWrapper) {\n      $pagerTextWrapper.innerHTML = 'Loading...';\n      $pagerTextWrapper.classList.add('loading');\n    }\n\n    // If the loading takes longer than timeoutThresholdInMs, try to go to the full results page.\n    this.loadingTimer = this.window.setTimeout(() => {\n      this.redirectToFullResultsPage();\n    }, this.timeoutThresholdInMs);\n  }\n\n  clearLoadingState () {\n    this.window.clearTimeout(this.loadingTimer);\n    this.isCurrentlyLoading = false;\n    let $pagerTextWrapper = this.$loader.querySelector('.pager__text_wrapper');\n    if ($pagerTextWrapper) {\n      $pagerTextWrapper.classList.remove('loading');\n      $pagerTextWrapper.innerHTML = !!this.$loader.originalText ? this.$loader.originalText\n                                                              : 'Load more';\n    }\n\n    this.$loader.classList.remove('button--inactive');\n  }\n\n  updatePager(data) {\n    if (Pager.isLastPage(data)) {\n      this.$loader.parentNode.removeChild(this.$loader);\n    } else {\n      let pageNumber = this.getPageNumberFromLoaderLink();\n      if (!isNaN(pageNumber)) {\n        pageNumber += 1;\n        this.$loader.href = '?page=' + pageNumber;\n      }\n    }\n  }\n\n  updateUrl () {\n    let validLoaderLink = this.getValidLoaderLink();\n    if (validLoaderLink) {\n      this.window.history.pushState(null, '', validLoaderLink);\n    }\n  }\n\n  handleLoad(data) {\n    let normalisedData;\n    try {\n      normalisedData = Pager.normaliseData(data);\n      this.injectNewData(normalisedData);\n    } catch (e) {\n      this.handleError(e);\n      return;\n    }\n\n    this.clearLoadingState();\n    this.updateUrl();\n    this.updatePager(normalisedData);\n  }\n\n  handleLoadRequest(e) {\n    e.preventDefault();\n\n    if (this.isCurrentlyLoading) {\n      return;\n    }\n\n    let pageNum = this.getPageNumberFromLoaderLink();\n    this.loadNextPageData('?page=' + pageNum, this.window.XMLHttpRequest)\n        .then(this.handleLoad.bind(this), this.handleError.bind(this));\n    this.setLoadingState();\n  }\n\n  loadNextPageData(url, XMLHttpRequest) {\n\n    return new Promise(\n      function resolver(resolve, reject) {\n        let xhr = new XMLHttpRequest();\n        xhr.addEventListener('load', () => {\n          resolve(xhr.responseText);\n        });\n        xhr.addEventListener('error', reject);\n        xhr.open('GET', url);\n        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n        xhr.send();\n      }\n    );\n\n  }\n\n  find$Loader() {\n    let $loader = this.$elm.querySelector('.button--full:first-child.button--full:last-child');\n    if (!$loader) {\n      return;\n    }\n\n    $loader.id = utils.uniqueIds.get('pager', this.doc);\n    $loader.originalText = $loader.innerHTML;\n    let $loaderTextWrapper = this.doc.createElement('span');\n    $loaderTextWrapper.classList.add('pager__text_wrapper');\n    $loaderTextWrapper.innerHTML = $loader.originalText;\n    $loader.replaceChild($loaderTextWrapper, $loader.firstChild);\n\n    return $loader;\n  }\n\n  find$targetEl() {\n    return this.doc.querySelector('#' + this.$elm.dataset.targetid);\n  }\n\n};\n","'use strict';\n\nmodule.exports = class SearchBox {\n\n  // Injecting window and document to allow easier mocking\n  constructor($elm, _window = window, doc = document) {\n    try {\n      this.$elm = $elm;\n      this.$input = this.$elm.querySelector('input[type=\"search\"]');\n    } catch (e) {\n      return;\n    }\n\n    this.$container = $elm.querySelector('fieldset');\n    this.$resetButton = $elm.querySelector('button[type=\"reset\"]');\n\n    this.$elm.classList.add('search-box--js');\n\n    // events\n    this.$resetButton.addEventListener('click', this.reset.bind(this));\n    this.$input.addEventListener('keyup', this.handleInput.bind(this));\n    this.$input.addEventListener('paste', this.handleInput.bind(this));\n\n  }\n\n  /**\n   * Handles the reset button being pressed.\n   */\n  reset() {\n    this.hideResetButton();\n    if (this.$output) {\n      this.$output.innerHTML = '';\n    }\n\n    this.$input.focus();\n  }\n\n  /**\n   * Hides the reset button.\n   */\n  hideResetButton() {\n    this.$elm.classList.remove('search-box--populated');\n  }\n\n  /**\n   * Shows the reset button.\n   */\n  showResetButton() {\n    this.$elm.classList.add('search-box--populated');\n  }\n\n  /**\n   * Show/hide reset button, depending on whether there's text to clear or not.\n   */\n  handleInput(e) {\n    if (e.keyCode === /*Tab*/9) {\n      return;\n    }\n\n    if (this.$input.value.length > 0) {\n      this.showResetButton();\n    } else {\n      this.hideResetButton();\n    }\n  }\n\n};\n","'use strict';\n\nmodule.exports = class SelectNav {\n\n  constructor($elm) {\n    if (!$elm) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.$elm.classList.add('select-nav--js');\n    this.$elm.querySelector('select').addEventListener('change', this.triggerSubmit.bind(this));\n  }\n\n  triggerSubmit() {\n    this.$elm.submit();\n  }\n\n};\n","'use strict';\nvar utils = require('../libs/elife-utils')();\n\nmodule.exports = class SiteHeader {\n\n  // Passing window and document separately allows for independent mocking of window in order\n  // to test feature support fallbacks etc.\n  constructor($elm, _window = window, doc = document) {\n    if (!$elm) {\n      return;\n    }\n\n    this.$elm = $elm;\n    this.window = _window;\n    this.doc = doc;\n\n    let SearchBox = require('./SearchBox');\n    let $searchBoxEl = $elm.querySelector('[data-behaviour=\"SearchBox\"]');\n    this.searchBox = new SearchBox($searchBoxEl, this.window, doc);\n    var searchToggle = $elm.querySelector('[rel=\"search\"]');\n    if (!!searchToggle) {\n      this.searchToggle = searchToggle.parentNode;\n      this.searchToggle.addEventListener('click', this.toggleSearchBox.bind(this));\n    }\n\n    this.$pageOverlay = null;\n\n    // N.B. $mainMenu is not part of this component's HTML hierarchy.\n    var mainMenu = doc.querySelector('#mainMenu');\n    if (!!mainMenu) {\n      let MainMenu = require('./MainMenu');\n      this.mainMenu = new MainMenu(mainMenu);\n\n      this.$mainMenuToggle = this.$elm.querySelector('a[href=\"#mainMenu\"]');\n      if (!!this.$mainMenuToggle) {\n        this.mainMenu.moveWithinDom();\n        this.$mainMenuToggle.addEventListener('click', this.toggleMainMenu.bind(this));\n      }\n    }\n  }\n\n  /**\n   * Toggles display of the main menu.\n   */\n  toggleMainMenu(e) {\n    if (this.mainMenu.isOpen()) {\n      this.mainMenu.close();\n      this.window.removeEventListener('keyup', this.checkForMenuClose.bind(this));\n      this.doc.querySelector('.global-inner').\n               removeEventListener('click', this.checkForMenuClose.bind(this));\n    } else {\n      this.mainMenu.open();\n      this.window.addEventListener('keyup', this.checkForMenuClose.bind(this));\n      this.doc.querySelector('.global-inner').\n               addEventListener('click', this.checkForMenuClose.bind(this));\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  checkForMenuClose(e) {\n    if (e.keyCode === 27 || e.type === 'click') {\n      this.mainMenu.close();\n    }\n  }\n\n  /**\n   * Toggles display of the search box.\n   *\n   * @param {Event} e The event causing the toggle to occur\n   */\n  toggleSearchBox(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.searchBoxIsOpen()) {\n      this.closeSearchBox();\n    } else {\n      this.openSearchBox();\n    }\n  }\n\n  /**\n   * Returns true if the search box is currently displayed.\n   *\n   * @returns {boolean} True if the search box is open\n   */\n  searchBoxIsOpen() {\n    return this.searchBox.$elm.classList.contains('search-box--shown');\n  }\n\n  /**\n   * Closes the search box.\n   */\n  closeSearchBox() {\n    this.searchBox.$elm.classList.remove('search-box--shown');\n    utils.updateElementTranslate(this.searchBox.$elm, [0, '-40px']);\n    if (this.searchBox.$output) {\n      this.searchBox.$output.innerHTML = '';\n    }\n\n    this.searchBox.$input.blur();\n    this.window.removeEventListener('keyup', this.checkForClose.bind(this));\n    this.window.removeEventListener('click', this.checkForClose.bind(this));\n    this.hidePageOverlay();\n  }\n\n  /**\n   * Decides whether to close the search box, based on the supplied event.\n   *\n   * @param e The KeyboardEvent provoking the check.\n   */\n  checkForClose(e) {\n    if (e.keyCode && e.keyCode === 27 ||\n        (e.type === 'click' && !utils.areElementsNested(this.searchBox.$elm, e.target))) {\n      this.closeSearchBox();\n    }\n  }\n\n  /**\n   * Opens the search box.\n   */\n  openSearchBox() {\n    let myHeight = this.window.getComputedStyle(this.$elm).height;\n    let adjustment = 20;\n    let offsetY = utils.adjustPxString(myHeight, adjustment, 'add');\n\n    // This is set in the site-header.scss.\n    let transitionDurationInMs = 150;\n    utils.updateElementTranslate(this.searchBox.$elm, [0, offsetY]);\n    utils.invertPxString(this.window.getComputedStyle(this.searchBox.$container).height);\n    this.searchBox.$elm.classList.add('search-box--shown');\n    this.window.addEventListener('keyup', this.checkForClose.bind(this));\n    this.window.addEventListener('click', this.checkForClose.bind(this));\n\n    this.window.setTimeout(() => {\n\n      // blur before focus forces the focus, a simple focus doesn't always behave as expected.\n      this.searchBox.$input.blur();\n      this.searchBox.$input.focus();\n    }, transitionDurationInMs);\n    this.showPageOverlay();\n  }\n\n  /**\n   * Creates the page overlay.\n   *\n   */\n  createPageOverlay() {\n    let className = 'overlay--semi-white';\n\n    if (!this.$pageOverlay) {\n      this.$pageOverlay = this.doc.createElement('div');\n      this.$pageOverlay.classList.add(className);\n    }\n\n    let $target = this.doc.querySelector('.global-inner');\n    $target.insertBefore(this.$pageOverlay,\n                         this.doc.querySelector('.site-header').nextElementSibling);\n  }\n\n  /**\n   * Shows the page overlay.\n   */\n  showPageOverlay() {\n    if (!this.$pageOverlay) {\n      this.createPageOverlay();\n    }\n\n    this.$pageOverlay.style.display = 'block';\n    this.$pageOverlay.style.height = this.doc.querySelector('.global-inner')\n                                         .getBoundingClientRect().height + 'px';\n  }\n\n  /**\n   * Hides the page overlay.\n   */\n  hidePageOverlay() {\n    this.$pageOverlay.style.display = 'none';\n  }\n\n};\n","'use strict';\n\nmodule.exports = class ViewSelector {\n\n  constructor($elm, _window = window, doc = document) {\n\n    if (!$elm) {\n      return;\n    }\n\n    this.window = _window;\n    this.doc = doc;\n    this.$elm = $elm;\n    this.$jumpLinks = this.$elm.querySelector('.view-selector__jump_links');\n    this.$jumpLinksToggle = this.$elm.querySelector('.view-selector__jump_links_header');\n    this.cssFixedClassName = 'view-selector--fixed';\n\n    this.mainTarget = this.doc.querySelector('[role=\"main\"]');\n\n    // matches top padding in scss\n    let topSpaceWhenFixed = 30;\n\n    this.elmYOffset = this.$elm.offsetTop - topSpaceWhenFixed;\n    this.window.addEventListener('scroll', this.handleScroll.bind(this));\n    this.$jumpLinksToggle.addEventListener('click', this.toggleJumpLinks.bind(this));\n    this.toggleJumpLinks();\n  }\n\n  handleScroll() {\n\n    // If it's position is fixed\n    if (this.$elm.classList.contains(this.cssFixedClassName)) {\n\n      // Allow it to scroll again if it could keep its position & not scroll off top of screen\n      if (this.window.pageYOffset < this.elmYOffset) {\n        this.$elm.classList.remove(this.cssFixedClassName);\n        return;\n      }\n\n      // Allow it to scroll again if it would otherwise over-/under-lay following element\n      let bottomOfMain = this.mainTarget.getBoundingClientRect().bottom;\n      if (bottomOfMain < this.$elm.offsetHeight) {\n        let amountToNudgeUp = bottomOfMain - this.$elm.offsetHeight;\n        this.$elm.style.top = amountToNudgeUp + 'px';\n        return;\n      }\n\n      // Ensure top of component is not off top of screen once bottom of main is off screen bottom\n      // Safety net: required because a fast scroll may prevent all code running as desired.\n      if (bottomOfMain >= this.window.innerHeight) {\n        this.$elm.style.top = '0px';\n      }\n\n      return;\n    }\n\n    // Otherwise fix its position if it would otherwise scroll off the top of the screen\n    if (this.window.pageYOffset >= this.elmYOffset) {\n      this.$elm.classList.add(this.cssFixedClassName);\n      this.$elm.style.top = '0px';\n    }\n\n  }\n\n  toggleJumpLinks() {\n    this.$jumpLinks.classList.toggle('visuallyhidden');\n    this.$jumpLinksToggle.classList.toggle('view-selector__jump_links_header--closed');\n    this.handleScroll();\n\n  }\n\n};\n","\nmodule.exports = class ViewerModal {\n\n  constructor($elm) {\n    this.$elm = $elm;\n    this.$prev = document.createElement('div');\n    this.$next = document.createElement('div');\n\n    // build the modal\n    this.build();\n\n    // events\n    this.$prev.addEventListener('click', this.prev);\n    this.$next.addEventListener('click', this.next);\n  }\n\n  build() {\n    //\n  }\n\n  prev(e) {\n    e.preventDefault();\n  }\n\n  next(e) {\n    e.preventDefault();\n  }\n\n  close() {\n    //\n  }\n\n};\n","module.exports = () => {\n  'use strict';\n\n  /**\n   * Builds and returns specified HTML element, optionally adding it to the DOM.\n   *\n   * @param {string} elName Name of the HTML element to build\n   * @param {Array} [cssClasses] CSS class name(s) to set on the element\n   * @param {string} [textContent] Textual content of the element\n   * @param {string|Element} [parent] Parent element to attach to\n   * @param {string|Element|boolean} [attachBefore] Following sibling (1st if true, last if falsey)\n   *\n   * @returns {Element}\n   */\n  function buildElement(elName, cssClasses, textContent, parent, attachBefore) {\n\n    var $el = document.createElement(elName);\n    var $parent = typeof parent === 'string' ? document.querySelector(parent)\n      : parent;\n\n    // Work out what the new element's following sibling will be, based on value of attachBefore.\n    var $followingSibling = (function () {\n\n      if (!!attachBefore) {\n\n        if (typeof attachBefore === 'boolean') {\n          return $parent.firstElementChild;\n\n        } else if (typeof attachBefore === 'string') {\n          return document.querySelector(attachBefore);\n\n        } else if (attachBefore instanceof HTMLElement) {\n          return attachBefore;\n\n        }\n      }\n    }());\n\n    if (Array.isArray(cssClasses)) {\n      cssClasses.forEach(cssClass => {\n        $el.classList.add(cssClass);\n      });\n    }\n\n    if (textContent) {\n      $el.innerHTML = textContent;\n    }\n\n    if (!!$parent) {\n      // TODO: Handle what happens if following sibling is not a child of parent\n      if (!!$followingSibling) {\n        $parent.insertBefore($el, $followingSibling);\n      } else {\n        $parent.appendChild($el);\n      }\n    }\n\n    return $el;\n  }\n\n  var uniqueIds = (function uniqueIds() {\n\n    class UniqueIdentifiers {\n\n      constructor () {\n        this.used = [];\n      }\n\n      isValid(candidate, document) {\n        // Compulsory check that id is unique to this object's knowledge.\n        if (this.used.indexOf(candidate) > -1) {\n          return false;\n        }\n\n        // Optional check to see if id is unique in the DOM.\n        if (!!document) {\n          if (!!document.querySelector &&\n              typeof document.querySelector === 'function' &&\n              document.querySelector('#' + candidate)) {\n            return false;\n          }\n        }\n\n        return true;\n      }\n\n      /**\n       * Gets a unique id with optional prefix.\n       *\n       * @param {string} [prefix] Prefix to use for the id\n       * @param {HTMLDocument} [document] Enables checking for the id's uniqueness within the DOM\n       * @returns {string}\n       */\n      get(prefix, document) {\n        var _prefix = '' + prefix || 'default_';\n        var random = ('' + Math.random()).replace(/\\./, '');\n        var candidate = _prefix + random;\n        if (this.isValid(candidate, document)) {\n          this.used.push(candidate);\n          return candidate;\n        }\n\n        this.get(prefix, document);\n      }\n    }\n\n    return new UniqueIdentifiers();\n  }());\n\n  /**\n   * Updates the CSS transform's translate function on the element in a vendor-prefix-aware fashion.\n   *\n   * Because of the way CSS transformations are combined into a matrix, this may not work\n   * as expected if other CSS transformations are also applied to the same element.\n   *\n   * @param {HTMLElement} $el The element to apply the transformation to.\n   * @param {Array} offset The offset for both axes, expressed as [x, y], e.g. [0, '20px']\n   */\n  function updateElementTranslate($el, offset) {\n    if (!($el instanceof HTMLElement && Array.isArray(offset))) {\n      return false;\n    }\n\n    function calcOffset(value) {\n      if (!value) {\n        return '0px';\n      }\n\n      if (typeof value === 'number') {\n        return value + 'px';\n      }\n\n      if (typeof value === 'string') {\n        value += 'px';\n        return value.replace(/((px)+)$/, 'px');\n      }\n    }\n\n    let offsetX = calcOffset(offset[0]);\n    let offsetY = calcOffset(offset[1]);\n\n    let props = ['webkitTransform', 'mozTransform', 'msTransform', 'oTransform', 'transform'];\n    props.forEach((prop) => {\n      // Only set the vendor prefixed properties where they are supported\n      if ($el.style[prop] !== undefined) {\n        $el.style[prop] = 'translate(' + offsetX + ', ' + offsetY + ')';\n      }\n    });\n  }\n\n  function _getValueFromPxString(pxString) {\n    if (pxString === '0') {\n      return 0;\n    }\n\n    return parseInt(pxString.match(/([-0-9.]+)px/)[1], 10);\n  }\n\n  function _getZeroAwarePxStringFromValue(value) {\n    if (value === 0) {\n      return '' + value;\n    }\n\n    return value + 'px';\n  }\n\n  /**\n   * Add a quantity to a px amount expressed as a string, and return new string with updated value.\n   *\n   * For example: adjustPxString('97px', 8) returns '105px'\n   *\n   * @param {String} pxString The string representing the original quantity, e.g. '97px'\n   * @param adjustment The numeric adjustment to make, e.g. 8\n   * @param operation\n   * @returns {string} The modified value, as a string, e.g.: '105px'\n   */\n  function adjustPxString(pxString, adjustment, requestedOperation) {\n    let originalSize = _getValueFromPxString(pxString);\n    let adjustedSize = originalSize;\n    let operation = 'add';\n    if (['subtract', 'multiply', 'divide'].indexOf(requestedOperation) > -1) {\n      operation = requestedOperation;\n    }\n\n    switch (operation) {\n    case 'add':\n      adjustedSize = originalSize + adjustment;\n      break;\n    case 'subtract':\n      adjustedSize = originalSize - adjustment;\n      break;\n    case 'multiply':\n      adjustedSize = originalSize * adjustment;\n      break;\n    case 'divide':\n      adjustedSize = originalSize / adjustment;\n      break;\n    default:\n      break;\n    }\n    return _getZeroAwarePxStringFromValue(adjustedSize);\n  }\n\n  /**\n   * Invert the px amount expressed as a string, and return new string with inverted value.\n   *\n   * For example: invertPxString('97px') returns '-97px'\n   *\n   * @param {String} pxString The string representing the original quantity, e.g. '97px'\n   * @returns {string} The modified value, as a string, e.g.: '-97px'\n   */\n  function invertPxString(pxString) {\n    let originalSize = _getValueFromPxString(pxString);\n    let adjustedSize = originalSize * -1;\n    return _getZeroAwarePxStringFromValue(adjustedSize);\n  }\n\n  /**\n   * Returns true if $prospectiveDescendant is, or is a descendant of $prospectiveParent.\n   *\n   * @param {Node} $prospectiveParent el to test as a parent of the $prospectiveDescendant\n   * @param {Node} $prospectiveDescendant el to test as descendant of the $prospectiveParent\n   * @returns {boolean} Whether the $prospectiveDescendant is, or descends from $prospectiveParent\n   */\n  function areElementsNested($prospectiveParent, $prospectiveDescendant) {\n    if (!($prospectiveParent instanceof Node && $prospectiveDescendant instanceof Node)) {\n      return false;\n    }\n\n    let relationship = $prospectiveParent.compareDocumentPosition($prospectiveDescendant);\n    return !!(\n      relationship & $prospectiveParent.DOCUMENT_POSITION_CONTAINED_BY || relationship === 0\n    );\n  }\n\n  /**\n   * Returns whether the display is considered to have a high pixel density ratio.\n   *\n   * @param window\n   * @returns {boolean} true if dpr >= 2, false if lower, or unknown.\n   */\n  function isHighDpr(window) {\n    if (!!window.devicePixelRatio) {\n      return window.devicePixelRatio >= 2;\n    }\n\n    return false;\n  }\n\n  return {\n    adjustPxString: adjustPxString,\n    areElementsNested: areElementsNested,\n    buildElement: buildElement,\n    invertPxString: invertPxString,\n    isHighDpr: isHighDpr,\n    uniqueIds: uniqueIds,\n    updateElementTranslate: updateElementTranslate,\n  };\n\n};\n","'use strict';\n\n// Base level of feature support needed for the js loaded in this file.\n// Consider AJAXing in the rest if the test passes.\nif (window.localStorage && document.querySelector &&\n       window.addEventListener && !!(document.createElement('div')).classList) {\n\n  document.querySelector('html').classList.add('js');\n\n  let Components = {};\n\n  // import modules into the list of Components.\n  Components.AllSubjectsListLink = require('./components/AllSubjectsListLink');\n  Components.ArticleDownloadLinksList = require('./components/ArticleDownloadLinksList');\n  Components.ArticleSection = require('./components/ArticleSection');\n  Components.AudioPlayer = require('./components/AudioPlayer');\n  Components.BackgroundImage = require('./components/BackgroundImage');\n  Components.Carousel = require('./components/Carousel');\n  Components.ContentHeaderArticle = require('./components/ContentHeaderArticle');\n  Components.FragmentHandler = require('./components/FragmentHandler');\n  Components.MainMenu = require('./components/MainMenu');\n  Components.Math = require('./components/Math');\n  Components.MediaChapterListingItem = require('./components/MediaChapterListingItem');\n  Components.Pager = require('./components/Pager');\n  Components.SearchBox = require('./components/SearchBox');\n  Components.SelectNav = require('./components/SelectNav');\n  Components.SiteHeader = require('./components/SiteHeader');\n  Components.ViewerModal = require('./components/ViewerModal');\n  Components.ViewSelector = require('./components/ViewSelector');\n\n  // App\n  let Elife = function Elife() {\n\n    let singletons = (function () {\n      let registered = [];\n\n      function isRegistered(componentName) {\n        return registered.indexOf(componentName) > -1;\n      }\n\n      function register(componentName) {\n        registered.push(componentName);\n      }\n\n      return {\n        isRegistered: isRegistered,\n        register: register,\n      };\n\n    }());\n\n    function initialiseComponent($component) {\n      // When present, data-behaviour contains a space-separated list of handlers for that component\n      let handlers = $component.getAttribute('data-behaviour').trim().split(' ');\n      for (let i = 0; i < handlers.length; i += 1) {\n        let handler = handlers[i];\n        if (!singletons.isRegistered(handler)) {\n          if (!!Components[handler] && typeof Components[handler] === 'function') {\n            new Components[handler]($component, window, window.document);\n          }\n\n          if (typeof Components[handler].isSingleton === 'function' &&\n              Components[handler].isSingleton()) {\n            singletons.register(handler);\n          }\n        }\n      }\n    }\n\n    let components = document.querySelectorAll('[data-behaviour]');\n    if (components) {\n      [].forEach.call(components, initialiseComponent);\n    }\n\n  };\n\n  new Elife();\n}\n\n"]}